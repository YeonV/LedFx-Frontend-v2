"use strict";(self.webpackChunkledfx=self.webpackChunkledfx||[]).push([[931],{"./src/pages/Devices/DeviceCard/DeviceCard.stories.tsx"(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Default:()=>Default,__namedExportsOrder:()=>__namedExportsOrder,default:()=>DeviceCard_stories});var objectSpread2=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/objectSpread2.js"),chunk_JZWAC4HX=__webpack_require__("./node_modules/react-router/dist/development/chunk-JZWAC4HX.mjs"),react=__webpack_require__("./node_modules/react/index.js"),useTheme=__webpack_require__("./node_modules/@mui/material/esm/styles/useTheme.js"),Card=__webpack_require__("./node_modules/@mui/material/esm/Card/Card.js"),Button=__webpack_require__("./node_modules/@mui/material/esm/Button/Button.js"),Settings=__webpack_require__("./node_modules/@mui/icons-material/esm/Settings.js"),Visibility=__webpack_require__("./node_modules/@mui/icons-material/esm/Visibility.js"),Tune=__webpack_require__("./node_modules/@mui/icons-material/esm/Tune.js"),Build=__webpack_require__("./node_modules/@mui/icons-material/esm/Build.js"),Collapse=__webpack_require__("./node_modules/@mui/material/esm/Collapse/Collapse.js"),ExpandMore=__webpack_require__("./node_modules/@mui/icons-material/esm/ExpandMore.js"),IconButton=__webpack_require__("./node_modules/@mui/material/esm/IconButton/IconButton.js"),Typography=__webpack_require__("./node_modules/@mui/material/esm/Typography/Typography.js"),SyncProblem=__webpack_require__("./node_modules/@mui/icons-material/esm/SyncProblem.js"),Pause=__webpack_require__("./node_modules/@mui/icons-material/esm/Pause.js"),PlayArrow=__webpack_require__("./node_modules/@mui/icons-material/esm/PlayArrow.js"),Stop=__webpack_require__("./node_modules/@mui/icons-material/esm/Stop.js"),PestControl=__webpack_require__("./node_modules/@mui/icons-material/esm/PestControl.js"),Delete=__webpack_require__("./node_modules/@mui/icons-material/esm/Delete.js"),Fade=__webpack_require__("./node_modules/@mui/material/esm/Fade/Fade.js"),Box=__webpack_require__("./node_modules/@mui/material/esm/Box/Box.js"),CircularProgress=__webpack_require__("./node_modules/@mui/material/esm/CircularProgress/CircularProgress.js"),Stack=__webpack_require__("./node_modules/@mui/material/esm/Stack/Stack.js"),Popover=__webpack_require__("./src/components/Popover/Popover.tsx"),Dialog=__webpack_require__("./node_modules/@mui/material/esm/Dialog/Dialog.js"),AppBar=__webpack_require__("./node_modules/@mui/material/esm/AppBar/AppBar.js"),Toolbar=__webpack_require__("./node_modules/@mui/material/esm/Toolbar/Toolbar.js"),NavigateBefore=__webpack_require__("./node_modules/@mui/icons-material/esm/NavigateBefore.js"),DialogTitle=__webpack_require__("./node_modules/@mui/material/esm/DialogTitle/DialogTitle.js"),DialogContent=__webpack_require__("./node_modules/@mui/material/esm/DialogContent/DialogContent.js"),DialogContentText=__webpack_require__("./node_modules/@mui/material/esm/DialogContentText/DialogContentText.js"),DialogActions=__webpack_require__("./node_modules/@mui/material/esm/DialogActions/DialogActions.js"),Slide=__webpack_require__("./node_modules/@mui/material/esm/Slide/Slide.js"),MenuItem=__webpack_require__("./node_modules/@mui/material/esm/MenuItem/MenuItem.js"),ListItemIcon=__webpack_require__("./node_modules/@mui/material/esm/ListItemIcon/ListItemIcon.js"),Badge=__webpack_require__("./node_modules/@mui/material/esm/Badge/Badge.js"),ToggleButtonGroup=__webpack_require__("./node_modules/@mui/material/esm/ToggleButtonGroup/ToggleButtonGroup.js"),ToggleButton=__webpack_require__("./node_modules/@mui/material/esm/ToggleButton/ToggleButton.js"),Tooltip=__webpack_require__("./node_modules/@mui/material/esm/Tooltip/Tooltip.js"),GridOn=__webpack_require__("./node_modules/@mui/icons-material/esm/GridOn.js"),VisibilityOff=__webpack_require__("./node_modules/@mui/icons-material/esm/VisibilityOff.js"),helpers=__webpack_require__("./src/utils/helpers.ts"),useStore=__webpack_require__("./src/store/useStore.ts"),objectWithoutProperties=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js"),styled=__webpack_require__("./node_modules/@mui/material/esm/styles/styled.js"),Select=__webpack_require__("./node_modules/@mui/material/esm/Select/Select.js"),AddCircle=__webpack_require__("./node_modules/@mui/icons-material/esm/AddCircle.js"),BladeFrame=__webpack_require__("./src/components/SchemaForm/components/BladeFrame.tsx"),jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js");const _excluded=["onClose","value","open"],classes={root:"".concat("_AddSegmentDialog","-root"),paper:"".concat("_AddSegmentDialog","-paper")},Root=(0,styled.Ay)("div")(_ref=>{let{theme}=_ref;return{["&.".concat(classes.root)]:{margin:"1rem",backgroundColor:theme.palette.background.paper},["& .".concat(classes.paper)]:{width:"80%",maxHeight:435}}});function ConfirmationDialogRaw(props){const{onClose,value:valueProp,open}=props,other=(0,objectWithoutProperties.A)(props,_excluded),[value,setValue]=react.useState(valueProp),virtuals=(0,useStore.A)(state=>state.virtuals)||{},showComplex=(0,useStore.A)(state=>state.showComplex),showGaps=(0,useStore.A)(state=>state.showGaps);delete other.deviceList;const deviceKeys=Object.keys(props.deviceList).filter(v=>showComplex?v:!(v.endsWith("-mask")||v.endsWith("-foreground")||v.endsWith("-background"))).filter(v=>showGaps?v:!v.startsWith("gap-"));return(0,jsx_runtime.jsxs)(Dialog.A,(0,objectSpread2.A)((0,objectSpread2.A)({disableEscapeKeyDown:!0,maxWidth:"xs","aria-labelledby":"confirmation-dialog-title",open},other),{},{children:[(0,jsx_runtime.jsx)(DialogTitle.A,{id:"confirmation-dialog-title",children:"Select a device"}),(0,jsx_runtime.jsx)(DialogContent.A,{dividers:!0,children:(0,jsx_runtime.jsx)(BladeFrame.A,{full:!0,children:(0,jsx_runtime.jsx)(Select.A,{value,style:{width:"100%"},onChange:event=>{setValue(event.target.value)},children:deviceKeys.map(device=>{var _virtuals$props$devic,_virtuals$props$devic2,_props$deviceList$dev,_props$deviceList$dev2;return(0,jsx_runtime.jsx)(MenuItem.A,{value:props.deviceList[device].id,children:(null===(_virtuals$props$devic=virtuals[props.deviceList[device].id])||void 0===_virtuals$props$devic||null===(_virtuals$props$devic2=_virtuals$props$devic.config)||void 0===_virtuals$props$devic2?void 0:_virtuals$props$devic2.name)||(null===(_props$deviceList$dev=props.deviceList[device])||void 0===_props$deviceList$dev||null===(_props$deviceList$dev2=_props$deviceList$dev.config)||void 0===_props$deviceList$dev2?void 0:_props$deviceList$dev2.name)},props.deviceList[device].id)})})})}),(0,jsx_runtime.jsxs)(DialogActions.A,{children:[(0,jsx_runtime.jsx)(Button.A,{autoFocus:!0,onClick:()=>{onClose()},color:"primary",children:"Cancel"}),(0,jsx_runtime.jsx)(Button.A,{onClick:()=>{onClose(value)},color:"primary",children:"Ok"})]})]}))}function ConfirmationDialog(_ref2){let{virtual,config={}}=_ref2;const[open,setOpen]=react.useState(!1),deviceList=(0,useStore.A)(state=>state.devices)||{},virtuals=(0,useStore.A)(state=>state.virtuals)||{},updateSegments=(0,useStore.A)(state=>state.updateSegments),getVirtuals=(0,useStore.A)(state=>state.getVirtuals),highlightSegment=(0,useStore.A)(state=>state.highlightSegment),setEffect=(0,useStore.A)(state=>state.setEffect);return(0,jsx_runtime.jsx)(Root,{className:classes.root,children:deviceList&&Object.keys(deviceList).length>0?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(Button.A,{variant:"contained",color:"primary","aria-label":"Add",endIcon:(0,jsx_runtime.jsx)(AddCircle.A,{}),onClick:()=>{setOpen(!0)},role:"listitem",children:"ADD NEW SEGMENT"}),(0,jsx_runtime.jsx)(ConfirmationDialogRaw,{classes:{paper:classes.paper},config,id:"ringtone-menu",keepMounted:!0,open,onClose:newValue=>{if(setOpen(!1),newValue){const device=(0,objectSpread2.A)({},deviceList[Object.keys(deviceList).find(d=>deviceList[d].id===newValue)||0]);if(device&&null!=device&&device.config){var _device$config$pixel_,_device$config;const test=[...virtual.segments,[device.id,0,(null!==(_device$config$pixel_=null==device||null===(_device$config=device.config)||void 0===_device$config?void 0:_device$config.pixel_count)&&void 0!==_device$config$pixel_?_device$config$pixel_:0)-1,!1]].filter(t=>4===t.length);updateSegments(virtual.id,test).then(()=>{var _virtuals$device$acti,_device$config$pixel_2,_device$config2;(getVirtuals(),!1===virtual.active&&0===virtual.segments.length)&&(device.active_virtuals&&device.active_virtuals[0]&&virtuals&&virtuals[device.active_virtuals[0]]&&virtuals[device.active_virtuals[0]].effect&&virtuals[device.active_virtuals[0]].effect.type?setEffect(virtual.id,virtuals[device.active_virtuals[0]].effect.type,null===(_virtuals$device$acti=virtuals[device.active_virtuals[0]].effect)||void 0===_virtuals$device$acti?void 0:_virtuals$device$acti.config,!0):setEffect(virtual.id,"rainbow",{},!0));device&&null!=device&&device.config&&highlightSegment(virtual.id,device.id,0,(null!==(_device$config$pixel_2=null==device||null===(_device$config2=device.config)||void 0===_device$config2?void 0:_device$config2.pixel_count)&&void 0!==_device$config$pixel_2?_device$config$pixel_2:0)-1,!1)})}}},value:"",deviceList})]}):null})}ConfirmationDialog.__docgenInfo={description:"",methods:[],displayName:"ConfirmationDialog",props:{virtual:{required:!0,tsType:{name:"any"},description:""},config:{required:!1,tsType:{name:"any"},description:"",defaultValue:{value:"{}",computed:!1}}}};var ExpandLess=__webpack_require__("./node_modules/@mui/icons-material/esm/ExpandLess.js"),SwapHoriz=__webpack_require__("./node_modules/@mui/icons-material/esm/SwapHoriz.js"),index_module=__webpack_require__("./node_modules/use-debounce/dist/index.module.js"),Slider=__webpack_require__("./node_modules/@mui/material/esm/Slider/Slider.js"),TextField=__webpack_require__("./node_modules/@mui/material/esm/TextField/TextField.js");const PixelSlider=_ref=>{var _device$config;let{s,handleRangeSegment}=_ref;const device=(0,useStore.A)(state=>state.devices)[s[0]],pixelCount=(null==device||null===(_device$config=device.config)||void 0===_device$config?void 0:_device$config.pixel_count)||0,[range,setRange]=(0,react.useState)([s[1],s[2]]),[startInput,setStartInput]=(0,react.useState)(""),[endInput,setEndInput]=(0,react.useState)(""),[isEditingStart,setIsEditingStart]=(0,react.useState)(!1),[isEditingEnd,setIsEditingEnd]=(0,react.useState)(!1),handleChange=(0,react.useCallback)((_event,newValue)=>{handleRangeSegment(newValue[0],newValue[1])},[handleRangeSegment]),throttled=(0,index_module.dh)(handleChange,100),marks=(0,react.useMemo)(()=>[{value:0,label:1},{value:pixelCount-1,label:pixelCount}],[pixelCount]);(0,react.useEffect)(()=>{setRange([s[1],s[2]])},[s]);const handleStartFocus=(0,react.useCallback)(()=>{setIsEditingStart(!0),setStartInput(String(range[0]+1))},[range]),handleStartChange=(0,react.useCallback)(e=>{const rawValue=e.target.value;if(setStartInput(rawValue),""!==rawValue){const parsedValue=parseInt(rawValue,10);if(!isNaN(parsedValue)){const zeroIndexed=Math.max(1,Math.min(range[1]+1,parsedValue))-1;setRange([zeroIndexed,range[1]]),handleChange(e,[zeroIndexed,range[1]])}}},[range,handleChange]),handleStartBlur=(0,react.useCallback)(()=>{setIsEditingStart(!1),setStartInput("");let newStart=range[0];(newStart<0||newStart>=range[1])&&(newStart=Math.max(0,Math.min(range[1]-1,newStart)),setRange([newStart,range[1]]),handleChange(null,[newStart,range[1]]))},[range,handleChange]),handleEndFocus=(0,react.useCallback)(()=>{setIsEditingEnd(!0),setEndInput(String(range[1]+1))},[range]),handleEndChange=(0,react.useCallback)(e=>{const rawValue=e.target.value;if(setEndInput(rawValue),""!==rawValue){const parsedValue=parseInt(rawValue,10);if(!isNaN(parsedValue)){const zeroIndexed=Math.max(range[0]+1,Math.min(pixelCount,parsedValue))-1;setRange([range[0],zeroIndexed]),handleChange(e,[range[0],zeroIndexed])}}},[range,pixelCount,handleChange]),handleEndBlur=(0,react.useCallback)(()=>{setIsEditingEnd(!1),setEndInput("");let newEnd=range[1];(newEnd<=range[0]||newEnd>=pixelCount)&&(newEnd=Math.max(range[0]+1,Math.min(pixelCount-1,newEnd)),setRange([range[0],newEnd]),handleChange(null,[range[0],newEnd]))},[range,pixelCount,handleChange]),handleSliderChange=(0,react.useCallback)((_event,n)=>{const newRange=n;setRange(newRange),throttled(_event,newRange)},[throttled]);return device?(0,jsx_runtime.jsxs)(Stack.A,{direction:"row",spacing:5,alignItems:"flex-start",flexBasis:"100%",children:[(0,jsx_runtime.jsxs)(Stack.A,{direction:"column",spacing:1,alignItems:"flex-start",children:[(0,jsx_runtime.jsxs)(Typography.A,{color:"textSecondary",marginTop:1,marginBottom:-1,children:[range[1]-range[0]+1," LEDs"]}),(0,jsx_runtime.jsxs)(Stack.A,{direction:"row",spacing:1,alignItems:"flex-start",alignSelf:"flex-end",children:[(0,jsx_runtime.jsx)(TextField.A,{size:"small",type:"number",sx:{minWidth:"90px"},slotProps:{htmlInput:{style:{padding:"4.5px 8px 4.5px 14px"},min:1,max:pixelCount}},value:isEditingStart?startInput:range[0]+1,onFocus:handleStartFocus,onChange:handleStartChange,onBlur:handleStartBlur}),(0,jsx_runtime.jsx)(TextField.A,{size:"small",type:"number",sx:{minWidth:"90px"},slotProps:{htmlInput:{style:{padding:"4.5px 8px 4.5px 14px"},min:range[0]+1,max:pixelCount}},value:isEditingEnd?endInput:range[1]+1,onFocus:handleEndFocus,onChange:handleEndChange,onBlur:handleEndBlur})]})]}),(0,jsx_runtime.jsx)(Slider.Ay,{sx:{alignSelf:"center"},value:range,marks,valueLabelFormat:e=>e+1,min:0,max:pixelCount-1,onChange:handleSliderChange,"aria-labelledby":"range-slider",valueLabelDisplay:"auto"})]}):null},EditVirtuals_PixelSlider=PixelSlider;PixelSlider.__docgenInfo={description:"",methods:[],displayName:"PixelSlider",props:{s:{required:!0,tsType:{name:"tuple",raw:"[string, number, number]",elements:[{name:"string"},{name:"number"},{name:"number"}]},description:""},handleRangeSegment:{required:!0,tsType:{name:"signature",type:"function",raw:"(start: number, end: number) => void",signature:{arguments:[{type:{name:"number"},name:"start"},{type:{name:"number"},name:"end"}],return:{name:"void"}}},description:""}}};var makeStyles=__webpack_require__("./node_modules/@mui/styles/makeStyles/makeStyles.js");const Segment_styles=(0,makeStyles.A)(()=>({segmentsWrapper:{display:"flex",borderBottom:"1px dashed #aaa",justifyContent:"space-between",alignItems:"center",padding:"0.5rem 0"},segmentsColOrder:{display:"flex",justifyContent:"space-between",alignItems:"center"},segmentsButtonUp:{borderTopRightRadius:0,borderBottomRightRadius:0,minWidth:"50px"},segmentsButtonDown:{borderTopLeftRadius:0,borderBottomLeftRadius:0,minWidth:"50px",marginRight:"1rem"},segmentsColPixelSlider:{flex:"0 1 70%"},segmentsColActions:{display:"flex",justifyContent:"space-between",alignItems:"center"},"@media (max-width: 600px)":{segmentsColPixelSlider:{order:3,width:"calc(100% - 2rem)",margin:"2rem auto 0 auto"},segmentsWrapper:{flexDirection:"column",alignItems:"flex-start"},segmentsColActions:{position:"absolute",right:"1rem"}}})),Segment=_ref=>{let{s,i,virtual,segments,calib}=_ref;const devices=(0,useStore.A)(state=>state.devices),virtuals=(0,useStore.A)(state=>state.virtuals),updateSegments=(0,useStore.A)(state=>state.updateSegments),highlightSegment=(0,useStore.A)(state=>state.highlightSegment),highlightOffSegment=(0,useStore.A)(state=>state.highlightOffSegment),getVirtuals=(0,useStore.A)(state=>state.getVirtuals),activeSegment=(0,useStore.A)(state=>state.activeSegment),setActiveSegment=(0,useStore.A)(state=>state.setActiveSegment),title=(0,react.useMemo)(()=>{var _virtuals$deviceKey,_virtuals$deviceKey$c;if(!devices||!virtuals)return"";const deviceKey=Object.keys(devices).find(d=>d===s[0]);return deviceKey?null===(_virtuals$deviceKey=virtuals[deviceKey])||void 0===_virtuals$deviceKey||null===(_virtuals$deviceKey$c=_virtuals$deviceKey.config)||void 0===_virtuals$deviceKey$c?void 0:_virtuals$deviceKey$c.name:""},[devices,virtuals,s]),classes=Segment_styles(),handleInvert=(0,react.useCallback)(()=>{const newSegments=segments.map((seg,index)=>index===i?[seg[0],seg[1],seg[2],!seg[3]]:seg);updateSegments(virtual.id,newSegments).then(()=>{getVirtuals(),calib&&(highlightSegment(virtual.id,newSegments[i][0],newSegments[i][1],newSegments[i][2],newSegments[i][3]),setActiveSegment(i))})},[segments,i,virtual.id,updateSegments,getVirtuals,calib,highlightSegment,setActiveSegment]),reorder=(0,react.useCallback)(direction=>{const newSegments="UP"===direction?(0,helpers.wg)(segments,i-1,i):(0,helpers.wg)(segments,i,i+1);updateSegments(virtual.id,newSegments).then(()=>{getVirtuals(),calib&&(highlightSegment(virtual.id,newSegments["UP"===direction?i-1:i+1][0],newSegments["UP"===direction?i-1:i+1][1],newSegments["UP"===direction?i-1:i+1][2],newSegments["UP"===direction?i-1:i+1][3]),setActiveSegment("UP"===direction?i-1:i+1))})},[segments,i,virtual.id,updateSegments,getVirtuals,calib,highlightSegment,setActiveSegment]),handleDeleteSegment=(0,react.useCallback)(()=>{const newSegments=segments.filter((_seg,index)=>index!==i);updateSegments(virtual.id,newSegments).then(()=>{getVirtuals(),calib&&(highlightOffSegment(virtual.id),setActiveSegment(-1))})},[segments,i,virtual.id,updateSegments,getVirtuals,calib,highlightOffSegment,setActiveSegment]),handleRangeSegment=(0,react.useCallback)((start,end)=>{const newSegments=segments.map((seg,index)=>index===i?[seg[0],start,end,seg[3]]:seg);updateSegments(virtual.id,newSegments).then(()=>{getVirtuals(),calib&&(highlightSegment(virtual.id,newSegments[i][0],newSegments[i][1],newSegments[i][2],newSegments[i][3]),setActiveSegment(i))})},[segments,i,virtual.id,updateSegments,getVirtuals,calib,highlightSegment,setActiveSegment]),containerStyle=(0,react.useMemo)(()=>({padding:"0 1rem",background:calib&&i===activeSegment?"#ffffff18":""}),[calib,i,activeSegment]),pixelSliderContainerStyle=(0,react.useMemo)(()=>({alignSelf:"stretch",display:"flex",flexDirection:"column"}),[]),flipButtonStyle=(0,react.useMemo)(()=>({margin:"0 1rem 0 1.5rem"}),[]),popoverStyle=(0,react.useMemo)(()=>({padding:"5px"}),[]),flexContainerStyle=(0,react.useMemo)(()=>({display:"flex"}),[]);return(0,jsx_runtime.jsx)("div",{style:containerStyle,children:(0,jsx_runtime.jsxs)("div",{className:classes.segmentsWrapper,children:[(0,jsx_runtime.jsxs)(Stack.A,{direction:"column",spacing:1,alignItems:"flex-start",children:[(0,jsx_runtime.jsx)(Typography.A,{color:"textSecondary",marginTop:1,marginBottom:-1,children:title}),(0,jsx_runtime.jsx)("div",{className:classes.segmentsColOrder,children:(0,jsx_runtime.jsxs)("div",{style:flexContainerStyle,children:[(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsx)(Button.A,{disabled:0===i,color:"inherit",onClick:()=>reorder("UP"),size:"small",className:classes.segmentsButtonUp,children:(0,jsx_runtime.jsx)(ExpandLess.A,{})})}),(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsx)(Button.A,{disabled:i===virtual.segments.length-1,color:"inherit",onClick:()=>reorder("DOWN"),size:"small",className:classes.segmentsButtonDown,children:(0,jsx_runtime.jsx)(ExpandMore.A,{})})})]})})]}),(0,jsx_runtime.jsx)("div",{className:classes.segmentsColPixelSlider,style:pixelSliderContainerStyle,children:(0,jsx_runtime.jsx)(EditVirtuals_PixelSlider,{s,handleRangeSegment})}),(0,jsx_runtime.jsxs)("div",{className:classes.segmentsColActions,children:[(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsx)(Button.A,{variant:s[3]?"contained":"outlined",color:s[3]?"primary":"inherit",endIcon:(0,jsx_runtime.jsx)(SwapHoriz.A,{}),onClick:handleInvert,style:flipButtonStyle,children:"Flip"})}),(0,jsx_runtime.jsx)(Popover.A,{variant:"outlined",color:"primary",onConfirm:handleDeleteSegment,style:popoverStyle})]})]})})},EditVirtuals_Segment=Segment;Segment.__docgenInfo={description:"",methods:[],displayName:"Segment"};const EditVirtuals_styles=(0,makeStyles.A)(()=>({appBar:{position:"relative"},title:{flex:1},dialog:{},segmentTitle:{display:"flex",borderBottom:"1px dashed #aaa",justifyContent:"space-between",alignItems:"center",padding:"0.5rem 0",margin:"0 1rem"},segmentButtonWrapper:{display:"flex",justifyContent:"center",alignItems:"center",padding:"0.5rem 0",margin:"0 1rem"},cloudEffectCard:{cursor:"pointer",width:280}}));var BladeIcon=__webpack_require__("./src/components/Icons/BladeIcon/BladeIcon.tsx"),Divider=__webpack_require__("./node_modules/@mui/material/esm/Divider/Divider.js"),List=__webpack_require__("./node_modules/@mui/material/esm/List/List.js"),ListItem=__webpack_require__("./node_modules/@mui/material/esm/ListItem/ListItem.js");const Tours_Tour=__webpack_require__("./node_modules/reactour/dist/reactour.esm.js").Ay;var ViewModule=__webpack_require__("./node_modules/@mui/icons-material/esm/ViewModule.js"),AspectRatio=__webpack_require__("./node_modules/@mui/icons-material/esm/AspectRatio.js"),OpenWith=__webpack_require__("./node_modules/@mui/icons-material/esm/OpenWith.js"),Edit=__webpack_require__("./node_modules/@mui/icons-material/esm/Edit.js"),Transform=__webpack_require__("./node_modules/@mui/icons-material/esm/Transform.js"),Timeline=__webpack_require__("./node_modules/@mui/icons-material/esm/Timeline.js"),CameraAlt=__webpack_require__("./node_modules/@mui/icons-material/esm/CameraAlt.js"),Help=__webpack_require__("./node_modules/@mui/icons-material/esm/Help.js");const TourStep=_ref=>{let{title,children,icon:Icon}=_ref;return(0,jsx_runtime.jsxs)(Box.A,{sx:{maxWidth:350,color:"white"},children:[(0,jsx_runtime.jsxs)(Typography.A,{variant:"h6",sx:{display:"flex",alignItems:"center",mb:1.5},children:[Icon&&(0,jsx_runtime.jsx)(Icon,{sx:{mr:1,color:"primary.main"}}),title]}),(0,jsx_runtime.jsx)(Divider.A,{sx:{mb:1.5}}),(0,jsx_runtime.jsx)(Typography.A,{variant:"body2",component:"div",children})]})},baseStyle={backgroundColor:"#303030",padding:"16px",borderRadius:"8px"},steps=[{selector:".yz",content:(0,jsx_runtime.jsxs)(TourStep,{title:"Welcome to 2D Mapping",icon:ViewModule.A,children:["This is the 2D Virtual Mapper. Here, you define the physical layout of your LEDs on a 2D grid.",(0,jsx_runtime.jsx)("br",{}),(0,jsx_runtime.jsx)("br",{}),"LedFx uses this grid to render 2D effects accurately onto your unique setup."]}),style:baseStyle},{selector:".step-2d-virtual-three",content:(0,jsx_runtime.jsxs)(TourStep,{title:"Define Grid Size",icon:AspectRatio.A,children:["Start by setting the total Rows and Columns for your 2D layout.",(0,jsx_runtime.jsx)("br",{}),(0,jsx_runtime.jsx)("br",{}),"This defines the canvas size you will map your pixels onto. Adjust these sliders to match your desired resolution."]}),style:baseStyle},{selector:".react-transform-wrapper",content:(0,jsx_runtime.jsxs)(TourStep,{title:"Navigating the Canvas",icon:OpenWith.A,children:["Interact with the grid:",(0,jsx_runtime.jsxs)(List.A,{dense:!0,sx:{listStyleType:"disc",pl:4},children:[(0,jsx_runtime.jsxs)(ListItem.Ay,{sx:{display:"list-item"},children:[(0,jsx_runtime.jsx)("strong",{children:"Zoom:"})," Use your mouse wheel."]}),(0,jsx_runtime.jsxs)(ListItem.Ay,{sx:{display:"list-item"},children:[(0,jsx_runtime.jsx)("strong",{children:"Pan:"})," Left-click and drag."]})]}),'This navigation is active when the "DND-Canvas" mode is selected.']}),style:baseStyle,action:()=>{const canvasTab=document.querySelector('.MuiTab-root[value="1"]');canvasTab&&canvasTab.click()}},{selector:".react-transform-component",content:(0,jsx_runtime.jsxs)(TourStep,{title:"Mapping Pixels",icon:Edit.A,children:["Time to map your physical LEDs onto this grid!",(0,jsx_runtime.jsxs)(List.A,{dense:!0,sx:{listStyleType:"disc",pl:4},children:[(0,jsx_runtime.jsxs)(ListItem.Ay,{sx:{display:"list-item"},children:[(0,jsx_runtime.jsx)("strong",{children:"Right-click"})," an empty cell on the grid."]}),(0,jsx_runtime.jsx)(ListItem.Ay,{sx:{display:"list-item"},children:"In the dialog, select a Device and assign the corresponding Pixel Index."}),(0,jsx_runtime.jsx)(ListItem.Ay,{sx:{display:"list-item"},children:'Use "Group Mapping" to assign a range of pixels quickly.'})]})]}),style:baseStyle},{selector:".react-transform-component",content:(0,jsx_runtime.jsxs)(TourStep,{title:"Editing & Moving Groups",children:["Once pixels are mapped, you can adjust them.",(0,jsx_runtime.jsxs)(List.A,{dense:!0,sx:{listStyleType:"disc",pl:4},children:[(0,jsx_runtime.jsxs)(ListItem.Ay,{sx:{display:"list-item"},children:[(0,jsx_runtime.jsx)("strong",{children:"Right-click"})," a mapped pixel to Edit, Clear, or Move its Group."]}),(0,jsx_runtime.jsx)(ListItem.Ay,{sx:{display:"list-item"},children:'If you select "Move Group", the directional controls (arrows) will appear in the sidebar.'})]})]}),style:baseStyle},{selector:".step-2d-virtual-four",content:(0,jsx_runtime.jsxs)(TourStep,{title:"Layout Tools",icon:Transform.A,children:["Use these tools to manipulate the entire grid:",(0,jsx_runtime.jsxs)(List.A,{dense:!0,sx:{listStyleType:"disc",pl:4},children:[(0,jsx_runtime.jsx)(ListItem.Ay,{sx:{display:"list-item"},children:"Rotate 90Â°, Flip Horizontally/Vertically."}),(0,jsx_runtime.jsxs)(ListItem.Ay,{sx:{display:"list-item"},children:["Use ",(0,jsx_runtime.jsx)("strong",{children:"Reset"})," to reload the saved configuration."]}),(0,jsx_runtime.jsxs)(ListItem.Ay,{sx:{display:"list-item"},children:["Don't forget to ",(0,jsx_runtime.jsx)("strong",{children:"Save"})," your mapping!"]})]})]}),style:baseStyle},{selector:".step-2d-virtual-two",content:(0,jsx_runtime.jsxs)(TourStep,{title:"Live Pixel Graph",icon:Timeline.A,children:["Click the Play button to overlay the live visualization onto your 2D grid.",(0,jsx_runtime.jsx)("br",{}),(0,jsx_runtime.jsx)("br",{}),"This helps you verify that your mapping correctly aligns with the effects being generated by LedFx in real-time."]}),style:baseStyle},{selector:".step-2d-virtual-six",content:(0,jsx_runtime.jsxs)(TourStep,{title:"Interaction Modes",icon:Settings.A,children:["Switch how you interact with the mapper:",(0,jsx_runtime.jsxs)(List.A,{dense:!0,sx:{listStyleType:"disc",pl:4},children:[(0,jsx_runtime.jsxs)(ListItem.Ay,{sx:{display:"list-item"},children:[(0,jsx_runtime.jsx)("strong",{children:"DND-Canvas:"})," For zooming/panning the whole grid and right-click mapping."]}),(0,jsx_runtime.jsxs)(ListItem.Ay,{sx:{display:"list-item"},children:[(0,jsx_runtime.jsx)("strong",{children:"DND-Pixels:"})," Drag and drop individual mapped pixels to reposition them (disables zoom/pan)."]})]})]}),style:baseStyle},{selector:".step-2d-virtual-cam-toggle",content:(0,jsx_runtime.jsxs)(TourStep,{title:"Camera Mapper [Beta]",icon:CameraAlt.A,children:["Automate the mapping process! Use your webcam to detect the physical location of your LEDs and map them automatically to the grid.",(0,jsx_runtime.jsx)("br",{}),(0,jsx_runtime.jsx)("br",{}),"Click here to start the Camera Mapper tool."]}),style:baseStyle},{selector:".step-2d-virtual-cam-initialize",content:(0,jsx_runtime.jsx)(TourStep,{title:"Initialize Camera",children:"First, initialize the camera. Ensure your LED setup is clearly visible in the camera feed."}),style:baseStyle},{selector:".step-2d-virtual-cam-adjust",content:(0,jsx_runtime.jsx)(TourStep,{title:"Adjust Camera Settings",icon:Tune.A,children:"Adjust brightness, contrast, and gamma to optimize the camera's view of your LEDs. The goal is clear visibility of the lights against the background."}),style:baseStyle},{selector:".step-2d-virtual-cam-calibrate",content:(0,jsx_runtime.jsx)(TourStep,{title:"Calibrate",children:"Calibration helps LedFx understand the perspective and dimensions of your setup. Follow the on-screen prompts during calibration."}),style:baseStyle},{selector:".step-2d-virtual-cam-crop",content:(0,jsx_runtime.jsx)(TourStep,{title:"Crop & Mask",children:"Use the cropping tools to focus the detection area precisely on your LEDs, excluding background noise or other light sources."}),style:baseStyle},{selector:".step-2d-virtual-cam-settings",content:(0,jsx_runtime.jsxs)(TourStep,{title:"Detection Thresholds",icon:Settings.A,children:["Fine-tune these settings to ensure accurate LED detection.",(0,jsx_runtime.jsx)("br",{}),(0,jsx_runtime.jsx)("br",{}),"Adjust the ",(0,jsx_runtime.jsx)("strong",{children:"LED brightness"})," and ",(0,jsx_runtime.jsx)("strong",{children:"detection threshold"})," so LedFx reliably identifies each pixel during the mapping process."]}),style:baseStyle}],Tour2dVirtual=()=>{const[isTourOpen,setIsTourOpen]=(0,react.useState)(!1),setTour=(0,useStore.A)(state=>state.setTour),features=(0,useStore.A)(state=>state.features),theme=(0,useTheme.A)(),manualMapperSteps=steps.slice(0,8),cameraMapperSteps=steps.slice(8),activeSteps=features.matrix_cam?[...manualMapperSteps,...cameraMapperSteps]:manualMapperSteps;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(Tooltip.A,{title:"How to use 2D Virtuals",children:(0,jsx_runtime.jsx)(IconButton.A,{onClick:()=>{setIsTourOpen(!0),setTour("2d-virtual")},children:(0,jsx_runtime.jsx)(Help.A,{})})}),(0,jsx_runtime.jsx)(Tours_Tour,{steps:activeSteps,accentColor:theme.palette.primary.main,isOpen:isTourOpen,showNavigation:!0,onRequestClose:()=>setIsTourOpen(!1),showNumber:!0,lastStepNextButton:(0,jsx_runtime.jsx)(Box.A,{onClick:()=>{const exitCamMapperButton=document.querySelector(".step-2d-virtual-cam-toggle button");exitCamMapperButton&&exitCamMapperButton.innerText.includes("Exit")&&exitCamMapperButton.click()},children:"Done"})})]})},Tours_Tour2dVirtual=Tour2dVirtual;Tour2dVirtual.__docgenInfo={description:"",methods:[],displayName:"Tour2dVirtual"};var SubdirectoryArrowRight=__webpack_require__("./node_modules/@mui/icons-material/esm/SubdirectoryArrowRight.js");const AddExistingSegmentDialog_excluded=["onClose","value","open"],AddExistingSegmentDialog_classes={root:"".concat("_AddSegmentDialog","-root"),paper:"".concat("_AddSegmentDialog","-paper")},AddExistingSegmentDialog_Root=(0,styled.Ay)("div")(_ref=>{let{theme}=_ref;return{["&.".concat(AddExistingSegmentDialog_classes.root)]:{margin:"1rem",backgroundColor:theme.palette.background.paper},["& .".concat(AddExistingSegmentDialog_classes.paper)]:{width:"80%",maxHeight:435}}});function AddExistingSegmentDialog_ConfirmationDialogRaw(props){const{onClose,value:valueProp,open}=props,other=(0,objectWithoutProperties.A)(props,AddExistingSegmentDialog_excluded),[value,setValue]=react.useState(valueProp),virtuals=(0,useStore.A)(state=>state.virtuals)||{},showComplex=(0,useStore.A)(state=>state.showComplex),showGaps=(0,useStore.A)(state=>state.showGaps),virtualKeys=Object.keys(virtuals).filter(v=>showComplex?v:!(v.endsWith("-mask")||v.endsWith("-foreground")||v.endsWith("-background"))).filter(v=>showGaps?v:!v.startsWith("gap-")).filter(v=>1===virtuals[v].segments.length),segments=virtualKeys.reduce((acc,v)=>(acc[virtuals[v].config.name]=virtuals[v].segments.flat(),acc),{});return(0,jsx_runtime.jsxs)(Dialog.A,(0,objectSpread2.A)((0,objectSpread2.A)({disableEscapeKeyDown:!0,maxWidth:"xs","aria-labelledby":"confirmation-dialog-title",open},other),{},{children:[(0,jsx_runtime.jsx)(DialogTitle.A,{id:"confirmation-dialog-title",children:"Select a segment"}),(0,jsx_runtime.jsx)(DialogContent.A,{dividers:!0,children:(0,jsx_runtime.jsx)(BladeFrame.A,{full:!0,children:(0,jsx_runtime.jsx)(Select.A,{value,style:{width:"100%"},onChange:event=>{setValue(event.target.value)},children:Object.keys(segments).map(v=>{const k=virtualKeys.find(vi=>virtuals[vi].config.name===v);return(0,jsx_runtime.jsxs)(MenuItem.A,{value:JSON.stringify({[v]:segments[v]}),children:[k&&virtuals[k].is_device?"":(0,jsx_runtime.jsx)(SubdirectoryArrowRight.A,{color:"disabled",sx:{mr:1}}),v]},v)})})})}),(0,jsx_runtime.jsxs)(DialogActions.A,{children:[(0,jsx_runtime.jsx)(Button.A,{autoFocus:!0,onClick:()=>{onClose()},color:"primary",children:"Cancel"}),(0,jsx_runtime.jsx)(Button.A,{onClick:()=>{onClose(value)},color:"primary",children:"Ok"})]})]}))}function AddExistingSegmentDialog(_ref2){let{virtual,config={}}=_ref2;const[open,setOpen]=react.useState(!1),deviceList=(0,useStore.A)(state=>state.devices)||{},virtuals=(0,useStore.A)(state=>state.virtuals)||{},updateSegments=(0,useStore.A)(state=>state.updateSegments),getVirtuals=(0,useStore.A)(state=>state.getVirtuals),highlightSegment=(0,useStore.A)(state=>state.highlightSegment),setEffect=(0,useStore.A)(state=>state.setEffect);return(0,jsx_runtime.jsx)(AddExistingSegmentDialog_Root,{className:AddExistingSegmentDialog_classes.root,children:deviceList&&Object.keys(deviceList).length>0?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(Button.A,{variant:"contained",color:"primary","aria-label":"Add",endIcon:(0,jsx_runtime.jsx)(AddCircle.A,{}),onClick:()=>{setOpen(!0)},role:"listitem",children:"ADD EXISTING SEGMENT"}),(0,jsx_runtime.jsx)(AddExistingSegmentDialog_ConfirmationDialogRaw,{classes:{paper:AddExistingSegmentDialog_classes.paper},config,id:"ringtone-menu",keepMounted:!0,open,onClose:newValue=>{if(setOpen(!1),!newValue)return;const[name,segments]=Object.entries(JSON.parse(newValue))[0];if(name&&segments){const deviceKey=Object.keys(deviceList).find(d=>deviceList[d].id===segments[0]),device=deviceKey?deviceList[deviceKey]:void 0,test=[...virtual.segments,segments].filter(t=>4===t.length);updateSegments(virtual.id,test).then(()=>{getVirtuals(),device&&!1===virtual.active&&0===virtual.segments.length&&(device.active_virtuals&&device.active_virtuals[0]&&virtuals&&virtuals[device.active_virtuals[0]]&&virtuals[device.active_virtuals[0]].effect&&virtuals[device.active_virtuals[0]].effect.type?setEffect(virtual.id,virtuals[device.active_virtuals[0]].effect.type,virtuals[device.active_virtuals[0]].effect.config,!0):setEffect(virtual.id,"rainbow",{},!0)),device&&highlightSegment(virtual.id,device.id,segments[1],segments[2],!1)})}},value:"",deviceList})]}):null})}const Dialogs_AddExistingSegmentDialog=AddExistingSegmentDialog;AddExistingSegmentDialog.__docgenInfo={description:"",methods:[],displayName:"AddExistingSegmentDialog",props:{virtual:{required:!0,tsType:{name:"any"},description:""},config:{required:!1,tsType:{name:"any"},description:"",defaultValue:{value:"{}",computed:!1}}}};var index_esm=__webpack_require__("./node_modules/react-zoom-pan-pinch/dist/index.esm.js"),core_esm=__webpack_require__("./node_modules/@dnd-kit/core/dist/core.esm.js"),modifiers_esm=__webpack_require__("./node_modules/@dnd-kit/modifiers/dist/modifiers.esm.js");const MCell={deviceId:"",pixel:0,group:"0-0"},getMaxRange=(direction,row,col,rowN,colN)=>{let maxRange=0;return direction.includes("right")?(maxRange=colN*rowN-(row*colN+col),direction.includes("flip")&&(maxRange=row*colN+colN-col)):direction.includes("left")?(maxRange=row*colN+col+1,direction.includes("flip")&&(maxRange=(rowN-row-1)*colN+col+1)):direction.includes("bottom")?(maxRange=colN*rowN-(rowN*col+(rowN-row-1)),direction.includes("flip")&&(maxRange=rowN*col+(rowN-row))):direction.includes("top")&&(maxRange=rowN*col+row+1,direction.includes("flip")&&(maxRange=colN*rowN-(rowN*col+(rowN-row-1)))),maxRange-1},clone=input=>JSON.parse(JSON.stringify(input)),M_styles=(0,makeStyles.A)(()=>({gridCell:{cursor:"copy",border:"1px solid #666",width:100,height:100},gridCellContainer:{background:"#111",display:"flex",justifyContent:"center",alignItems:"center",position:"relative"},gridCellInner:{display:"flex",flexWrap:"wrap",height:"100%",width:"100%"},pixel:{display:"flex",flexDirection:"column",justifyContent:"space-between",alignItems:"center",height:"98px",background:"transparent",width:"98px",border:"5px solid #111",boxSizing:"border-box",padding:"8px",borderRadius:"10px"},centered:{display:"flex",width:"100%",justifyContent:"space-between"}})),MWrapper=_ref=>{let{children,move}=_ref;return(0,jsx_runtime.jsx)(Box.A,{sx:[{padding:0,display:"flex",justifyContent:"flex-start",alignItems:"flex-start",maxHeight:"calc(100vh - 64px)",height:"100%","& .react-transform-wrapper":{height:"100%",width:"100%"}},"landscape"===window.screen.orientation.type.split("-")[0]?{flexDirection:"row"}:{flexDirection:"column"},move?{"& .react-transform-wrapper":{overflow:"auto"}}:{"& .react-transform-wrapper":{overflow:"hidden"}}],children})},EditMatrix_MWrapper=MWrapper;MWrapper.__docgenInfo={description:"",methods:[],displayName:"MWrapper"};var PanTool=__webpack_require__("./node_modules/@mui/icons-material/esm/PanTool.js"),Mouse=__webpack_require__("./node_modules/@mui/icons-material/esm/Mouse.js"),AdsClick=__webpack_require__("./node_modules/@mui/icons-material/esm/AdsClick.js"),ControlCamera=__webpack_require__("./node_modules/@mui/icons-material/esm/ControlCamera.js"),InfoOutlined=__webpack_require__("./node_modules/@mui/icons-material/esm/InfoOutlined.js"),Gamepad=__webpack_require__("./node_modules/@mui/icons-material/esm/Gamepad.js"),Alert=__webpack_require__("./node_modules/@mui/material/esm/Alert/Alert.js"),Grid=__webpack_require__("./node_modules/@mui/material/esm/Grid/Grid.js"),Tab=__webpack_require__("./node_modules/@mui/material/esm/Tab/Tab.js"),TabContext=__webpack_require__("./node_modules/@mui/lab/esm/TabContext/TabContext.js"),TabList=__webpack_require__("./node_modules/@mui/lab/esm/TabList/TabList.js"),TabPanel=__webpack_require__("./node_modules/@mui/lab/esm/TabPanel/TabPanel.js");const MatrixEditorContext=(0,react.createContext)(null),useMatrixEditorContext=()=>{const context=(0,react.useContext)(MatrixEditorContext);if(!context)throw new Error("useMatrixEditorContext must be used within a MatrixEditorProvider");return context},DnDModeTabs=()=>{const{m,dnd,dndMode,setDndMode,setDnd,selectedGroup,setSelectedGroup}=useMatrixEditorContext(),[tab,setTab]=(0,react.useState)("1"),infoAlerts=(0,useStore.A)(state=>state.uiPersist.infoAlerts),setInfoAlerts=(0,useStore.A)(state=>state.setInfoAlerts),uniqueGroups=(0,react.useMemo)(()=>{const groups=new Set;return m.flat().forEach(cell=>{cell.group&&"string"==typeof cell.group&&"0-0"!==cell.group&&groups.add(cell.group)}),Array.from(groups)},[m]);(0,react.useEffect)(()=>{setInfoAlerts("groupMode",!0)},[]);return(0,react.useEffect)(()=>{!1===dnd?setTab("1"):"pixel"===dndMode?setTab("2"):"group"===dndMode&&setTab("3")},[dnd,dndMode]),(0,react.useEffect)(()=>{selectedGroup&&!uniqueGroups.includes(selectedGroup)&&setSelectedGroup(""),uniqueGroups&&0!==uniqueGroups.length||"1"!==tab&&(setDnd(!1),setTab("1"))},[selectedGroup,uniqueGroups,setSelectedGroup,setDnd,tab]),(0,jsx_runtime.jsxs)(TabContext.Ay,{value:tab,children:[(0,jsx_runtime.jsx)(Box.A,{sx:{borderBottom:1,borderColor:"divider",marginTop:"0 !important"},className:"step-2d-virtual-six",children:(0,jsx_runtime.jsxs)(TabList.A,{onChange:(event,newValue)=>{"1"===newValue&&(setDnd(!1),setDndMode("pixel")),"2"===newValue&&(setDnd(!0),setDndMode("pixel")),"3"===newValue&&(setDnd(!0),setDndMode("group")),setTab(newValue)},"aria-label":"DND Mode Tabs",children:[(0,jsx_runtime.jsx)(Tab.A,{sx:{flexBasis:"32%",minHeight:0,height:40},icon:(0,jsx_runtime.jsx)(PanTool.A,{}),iconPosition:"start",label:"Pan",value:"1"}),(0,jsx_runtime.jsx)(Tab.A,{disabled:!uniqueGroups||0===uniqueGroups.length,sx:{flexBasis:"33%",minHeight:0,height:40},icon:(0,jsx_runtime.jsx)(BladeIcon.A,{name:"mdi:led-outline"}),iconPosition:"start",label:"Move Pixel",value:"2"}),(0,jsx_runtime.jsx)(Tab.A,{disabled:!uniqueGroups||0===uniqueGroups.length,sx:{flexBasis:"35%",minHeight:0,height:40},icon:(0,jsx_runtime.jsx)(BladeIcon.A,{name:"mdi:led-strip-variant",sx:{mr:1}}),iconPosition:"start",label:"Move Group",value:"3"})]})}),(0,jsx_runtime.jsx)(TabPanel.A,{value:"1",sx:{padding:0,pt:2},children:(0,jsx_runtime.jsx)(Collapse.A,{in:infoAlerts.camera,children:(0,jsx_runtime.jsx)(Alert.A,{severity:"info",sx:{width:"100%",position:"relative","& .MuiAlert-icon":{position:"absolute",top:11,left:14},"& .MuiAlert-action":{position:"absolute",top:11,right:20}},onClose:()=>{setInfoAlerts("camera",!1)},children:(0,jsx_runtime.jsxs)(Box.A,{children:[(0,jsx_runtime.jsx)(Typography.A,{variant:"h6",sx:{mb:4,pl:3.7},children:"Pan & Inspect Mode"}),(0,jsx_runtime.jsxs)(Stack.A,{spacing:2,children:[(0,jsx_runtime.jsxs)(Grid.A,{container:!0,spacing:2,alignItems:"flex-start",children:[(0,jsx_runtime.jsx)(Grid.A,{size:{xs:4},children:(0,jsx_runtime.jsxs)(Stack.A,{direction:"row",spacing:1,alignItems:"center",children:[(0,jsx_runtime.jsx)(Mouse.A,{}),(0,jsx_runtime.jsx)(Typography.A,{variant:"body1",children:(0,jsx_runtime.jsx)("strong",{children:"Zoom"})})]})}),(0,jsx_runtime.jsx)(Grid.A,{size:{xs:8},children:(0,jsx_runtime.jsx)(Typography.A,{variant:"body1",color:"text.secondary",children:"Use your Mouse Wheel to zoom in and out of the matrix."})})]}),(0,jsx_runtime.jsxs)(Grid.A,{container:!0,spacing:2,alignItems:"flex-start",children:[(0,jsx_runtime.jsx)(Grid.A,{size:{xs:4},children:(0,jsx_runtime.jsxs)(Stack.A,{direction:"row",spacing:1,alignItems:"center",children:[(0,jsx_runtime.jsx)(PanTool.A,{}),(0,jsx_runtime.jsx)(Typography.A,{variant:"body1",children:(0,jsx_runtime.jsx)("strong",{children:"Pan"})})]})}),(0,jsx_runtime.jsx)(Grid.A,{size:{xs:8},children:(0,jsx_runtime.jsx)(Typography.A,{variant:"body1",color:"text.secondary",children:"Click and Drag with your Left Mouse Button to move your view."})})]}),(0,jsx_runtime.jsxs)(Grid.A,{container:!0,spacing:2,alignItems:"flex-start",children:[(0,jsx_runtime.jsx)(Grid.A,{size:{xs:4},children:(0,jsx_runtime.jsxs)(Stack.A,{direction:"row",spacing:1,alignItems:"center",children:[(0,jsx_runtime.jsx)(AdsClick.A,{}),(0,jsx_runtime.jsx)(Typography.A,{variant:"body1",children:(0,jsx_runtime.jsx)("strong",{children:"Actions"})})]})}),(0,jsx_runtime.jsx)(Grid.A,{size:{xs:8},children:(0,jsx_runtime.jsxs)(Typography.A,{variant:"body1",color:"text.secondary",children:[(0,jsx_runtime.jsx)("strong",{children:"Right-Click"})," empty cell to assign a pixel, or pixel to open its context menu."]})})]})]})]})})})}),uniqueGroups.length>0&&(0,jsx_runtime.jsx)(TabPanel.A,{value:"2",sx:{padding:0,pt:2},children:(0,jsx_runtime.jsx)(Collapse.A,{in:infoAlerts.pixelMode,children:(0,jsx_runtime.jsx)(Alert.A,{severity:"info",sx:{width:"100%",position:"relative","& .MuiAlert-icon":{position:"absolute",top:11,left:14},"& .MuiAlert-action":{position:"absolute",top:11,right:20}},onClose:()=>setInfoAlerts("pixelMode",!1),children:(0,jsx_runtime.jsxs)(Box.A,{children:[(0,jsx_runtime.jsx)(Typography.A,{variant:"h6",sx:{mb:4,pl:3.7},children:"Pixel Drag Mode"}),(0,jsx_runtime.jsxs)(Stack.A,{spacing:2,children:[(0,jsx_runtime.jsxs)(Grid.A,{container:!0,spacing:2,alignItems:"flex-start",children:[(0,jsx_runtime.jsx)(Grid.A,{size:{xs:4},children:(0,jsx_runtime.jsxs)(Stack.A,{direction:"row",spacing:1,alignItems:"center",children:[(0,jsx_runtime.jsx)(ControlCamera.A,{}),(0,jsx_runtime.jsx)(Typography.A,{variant:"body1",children:(0,jsx_runtime.jsx)("strong",{children:"MovePixel"})})]})}),(0,jsx_runtime.jsx)(Grid.A,{size:{xs:8},children:(0,jsx_runtime.jsx)(Typography.A,{variant:"body1",color:"text.secondary",children:"Drag & Drop a single pixel onto any empty cell to move it across the matrix."})})]}),(0,jsx_runtime.jsxs)(Grid.A,{container:!0,spacing:2,alignItems:"flex-start",children:[(0,jsx_runtime.jsx)(Grid.A,{size:{xs:4},children:(0,jsx_runtime.jsxs)(Stack.A,{direction:"row",spacing:1,alignItems:"center",children:[(0,jsx_runtime.jsx)(AdsClick.A,{}),(0,jsx_runtime.jsx)(Typography.A,{variant:"body1",children:(0,jsx_runtime.jsx)("strong",{children:"Actions"})})]})}),(0,jsx_runtime.jsx)(Grid.A,{size:{xs:8},children:(0,jsx_runtime.jsx)(Typography.A,{variant:"body1",color:"text.secondary",children:"The Right-Click menu is still available in this mode for cell-specific actions."})})]}),(0,jsx_runtime.jsxs)(Grid.A,{container:!0,spacing:2,alignItems:"flex-start",children:[(0,jsx_runtime.jsx)(Grid.A,{size:{xs:4},children:(0,jsx_runtime.jsxs)(Stack.A,{direction:"row",spacing:1,alignItems:"center",children:[(0,jsx_runtime.jsx)(InfoOutlined.A,{}),(0,jsx_runtime.jsx)(Typography.A,{variant:"body1",children:(0,jsx_runtime.jsx)("strong",{children:"Precision"})})]})}),(0,jsx_runtime.jsx)(Grid.A,{size:{xs:8},children:(0,jsx_runtime.jsx)(Typography.A,{variant:"body1",color:"text.secondary",children:(0,jsx_runtime.jsx)("em",{children:"For precise placement, Pan & Zoom are temporarily disabled in this mode."})})})]})]})]})})})}),uniqueGroups.length>0&&(0,jsx_runtime.jsx)(TabPanel.A,{value:"3",sx:{padding:0,pt:2},children:(0,jsx_runtime.jsx)(Collapse.A,{in:infoAlerts.groupMode,children:(0,jsx_runtime.jsx)(Alert.A,{severity:"info",sx:{width:"100%",position:"relative","& .MuiAlert-icon":{position:"absolute",top:11,left:14},"& .MuiAlert-action":{position:"absolute",top:11,right:20}},onClose:()=>setInfoAlerts("groupMode",!1),children:(0,jsx_runtime.jsxs)(Box.A,{children:[(0,jsx_runtime.jsx)(Typography.A,{variant:"h6",sx:{mb:4,pl:3.7},children:"Group Drag Mode"}),(0,jsx_runtime.jsxs)(Stack.A,{spacing:2,children:[(0,jsx_runtime.jsxs)(Grid.A,{container:!0,spacing:2,alignItems:"flex-start",children:[(0,jsx_runtime.jsx)(Grid.A,{size:{xs:4},children:(0,jsx_runtime.jsxs)(Stack.A,{direction:"row",spacing:1,alignItems:"center",children:[(0,jsx_runtime.jsx)(ControlCamera.A,{}),(0,jsx_runtime.jsx)(Typography.A,{variant:"body1",children:(0,jsx_runtime.jsx)("strong",{children:"MoveGroup"})})]})}),(0,jsx_runtime.jsx)(Grid.A,{size:{xs:8},children:(0,jsx_runtime.jsx)(Typography.A,{variant:"body1",color:"text.secondary",children:"Click and Drag any pixel to move the entire group across the matrix."})})]}),(0,jsx_runtime.jsxs)(Grid.A,{container:!0,spacing:2,alignItems:"flex-start",children:[(0,jsx_runtime.jsx)(Grid.A,{size:{xs:4},children:(0,jsx_runtime.jsxs)(Stack.A,{direction:"row",spacing:1,alignItems:"center",children:[(0,jsx_runtime.jsx)(Gamepad.A,{}),(0,jsx_runtime.jsx)(Typography.A,{variant:"body1",children:(0,jsx_runtime.jsx)("strong",{children:"Manual"})})]})}),(0,jsx_runtime.jsx)(Grid.A,{size:{xs:8},children:(0,jsx_runtime.jsx)(Typography.A,{variant:"body1",color:"text.secondary",children:"Use the Gamepad icon in the action bar for precise, one-cell adjustments."})})]}),(0,jsx_runtime.jsxs)(Grid.A,{container:!0,spacing:2,alignItems:"flex-start",children:[(0,jsx_runtime.jsx)(Grid.A,{size:{xs:4},children:(0,jsx_runtime.jsxs)(Stack.A,{direction:"row",spacing:1,alignItems:"center",children:[(0,jsx_runtime.jsx)(AdsClick.A,{}),(0,jsx_runtime.jsx)(Typography.A,{variant:"body1",children:(0,jsx_runtime.jsx)("strong",{children:"Actions"})})]})}),(0,jsx_runtime.jsx)(Grid.A,{size:{xs:8},children:(0,jsx_runtime.jsx)(Typography.A,{variant:"body1",color:"text.secondary",children:"The Right-Click context menu is always available for other cell actions."})})]})]})]})})})})]})},MControls_DnDModeTabs=DnDModeTabs;DnDModeTabs.__docgenInfo={description:"",methods:[],displayName:"DnDModeTabs"};var Cancel=__webpack_require__("./node_modules/@mui/icons-material/esm/Cancel.js"),EmergencyRecording=__webpack_require__("./node_modules/@mui/icons-material/esm/EmergencyRecording.js"),Loop=__webpack_require__("./node_modules/@mui/icons-material/esm/Loop.js"),Save=__webpack_require__("./node_modules/@mui/icons-material/esm/Save.js"),ledfx=__webpack_require__("./src/api/ledfx.ts");function processArray(inputArray){let gapname=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const outputArray=[];let startPixel=null,endPixel=null,deviceId="",flip=!1,gapStart=null;for(let i=0;i<inputArray.length;i+=1)""!==inputArray[i].deviceId?""===deviceId?(null!==gapStart&&(outputArray.push(["gap-".concat(gapname),gapStart,i-1,!1]),gapStart=null),deviceId=inputArray[i].deviceId,startPixel=inputArray[i].pixel,endPixel=inputArray[i].pixel,flip=!1):inputArray[i].deviceId===deviceId&&1===Math.abs(inputArray[i].pixel-endPixel)?(endPixel=inputArray[i].pixel,flip=inputArray[i].pixel<endPixel):(outputArray.push([deviceId,startPixel,endPixel,flip]),deviceId=inputArray[i].deviceId,startPixel=inputArray[i].pixel,endPixel=inputArray[i].pixel,flip=!1):(""!==deviceId&&(outputArray.push([deviceId,startPixel,endPixel,flip]),deviceId=""),null===gapStart&&(gapStart=i));""!==deviceId&&outputArray.push([deviceId,startPixel,endPixel,flip]),null!==gapStart&&outputArray.push(["gap-".concat(gapname),gapStart,inputArray.length-1,!1]);for(let i=0;i<outputArray.length;i++){const item=outputArray[i];item[1]>item[2]&&(item[3]=item[1]>item[2],[item[1],item[2]]=[item[2],item[1]])}return outputArray}function reverseProcessArray(outputArray,rows){const inputArray=[],finalArray=[];let group="0-0";for(let i=0;i<outputArray.length;i+=1){const[deviceId,startPixel,endPixel,flip]=outputArray[i];if(deviceId.startsWith("gap-"))for(let j=startPixel;j<=endPixel;j+=1)inputArray.push({deviceId:"",pixel:j,group:"0-0"});else if(flip)for(let j=endPixel;j>=startPixel;j-=1)group="".concat(Math.floor(i/(rows||1)),"-").concat(i%(rows||1)),inputArray.push({deviceId,pixel:j,group});else for(let j=startPixel;j<=endPixel;j+=1)group="".concat(Math.floor(i/(rows||1)),"-").concat(i%(rows||1)),inputArray.push({deviceId,pixel:j,group})}if(rows){for(let i=0;i<inputArray.length;i+=rows)finalArray.push(inputArray.slice(i,i+rows));return finalArray}return[inputArray]}const DimensionSliders=_ref=>{let{virtual}=_ref;const getVirtuals=(0,useStore.A)(state=>state.getVirtuals),getDevices=(0,useStore.A)(state=>state.getDevices),addVirtual=(0,useStore.A)(state=>state.addVirtual),virtual2dLimit=(0,useStore.A)(state=>state.ui.virtual2dLimit),{rowN,colN,setRowNumber,setColNumber,m}=useMatrixEditorContext();return(0,jsx_runtime.jsxs)(Stack.A,{direction:"column",justifyContent:"flex-start",alignItems:"flex-start",className:"step-2d-virtual-three",children:[(0,jsx_runtime.jsxs)(Stack.A,{direction:"row",width:400,justifyContent:"space-between",children:[(0,jsx_runtime.jsx)(Typography.A,{width:100,variant:"body1",children:"Rows:"}),(0,jsx_runtime.jsx)(Box.A,{width:250,children:(0,jsx_runtime.jsx)(Slider.Ay,{min:1,max:virtual2dLimit,value:rowN,onChange:(e,newRowNumber)=>"number"==typeof newRowNumber&&setRowNumber(newRowNumber),onChangeCommitted:(e,newRowNumber)=>{"number"==typeof newRowNumber&&addVirtual({id:virtual.id,config:{rows:newRowNumber}}).then(()=>{getVirtuals(),getDevices()}).then(()=>{(0,ledfx.U)("/api/virtuals/".concat(virtual.id),"POST",{segments:processArray(m.flat(),virtual.id)}).then(()=>{getVirtuals(),getDevices()})})}})}),rowN]}),(0,jsx_runtime.jsxs)(Stack.A,{direction:"row",width:400,justifyContent:"space-between",children:[(0,jsx_runtime.jsx)(Typography.A,{width:100,variant:"body1",children:"Columns:"}),(0,jsx_runtime.jsx)(Box.A,{width:250,children:(0,jsx_runtime.jsx)(Slider.Ay,{min:1,max:virtual2dLimit,value:colN,onChange:(e,newColNumber)=>"number"==typeof newColNumber&&setColNumber(newColNumber),onChangeCommitted:()=>{(0,ledfx.U)("/api/virtuals/".concat(virtual.id),"POST",{segments:processArray(m.flat(),virtual.id)}).then(()=>{getVirtuals(),getDevices()})}})}),colN]})]})},MControls_DimensionSliders=DimensionSliders;DimensionSliders.__docgenInfo={description:"",methods:[],displayName:"DimensionSliders",props:{virtual:{required:!0,tsType:{name:"any"},description:""}}};var FormControl=__webpack_require__("./node_modules/@mui/material/esm/FormControl/FormControl.js"),InputLabel=__webpack_require__("./node_modules/@mui/material/esm/InputLabel/InputLabel.js"),react_webcam=__webpack_require__("./node_modules/react-webcam/dist/react-webcam.js"),react_webcam_default=__webpack_require__.n(react_webcam);const utils_calculateImageDifference=function calculateImageDifference(img1,img2){let threshold=arguments.length>2&&void 0!==arguments[2]?arguments[2]:128,ignoreTop=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,ignoreLeft=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,ignoreBottom=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,ignoreRight=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const width=img1.width-ignoreLeft-ignoreRight,height=img1.height-ignoreTop-ignoreBottom,canvas=document.createElement("canvas");canvas.width=width,canvas.height=height;const context=canvas.getContext("2d",{willReadFrequently:!0});if(!context)throw new Error("Could not get 2d context");context.drawImage(img1,ignoreLeft,ignoreTop,width,height,0,0,width,height);const imageData1=context.getImageData(0,0,width,height).data;context.clearRect(0,0,width,height),context.drawImage(img2,ignoreLeft,ignoreTop,width,height,0,0,width,height);const imageData2=context.getImageData(0,0,width,height).data,diffData=new Uint8ClampedArray(width*height*4),whitePixels=[];for(let i=0;i<width*height*4;i+=4){const diffAlpha=255,outputValue=(Math.abs(imageData1[i]-imageData2[i])+Math.abs(imageData1[i+1]-imageData2[i+1])+Math.abs(imageData1[i+2]-imageData2[i+2]))/3>threshold?255:0;if(diffData[i]=outputValue,diffData[i+1]=outputValue,diffData[i+2]=outputValue,diffData[i+3]=diffAlpha,255===outputValue){const x=i/4%width,y=Math.floor(i/4/width);whitePixels.push({x,y})}}const whitePixelsCount=whitePixels.length,whitePixelsCenter=whitePixels.reduce((acc,_ref)=>{let{x,y}=_ref;return{x:acc.x+x,y:acc.y+y}},{x:0,y:0});return whitePixelsCenter.x/=whitePixelsCount,whitePixelsCenter.y/=whitePixelsCount,context.putImageData(new window.ImageData(diffData,width,height),0,0),context.beginPath(),context.arc(whitePixelsCenter.x,whitePixelsCenter.y,5,0,2*Math.PI,!1),context.fillStyle="red",context.fill(),{diffImage:canvas.toDataURL("image/webp"),whitePixelsCenter}};const utils_createImageFromData=async function createImageFromData(imageData){const blob=new Blob([imageData],{type:"image/webp"}),url=URL.createObjectURL(blob),img=new Image;return img.src=url,await new Promise(resolve=>{img.onload=resolve}),img};const utils_decodeBase64ToImageData=function decodeBase64ToImageData(base64String){const base64Data=base64String.split(",")[1],imageData=atob(base64Data),buffer=new Uint8Array(imageData.length);for(let i=0;i<imageData.length;i++)buffer[i]=imageData.charCodeAt(i);return buffer};const utils_adjust=async function adjust(capture,initialImage){let threshold=arguments.length>2&&void 0!==arguments[2]?arguments[2]:128,ignoreTop=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,ignoreLeft=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,ignoreBottom=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,ignoreRight=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,pointsRef=arguments.length>7?arguments[7]:void 0;!async function processImages(img1b64,img2b64){let threshold=arguments.length>2&&void 0!==arguments[2]?arguments[2]:128,ignoreTop=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,ignoreLeft=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,ignoreBottom=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,ignoreRight=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,pointsRef=arguments.length>7?arguments[7]:void 0;try{const imageData1=utils_decodeBase64ToImageData(img1b64),image1=await utils_createImageFromData(imageData1),imageData2=utils_decodeBase64ToImageData(img2b64),image2=await utils_createImageFromData(imageData2),diffData=utils_calculateImageDifference(image1,image2,threshold,ignoreTop,ignoreLeft,ignoreBottom,ignoreRight),diffImageBase64=diffData.diffImage;pointsRef&&(pointsRef.current=diffData.whitePixelsCenter);const diffImageElement=document.getElementById("diffImage");diffImageElement&&diffImageElement instanceof HTMLImageElement&&(diffImageElement.src=diffImageBase64)}catch(error){console.error("Error processing images:",error)}}(initialImage,await capture(),threshold,ignoreTop,ignoreLeft,ignoreBottom,ignoreRight,pointsRef)},utils_wled=async body=>{const wledIp=useStore.A.getState().videoMapper.wledIp;try{const response=await fetch("http://".concat(wledIp,"/json"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(body)});return await response.json()}catch(error){console.error(error)}};const utils_preadjust=async function preadjust(){await utils_wled({on:!0}),await utils_wled({seg:{on:!0,col:[[255,0,0],[255,0,0],[255,0,0]]}})},getLedCount=async wledIp=>{try{const response=await fetch("http://".concat(wledIp,"/json/info"));return(await response.json()).leds.count}catch(error){console.error(error)}};function transpose(inputX,inputY,inputWidth,inputHeight,outputWidth,outputHeight){return{x:Math.floor(inputX/inputWidth*outputWidth),y:Math.floor(inputY/inputHeight*outputHeight)}}const utils_wait=ms=>new Promise(resolve=>setTimeout(resolve,ms)),utils_wledGet=async function(){let path=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"state";const wledIp=useStore.A.getState().videoMapper.wledIp;if(wledIp&&""!==wledIp)try{const response=await fetch("http://".concat(wledIp,"/json/").concat(path));return await response.json()||response}catch(error){console.error(error)}},utils_iterativeOnOnlyOne=async function(waitingTime,pointsRef){let inputWidth=arguments.length>2&&void 0!==arguments[2]?arguments[2]:400,inputHeight=arguments.length>3&&void 0!==arguments[3]?arguments[3]:300,outputWidth=arguments.length>4&&void 0!==arguments[4]?arguments[4]:50,outputHeight=arguments.length>5&&void 0!==arguments[5]?arguments[5]:50,addPoint=arguments.length>6?arguments[6]:void 0,device=arguments.length>7?arguments[7]:void 0;const segments=(await utils_wledGet()).seg;let totalPreviousLength=0;for(const segment of segments){for(let i=0;i<segment.len+1;i++){var _pointsRef$current,_pointsRef$current2;const singleLedOn={seg:{id:segment.id,i:0===i?[i,i+1,"FFFFFF",i+1,segment.len,"000000"]:[0,i,"000000",i,i+1,"FFFFFF",i+1,segment.len,"000000"]}};await utils_wled(singleLedOn);const transposed=transpose(null==pointsRef||null===(_pointsRef$current=pointsRef.current)||void 0===_pointsRef$current?void 0:_pointsRef$current.x,null==pointsRef||null===(_pointsRef$current2=pointsRef.current)||void 0===_pointsRef$current2?void 0:_pointsRef$current2.y,inputWidth,inputHeight,outputWidth,outputHeight);isNaN(transposed.x)||isNaN(transposed.y)||(addPoint((0,objectSpread2.A)((0,objectSpread2.A)({},transposed),{},{segment:segment.id,led:totalPreviousLength+i,device})),await utils_wait(waitingTime))}totalPreviousLength+=segment.len}};const utils_calibrate=async function calibrate(wledIp,waitTime,pointsRef){let inputWidth=arguments.length>3&&void 0!==arguments[3]?arguments[3]:400,inputHeight=arguments.length>4&&void 0!==arguments[4]?arguments[4]:300,outputWidth=arguments.length>5&&void 0!==arguments[5]?arguments[5]:50,outputHeight=arguments.length>6&&void 0!==arguments[6]?arguments[6]:50,setPoints=arguments.length>7?arguments[7]:void 0,addPoint=arguments.length>8?arguments[8]:void 0,device=arguments.length>9?arguments[9]:void 0;const leds=await getLedCount(wledIp);await async function(){let pixels=arguments.length>0&&void 0!==arguments[0]?arguments[0]:69;await utils_wled({seg:{i:[0,pixels,"000000"]}})}(leds),setPoints([]),await utils_iterativeOnOnlyOne(waitTime/7,pointsRef,inputWidth,inputHeight,outputWidth,outputHeight,addPoint,device),await(async()=>{await utils_wled({seg:{on:!0,col:[0,0,0]}})})(),setPoints([])};const utils_initialize=async function initialize(capture){return await utils_wled({seg:{on:!1}}),await utils_wait(1e3),await capture()},utils_oneLed=async led=>{const segments=(await utils_wledGet("state")).seg;let totalLedCount=0;for(const segment of segments){const allLedsOff={seg:{id:segment.id,i:[0,segment.len,"000000"]}};await utils_wled(allLedsOff)}for(const segment of segments)if(totalLedCount+=segment.len,totalLedCount>=led){const ledInSegment=led-(totalLedCount-segment.len),singleLedOn={seg:{id:segment.id,i:[ledInSegment,ledInSegment+1,"FFFFFF"]}};await utils_wled(singleLedOn);break}},utils_setWledBrightness=async function(){let brightness=arguments.length>0&&void 0!==arguments[0]?arguments[0]:255;await utils_wled({bri:brightness})},Webcam=_ref=>{let{colN,rowN,sx}=_ref;const webcamRef=(0,react.useRef)(null),pointsRef=(0,react.useRef)(null),setPoints=(0,useStore.A)(state=>state.setPoints),addPoint=(0,useStore.A)(state=>state.addPoint),devices=(0,useStore.A)(state=>state.devices),wledIps=Object.keys(devices).filter(d=>"wled"===devices[d].type).map(d=>devices[d].config.ip_address),[deviceId,setDeviceId]=(0,react.useState)(""),[mDevices,setMDevices]=(0,react.useState)([]),[ip,setIp]=(0,react.useState)(""),wledIp=(0,useStore.A)(state=>state.videoMapper.wledIp),wledDeviceId=Object.keys(devices).find(d=>devices[d].config.ip_address===wledIp),setWledIp=(0,useStore.A)(state=>state.setWledIp),[threshold,setThreshold]=(0,react.useState)(128),[singleLed,setSingleLed]=(0,react.useState)(0),[baseImage,setBaseImage]=(0,react.useState)(""),[maxLed,setMaxLed]=(0,react.useState)(0),[isAdjusting,setIsAdjusting]=(0,react.useState)(!1),[ignoreTop,setIgnoreTop]=(0,react.useState)(0),[ignoreLeft,setIgnoreLeft]=(0,react.useState)(0),[ignoreBottom,setIgnoreBottom]=(0,react.useState)(0),[ignoreRight,setIgnoreRight]=(0,react.useState)(0),[brightness,setBrightness]=(0,react.useState)(255),isCalibrating=(0,useStore.A)(state=>state.videoMapper.calibrating),setIsCalibrating=(0,useStore.A)(state=>state.setCalibrating),handleDevices=(0,react.useCallback)(mediaDevices=>{const videoDevices=mediaDevices.filter(_ref2=>{let{kind}=_ref2;return"videoinput"===kind});""===deviceId&&videoDevices.length>0&&setDeviceId(videoDevices[0].deviceId),setMDevices(videoDevices)},[setMDevices,deviceId]),capture=(0,react.useCallback)(async()=>{var _webcamRef$current;return null===(_webcamRef$current=webcamRef.current)||void 0===_webcamRef$current?void 0:_webcamRef$current.getScreenshot()},[webcamRef]);return(0,react.useEffect)(()=>{navigator.mediaDevices.enumerateDevices().then(handleDevices)},[handleDevices]),(0,react.useEffect)(()=>{setIp(wledIp)},[wledIp]),(0,react.useEffect)(()=>{(async()=>{if(wledIp&&""!==wledIp){const c=await getLedCount(wledIp);setMaxLed(c)}})()},[wledIp]),(0,react.useEffect)(()=>{let animationFrameId=null,isCancelled=!1;const adjustFrame=async()=>{isAdjusting&&!isCancelled&&(await utils_adjust(capture,baseImage,threshold,ignoreTop,ignoreLeft,ignoreBottom,ignoreRight,pointsRef),animationFrameId=requestAnimationFrame(adjustFrame))};return utils_preadjust(),adjustFrame(),()=>{isCancelled=!0,animationFrameId&&cancelAnimationFrame(animationFrameId)}},[isAdjusting,threshold,baseImage,capture,ignoreTop,ignoreLeft,ignoreBottom,ignoreRight]),(0,react.useEffect)(()=>{isCalibrating&&utils_calibrate(wledIp,100,pointsRef,400-ignoreLeft-ignoreRight,300-ignoreBottom-ignoreTop,colN,rowN,setPoints,addPoint,wledDeviceId).then(()=>{setIsCalibrating(!1)})},[isCalibrating,wledIp,ignoreTop,ignoreLeft,ignoreBottom,ignoreRight,wledDeviceId,colN,rowN,setPoints,addPoint,setIsCalibrating]),(0,jsx_runtime.jsxs)(Stack.A,{direction:"column",spacing:2,sx:(0,objectSpread2.A)({width:400,marginLeft:4},sx),children:[(0,jsx_runtime.jsxs)(FormControl.A,{fullWidth:!0,children:[(0,jsx_runtime.jsx)(InputLabel.A,{id:"wled",children:"WLED Devices"}),wledIps.length>0&&(0,jsx_runtime.jsxs)(Select.A,{variant:"outlined",label:"WLED Devices",labelId:"wled",value:wledIp,onChange:e=>setWledIp(e.target.value),children:[(0,jsx_runtime.jsx)(MenuItem.A,{value:"",disabled:!0,children:"Select WLED Device"},""),wledIps.map(wledip=>(0,jsx_runtime.jsx)(MenuItem.A,{value:wledip,children:wledip},wledip))]})]}),(0,jsx_runtime.jsx)(TextField.A,{fullWidth:!0,sx:{display:"none"},label:"IP",value:ip,onChange:e=>setIp(e.target.value)}),(0,jsx_runtime.jsxs)(FormControl.A,{fullWidth:!0,children:[(0,jsx_runtime.jsx)(InputLabel.A,{id:"camera",children:"Camera"}),(0,jsx_runtime.jsx)(Select.A,{label:"Camera",labelId:"camera",variant:"outlined",value:deviceId,onChange:e=>setDeviceId(e.target.value),children:mDevices.map((device,key)=>(0,jsx_runtime.jsx)(MenuItem.A,{value:device.deviceId,children:device.label||"Device ".concat(key+1)},device.deviceId))})]}),(0,jsx_runtime.jsxs)(Stack.A,{direction:"row",spacing:2,children:[(0,jsx_runtime.jsx)(Button.A,{onClick:async()=>{const img=await utils_initialize(capture);setBaseImage(img)},className:"step-2d-virtual-cam-initialize",children:"Initialize"}),(0,jsx_runtime.jsx)(Button.A,{onClick:()=>setIsAdjusting(!isAdjusting),className:"step-2d-virtual-cam-adjust",children:isAdjusting?"Stop Adjust":"Adjust"}),(0,jsx_runtime.jsx)(Button.A,{disabled:isCalibrating||!isAdjusting,onClick:()=>setIsCalibrating(!0),className:"step-2d-virtual-cam-calibrate",children:isCalibrating?"Calibrating":"Calibrate"})]}),(0,jsx_runtime.jsx)(react_webcam_default(),{ref:webcamRef,width:"100%",mirrored:!1,audio:!1,videoConstraints:{deviceId}}),(0,jsx_runtime.jsx)("br",{}),!isCalibrating&&!isAdjusting&&(0,jsx_runtime.jsxs)(Stack.A,{direction:"column",className:"step-2d-virtual-cam-crop",children:[(0,jsx_runtime.jsxs)(Stack.A,{direction:"row",spacing:2,children:[(0,jsx_runtime.jsx)(Typography.A,{width:120,children:"Cut Top"}),(0,jsx_runtime.jsx)(Slider.Ay,{min:0,max:150,value:ignoreTop,onChange:(_,v)=>setIgnoreTop(v)})]}),(0,jsx_runtime.jsxs)(Stack.A,{direction:"row",spacing:2,children:[(0,jsx_runtime.jsx)(Typography.A,{width:120,children:"Cut Left"}),(0,jsx_runtime.jsx)(Slider.Ay,{min:0,max:200,value:ignoreLeft,onChange:(_,v)=>setIgnoreLeft(v)})]}),(0,jsx_runtime.jsxs)(Stack.A,{direction:"row",spacing:2,children:[(0,jsx_runtime.jsx)(Typography.A,{width:120,children:"Cut Bottom"}),(0,jsx_runtime.jsx)(Slider.Ay,{min:0,max:150,value:ignoreBottom,onChange:(_,v)=>setIgnoreBottom(v)})]}),(0,jsx_runtime.jsxs)(Stack.A,{direction:"row",spacing:2,children:[(0,jsx_runtime.jsx)(Typography.A,{width:120,children:"Cut Right"}),(0,jsx_runtime.jsx)(Slider.Ay,{min:0,max:200,value:ignoreRight,onChange:(_,v)=>setIgnoreRight(v)})]})]}),!isCalibrating&&isAdjusting&&(0,jsx_runtime.jsxs)(Stack.A,{direction:"column",className:"step-2d-virtual-cam-settings",children:[(0,jsx_runtime.jsxs)(Stack.A,{direction:"row",spacing:2,children:[(0,jsx_runtime.jsx)(Typography.A,{width:120,children:"Led"}),(0,jsx_runtime.jsx)(Slider.Ay,{min:0,step:1,max:maxLed,value:singleLed,onChange:(_,v)=>{setSingleLed(v),utils_oneLed(v)}})]}),(0,jsx_runtime.jsxs)(Stack.A,{direction:"row",spacing:2,children:[(0,jsx_runtime.jsx)(Typography.A,{width:120,children:"Brightness"}),(0,jsx_runtime.jsx)(Slider.Ay,{min:0,max:255,value:brightness,onChange:(_,v)=>{setBrightness(v),utils_setWledBrightness(v)}})]}),(0,jsx_runtime.jsxs)(Stack.A,{direction:"row",spacing:2,children:[(0,jsx_runtime.jsx)(Typography.A,{width:120,children:"Threshold"}),(0,jsx_runtime.jsx)(Slider.Ay,{min:0,max:255,value:threshold,onChange:(_,v)=>setThreshold(v)})]})]}),!isAdjusting&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("br",{}),"Base Image:",(0,jsx_runtime.jsxs)("div",{style:{position:"relative",margin:0,height:300},children:[(0,jsx_runtime.jsx)("img",{src:baseImage,alt:"baseImage"},"baseImage"),(0,jsx_runtime.jsx)("div",{style:{position:"absolute",top:0,left:0,bottom:0,right:400-ignoreLeft,background:"#444"}}),(0,jsx_runtime.jsx)("div",{style:{position:"absolute",top:300-ignoreBottom,left:0,bottom:0,right:0,background:"#444"}}),(0,jsx_runtime.jsx)("div",{style:{position:"absolute",top:0,left:0,bottom:300-ignoreTop,right:0,background:"#444"}}),(0,jsx_runtime.jsx)("div",{style:{position:"absolute",top:0,left:400-ignoreRight,bottom:0,right:0,background:"#444"}})]})]}),isAdjusting&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Diff Image:",(0,jsx_runtime.jsx)("img",{id:"diffImage",alt:"diff"})]})]})},Webcam_Webcam=Webcam;Webcam.__docgenInfo={description:"",methods:[],displayName:"Webcam",props:{colN:{required:!0,tsType:{name:"number"},description:""},rowN:{required:!0,tsType:{name:"number"},description:""},sx:{required:!1,tsType:{name:"SxProps"},description:""}}};var ArrowUpward=__webpack_require__("./node_modules/@mui/icons-material/esm/ArrowUpward.js"),ArrowBack=__webpack_require__("./node_modules/@mui/icons-material/esm/ArrowBack.js"),ArrowForward=__webpack_require__("./node_modules/@mui/icons-material/esm/ArrowForward.js"),ArrowDownward=__webpack_require__("./node_modules/@mui/icons-material/esm/ArrowDownward.js");const Actions_moveSelectedGroupUp=_ref=>{let{m,selectedGroup,setError,setM}=_ref;const groupPixels=[];for(let i=0;i<m.length;i++)for(let j=0;j<m[i].length;j++)if(m[i][j].group===selectedGroup){if(i-1<0)return void console.log("Move aborted: group is at the top edge.");groupPixels.push((0,objectSpread2.A)((0,objectSpread2.A)({},m[i][j]),{},{oldRow:i,oldCol:j}))}if(0===groupPixels.length)return;const conflictingCells=[];for(const pixel of groupPixels){const targetRow=pixel.oldRow-1,targetCol=pixel.oldCol,targetCell=m[targetRow][targetCol];""!==targetCell.deviceId&&targetCell.group!==selectedGroup&&conflictingCells.push({row:targetRow,col:targetCol})}if(conflictingCells.length>0)return setError(conflictingCells),void console.log("Move aborted: collision detected with an external pixel.");setError([]);const updatedM=clone(m);for(const pixel of groupPixels)updatedM[pixel.oldRow][pixel.oldCol]={deviceId:"",pixel:0,group:""};for(const pixel of groupPixels){const targetRow=pixel.oldRow-1,targetCol=pixel.oldCol;updatedM[targetRow][targetCol]={deviceId:pixel.deviceId,pixel:pixel.pixel,group:pixel.group}}setM(updatedM)},Actions_moveSelectedGroupLeft=_ref=>{let{m,selectedGroup,setM}=_ref;const groupPixels=[];for(let i=0;i<m.length;i++)for(let j=0;j<m[i].length;j++)if(m[i][j].group===selectedGroup){if(j-1<0)return void console.log("Move aborted: group is at the left edge.");groupPixels.push((0,objectSpread2.A)((0,objectSpread2.A)({},m[i][j]),{},{oldRow:i,oldCol:j}))}if(0===groupPixels.length)return;for(const pixel of groupPixels){const targetRow=pixel.oldRow,targetCol=pixel.oldCol-1,targetCell=m[targetRow][targetCol];if(""!==targetCell.deviceId&&targetCell.group!==selectedGroup)return void console.log("Move aborted: collision detected with an external pixel.")}const updatedM=clone(m);for(const pixel of groupPixels)updatedM[pixel.oldRow][pixel.oldCol]={deviceId:"",pixel:0,group:""};for(const pixel of groupPixels){const targetRow=pixel.oldRow,targetCol=pixel.oldCol-1;updatedM[targetRow][targetCol]={deviceId:pixel.deviceId,pixel:pixel.pixel,group:pixel.group}}setM(updatedM)},Actions_moveSelectedGroupRight=_ref=>{let{m,colN,selectedGroup,setM}=_ref;const groupPixels=[];for(let i=0;i<m.length;i++)for(let j=0;j<m[i].length;j++)if(m[i][j].group===selectedGroup){if(j+1>=colN)return void console.log("Move aborted: group is at the right edge.");groupPixels.push((0,objectSpread2.A)((0,objectSpread2.A)({},m[i][j]),{},{oldRow:i,oldCol:j}))}if(0===groupPixels.length)return;for(const pixel of groupPixels){const targetRow=pixel.oldRow,targetCol=pixel.oldCol+1,targetCell=m[targetRow][targetCol];if(""!==targetCell.deviceId&&targetCell.group!==selectedGroup)return void console.log("Move aborted: collision detected with an external pixel.")}const updatedM=clone(m);for(const pixel of groupPixels)updatedM[pixel.oldRow][pixel.oldCol]={deviceId:"",pixel:0,group:""};for(const pixel of groupPixels){const targetRow=pixel.oldRow,targetCol=pixel.oldCol+1;updatedM[targetRow][targetCol]={deviceId:pixel.deviceId,pixel:pixel.pixel,group:pixel.group}}setM(updatedM)},Actions_moveSelectedGroupDown=_ref=>{let{m,rowN,selectedGroup,setError,setM}=_ref;const groupPixels=[];for(let i=0;i<rowN;i++)for(let j=0;j<m[i].length;j++)if(m[i][j].group===selectedGroup){if(i+1>=rowN)return void console.log("Move aborted: group is at the bottom edge.");groupPixels.push((0,objectSpread2.A)((0,objectSpread2.A)({},m[i][j]),{},{oldRow:i,oldCol:j}))}if(0===groupPixels.length)return;const conflictingCells=[];for(const pixel of groupPixels){const targetRow=pixel.oldRow+1,targetCol=pixel.oldCol,targetCell=m[targetRow][targetCol];""!==targetCell.deviceId&&targetCell.group!==selectedGroup&&conflictingCells.push({row:targetRow,col:targetCol})}if(conflictingCells.length>0)return setError(conflictingCells),void console.log("Move aborted: collision detected with an external pixel.");setError([]);const updatedM=clone(m);for(const pixel of groupPixels)updatedM[pixel.oldRow][pixel.oldCol]={deviceId:"",pixel:0,group:""};for(const pixel of groupPixels){const targetRow=pixel.oldRow+1,targetCol=pixel.oldCol;updatedM[targetRow][targetCol]={deviceId:pixel.deviceId,pixel:pixel.pixel,group:pixel.group}}setM(updatedM)},GroupControls=()=>{const{m,rowN,colN,selectedGroup,setSelectedGroup,setM,setError,uniqueGroups}=useMatrixEditorContext();return 0===uniqueGroups.length?null:(0,jsx_runtime.jsxs)(Box.A,{children:[(0,jsx_runtime.jsxs)(FormControl.A,{fullWidth:!0,sx:{mt:2,mb:1},children:[(0,jsx_runtime.jsx)(InputLabel.A,{id:"group-select-label",children:"Move Group"}),(0,jsx_runtime.jsxs)(Select.A,{variant:"outlined",labelId:"group-select-label",id:"group-select",value:selectedGroup||"",label:"Move Group",onChange:e=>setSelectedGroup(e.target.value),children:[(0,jsx_runtime.jsx)(MenuItem.A,{value:"",children:(0,jsx_runtime.jsx)("em",{children:"None"})}),uniqueGroups.map(group=>(0,jsx_runtime.jsx)(MenuItem.A,{value:group,children:group},group))]})]}),(0,jsx_runtime.jsxs)(Stack.A,{direction:"column",spacing:0,alignItems:"center",justifyContent:"center",children:[(0,jsx_runtime.jsx)(IconButton.A,{disabled:!selectedGroup,onClick:()=>Actions_moveSelectedGroupUp({m,rowN,colN,selectedGroup,setError,setM}),children:(0,jsx_runtime.jsx)(ArrowUpward.A,{})}),(0,jsx_runtime.jsxs)(Stack.A,{direction:"row",spacing:0,justifyContent:"center",children:[(0,jsx_runtime.jsx)(IconButton.A,{disabled:!selectedGroup,onClick:()=>Actions_moveSelectedGroupLeft({m,rowN,colN,selectedGroup,setM}),children:(0,jsx_runtime.jsx)(ArrowBack.A,{})}),(0,jsx_runtime.jsx)(IconButton.A,{disabled:!selectedGroup,onClick:()=>setSelectedGroup(""),children:(0,jsx_runtime.jsx)(Cancel.A,{})}),(0,jsx_runtime.jsx)(IconButton.A,{disabled:!selectedGroup,onClick:()=>Actions_moveSelectedGroupRight({m,rowN,colN,selectedGroup,setM}),children:(0,jsx_runtime.jsx)(ArrowForward.A,{})})]}),(0,jsx_runtime.jsx)(IconButton.A,{disabled:!selectedGroup,onClick:()=>Actions_moveSelectedGroupDown({m,rowN,colN,selectedGroup,setError,setM}),children:(0,jsx_runtime.jsx)(ArrowDownward.A,{})})]})]})},MControls_GroupControls=GroupControls;GroupControls.__docgenInfo={description:"",methods:[],displayName:"GroupControls"};var yz_dev_react_dynamic_module_es=__webpack_require__("./node_modules/@yz-dev/react-dynamic-module/dist/yz-dev-react-dynamic-module.es.js");const Transition=(0,react.forwardRef)(function Transition(props,ref){return(0,jsx_runtime.jsx)(Slide.A,(0,objectSpread2.A)({direction:"up",ref},props))}),MatrixStudioButton=_ref=>{let{defaultValue,deviceList,handleSave}=_ref;const[open,setOpen]=(0,react.useState)(!1),{status,as:MatrixStudio}=(0,yz_dev_react_dynamic_module_es.z)({src:"/modules/yz-matrix-studio.js",from:"YzMatrixStudio",import:"MatrixStudio"});return MatrixStudio&&"available"===status?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(IconButton.A,{size:"large",onClick:()=>{setOpen(!0)},children:(0,jsx_runtime.jsx)(BladeIcon.A,{name:"yz:logo2"})}),(0,jsx_runtime.jsx)(Dialog.A,{fullScreen:!0,open,onClose:()=>{setOpen(!1)},slots:{transition:Transition},children:(0,jsx_runtime.jsx)(MatrixStudio,{defaultValue,deviceList,onSave:e=>{handleSave&&handleSave(e),setOpen(!1)}})})]}):null},MatrixStudio=MatrixStudioButton;MatrixStudioButton.__docgenInfo={description:"",methods:[],displayName:"MatrixStudioButton",props:{defaultValue:{required:!1,tsType:{name:"union",raw:"IMCell[][] | undefined",elements:[{name:"Array",elements:[{name:"Array",elements:[{name:"signature",type:"object",raw:"{\n  deviceId: string\n  pixel: number\n  group?: string\n}",signature:{properties:[{key:"deviceId",value:{name:"string",required:!0}},{key:"pixel",value:{name:"number",required:!0}},{key:"group",value:{name:"string",required:!1}}]}}],raw:"IMCell[]"}],raw:"IMCell[][]"},{name:"undefined"}]},description:""},deviceList:{required:!1,tsType:{name:"union",raw:"IDevice[] | undefined",elements:[{name:"Array",elements:[{name:"IDevice"}],raw:"IDevice[]"},{name:"undefined"}]},description:""},handleSave:{required:!1,tsType:{name:"signature",type:"function",raw:"(data: any) => void",signature:{arguments:[{type:{name:"any"},name:"data"}],return:{name:"void"}}},description:""}}};const MActionBar=_ref=>{let{virtual,camMapper,setCamMapper,m,setM}=_ref;const{showPixelGraph,setShowPixelGraph,resetMatrix,clearMatrix,saveMatrix,rowN,colN,uniqueGroups}=useMatrixEditorContext(),[showSliders,setShowSliders]=(0,react.useState)(!1),[showGroupMove,setShowGroupMove]=(0,react.useState)(!1),features=(0,useStore.A)(state=>state.features),getDevices=(0,useStore.A)(state=>state.getDevices),devices=(0,useStore.A)(state=>state.devices),virtuals=(0,useStore.A)(state=>state.virtuals),virtualOrder=(0,useStore.A)(state=>state.virtualOrder),pendingMatrixLayout=(0,useStore.A)(state=>state.ui.pendingMatrixLayout),setPendingMatrixLayout=(0,useStore.A)(state=>state.ui.setPendingMatrixLayout),showSnackbar=(0,useStore.A)(state=>state.ui.showSnackbar),virtualEditorIsDirty=(0,useStore.A)(state=>state.virtualEditorIsDirty),setVirtualEditorIsDirty=(0,useStore.A)(state=>state.setVirtualEditorIsDirty),setExternalEditorOpen=(0,useStore.A)(state=>state.setExternalEditorOpen),setExternalStudioRef=(0,useStore.A)(state=>state.setExternalStudioRef),studioData=(0,react.useMemo)(()=>{const deviceIdToVirtualIdMap=new Map;Object.values(virtuals).forEach(v=>{v.is_device&&deviceIdToVirtualIdMap.set(v.is_device,v.id)});const virtualIdToOrderMap=new Map;return virtualOrder.forEach(vo=>{virtualIdToOrderMap.set(vo.virtId,vo.order)}),{name:virtual.id,matrixData:m,deviceList:Object.entries(devices).filter(_ref2=>{let[id,device]=_ref2;return void 0!==device.config.pixel_count&&!id.startsWith("gap-")&&["mask","foreground","background"].every(suffix=>!id.endsWith(suffix))}).map(_ref3=>{let[id,device]=_ref3;const virtualId=deviceIdToVirtualIdMap.get(id),order=virtualId?virtualIdToOrderMap.get(virtualId):void 0;return{deviceId:id,count:device.config.pixel_count,name:device.config.name||id,order}})}},[virtual.id,m,devices,virtualOrder,virtuals]);(0,react.useEffect)(()=>{pendingMatrixLayout&&(setM(pendingMatrixLayout.matrixData),showSnackbar("success","Matrix layout imported!"),setPendingMatrixLayout(null))},[pendingMatrixLayout]),(0,react.useEffect)(()=>{const handleEditorUpdate=event=>{if("https://studio.ledfx.stream"!==event.origin&&event.origin!==window.location.origin&&"https://yeonv.github.io"!==event.origin&&"https://studio.ledfx.stream"!==event.origin)return void console.warn("Received message from unknown origin: ".concat(event.origin,". Expected: ").concat("https://studio.ledfx.stream"));const data=event.data;data&&Array.isArray(data.matrixData)&&"MatrixStudio"===data.source&&(setExternalStudioRef(null),setM(data.matrixData),showSnackbar("success","Matrix layout updated!"),setExternalEditorOpen(!1))};return window.addEventListener("message",handleEditorUpdate),()=>window.removeEventListener("message",handleEditorUpdate)},[setM,showSnackbar,setExternalEditorOpen,setExternalStudioRef]);const mountTimeRef=(0,react.useRef)(Date.now());return(0,react.useEffect)(()=>{var _m$;if(!(Date.now()-mountTimeRef.current>3e3)&&m.length>0&&(null===(_m$=m[0])||void 0===_m$?void 0:_m$.length)>0){(null==m?void 0:m.every(row=>row.every(cell=>""===cell.deviceId)))&&resetMatrix()}},[m]),(0,jsx_runtime.jsxs)(Box.A,{children:[(0,jsx_runtime.jsx)(Collapse.A,{in:camMapper,children:camMapper&&(0,jsx_runtime.jsx)(Box.A,{sx:{pt:2,pl:2,borderTop:1,borderColor:"divider",backgroundColor:"background.paper"},children:(0,jsx_runtime.jsx)(Webcam_Webcam,{rowN,colN})})}),(0,jsx_runtime.jsx)(Collapse.A,{in:showGroupMove,children:(0,jsx_runtime.jsx)(Box.A,{sx:{p:1,borderTop:1,borderColor:"divider",backgroundColor:"background.paper"},children:(0,jsx_runtime.jsx)(MControls_GroupControls,{})})}),(0,jsx_runtime.jsx)(Collapse.A,{in:showSliders,children:(0,jsx_runtime.jsx)(Box.A,{sx:{pt:2,pl:2,borderTop:1,borderColor:"divider",backgroundColor:"background.paper"},children:(0,jsx_runtime.jsx)(MControls_DimensionSliders,{virtual})})}),(0,jsx_runtime.jsx)(Box.A,{sx:{p:.5,borderTop:1,borderColor:"divider",backgroundColor:"background.paper"},children:(0,jsx_runtime.jsxs)(Stack.A,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[(0,jsx_runtime.jsxs)(Stack.A,{direction:"row",spacing:.5,children:[(0,jsx_runtime.jsx)(Tooltip.A,{title:showSliders?"Exit Resize":virtualEditorIsDirty?"Cannot Resize with Unsaved Changes":"Resize Matrix",children:(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsx)(IconButton.A,{size:"large",onClick:()=>setShowSliders(!showSliders),disabled:virtualEditorIsDirty,children:showSliders?(0,jsx_runtime.jsx)(Cancel.A,{}):(0,jsx_runtime.jsx)(Settings.A,{})})})}),features.matrix_cam&&(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(Tooltip.A,{title:camMapper?"Exit CameraMapper":"Map Pixels via Camera",children:(0,jsx_runtime.jsx)(IconButton.A,{className:"step-2d-virtual-cam-toggle",size:"large",onClick:()=>{getDevices(),setCamMapper(!camMapper)},children:camMapper?(0,jsx_runtime.jsx)(Cancel.A,{}):(0,jsx_runtime.jsx)(EmergencyRecording.A,{})})})}),uniqueGroups.length>0&&(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(Tooltip.A,{title:showGroupMove?"Exit Group Movement":"Move Groups via Buttons",children:(0,jsx_runtime.jsx)(IconButton.A,{size:"large",onClick:()=>setShowGroupMove(!showGroupMove),children:showGroupMove?(0,jsx_runtime.jsx)(Cancel.A,{}):(0,jsx_runtime.jsx)(Gamepad.A,{})})})}),(0,jsx_runtime.jsx)(Divider.A,{orientation:"vertical",flexItem:!0}),(0,jsx_runtime.jsx)(Tooltip.A,{title:"Edit in MatrixStudio (external)",children:(0,jsx_runtime.jsx)(IconButton.A,{size:"large",onClick:()=>{const url="https://studio.ledfx.stream";setExternalEditorOpen(!0);const newWindow=window.open(url,"_blank");setTimeout(()=>{newWindow?(setExternalStudioRef(newWindow),newWindow.postMessage((0,objectSpread2.A)((0,objectSpread2.A)({},studioData),{},{source:"LedFx"}),url)):(showSnackbar("error","Failed to open MatrixStudio. Please check your popup blocker."),setExternalEditorOpen(!1))},500)},children:(0,jsx_runtime.jsx)(BladeIcon.A,{name:"yz:logo2"})})}),(0,jsx_runtime.jsx)(MatrixStudio,{defaultValue:null==studioData?void 0:studioData.matrixData,deviceList:null==studioData?void 0:studioData.deviceList,handleSave:data=>{setM(data)}}),(0,jsx_runtime.jsx)(Divider.A,{orientation:"vertical",flexItem:!0})]}),(0,jsx_runtime.jsxs)(Stack.A,{direction:"row",spacing:.5,children:[(0,jsx_runtime.jsx)(Tooltip.A,{title:showPixelGraph?"Hide Live Preview":"Show Live Preview",children:(0,jsx_runtime.jsx)(IconButton.A,{size:"large",onClick:()=>setShowPixelGraph(!showPixelGraph),children:showPixelGraph?(0,jsx_runtime.jsx)(Stop.A,{}):(0,jsx_runtime.jsx)(PlayArrow.A,{})})}),(0,jsx_runtime.jsx)(Tooltip.A,{title:"Reset to last saved state",children:(0,jsx_runtime.jsx)(IconButton.A,{size:"large",onClick:resetMatrix,disabled:!virtualEditorIsDirty,children:(0,jsx_runtime.jsx)(Loop.A,{})})}),(0,jsx_runtime.jsx)(Tooltip.A,{title:"Clear Matrix",children:(0,jsx_runtime.jsx)(IconButton.A,{size:"large",onClick:clearMatrix,children:(0,jsx_runtime.jsx)(Delete.A,{})})}),(0,jsx_runtime.jsx)(Tooltip.A,{title:"Save Changes",children:(0,jsx_runtime.jsx)(IconButton.A,{color:virtualEditorIsDirty?"error":"inherit",size:"large",onClick:()=>{setVirtualEditorIsDirty(!1),saveMatrix()},children:(0,jsx_runtime.jsx)(Save.A,{})})})]})]})})]})},MControls_MActionBar=MActionBar;MActionBar.__docgenInfo={description:"",methods:[],displayName:"MActionBar",props:{virtual:{required:!0,tsType:{name:"any"},description:""},camMapper:{required:!0,tsType:{name:"boolean"},description:""},setCamMapper:{required:!0,tsType:{name:"any"},description:""},m:{required:!0,tsType:{name:"any"},description:""},setM:{required:!0,tsType:{name:"any"},description:""}}};const MControls=_ref=>{let{virtual,m,setM}=_ref;const[camMapper,setCamMapper]=(0,react.useState)(!1),setPixelGraphs=(0,useStore.A)(state=>state.setPixelGraphs),graphs=(0,useStore.A)(state=>state.graphs),graphsMulti=(0,useStore.A)(state=>state.graphsMulti),virtuals=(0,useStore.A)(state=>state.virtuals),showComplex=(0,useStore.A)(state=>state.showComplex),showGaps=(0,useStore.A)(state=>state.showGaps),{showPixelGraph}=useMatrixEditorContext();return(0,react.useEffect)(()=>(virtual.id&&showPixelGraph?setPixelGraphs([virtual.id]):setPixelGraphs([]),()=>{graphs&&graphsMulti&&setPixelGraphs(Object.keys(virtuals).filter(v=>showComplex?v:!(v.endsWith("-mask")||v.endsWith("-foreground")||v.endsWith("-background"))).filter(v=>showGaps?v:!v.startsWith("gap-")))}),[virtual.id,showPixelGraph,setPixelGraphs,graphs,graphsMulti,virtuals,showComplex,showGaps]),(0,jsx_runtime.jsxs)(Stack.A,{width:480,height:"100%",direction:"column",spacing:2,p:0,children:[(0,jsx_runtime.jsx)(Box.A,{sx:{flexGrow:1,overflowY:"auto",p:1},children:(0,jsx_runtime.jsx)(Collapse.A,{in:!camMapper,children:(0,jsx_runtime.jsx)(MControls_DnDModeTabs,{})})}),(0,jsx_runtime.jsx)(MControls_MActionBar,{virtual,camMapper,setCamMapper,m,setM})]})},MControls_MControls=MControls;function Droppable(_ref){let{id,children,cell,bg="transparent",opacity=1,onContextMenu,onClick}=_ref;const{isOver,setNodeRef}=(0,core_esm.zM)({id}),style={opacity,background:isOver?""===(null==cell?void 0:cell.deviceId)?"rgba(0, 255, 0, 0.1)":"rgba(255, 0, 0, 0.1)":bg},classes=M_styles();return(0,jsx_runtime.jsx)("div",{ref:setNodeRef,style,className:classes.gridCell,onContextMenu,onClick,children})}MControls.__docgenInfo={description:"",methods:[],displayName:"MControls",props:{virtual:{required:!0,tsType:{name:"any"},description:""},m:{required:!0,tsType:{name:"any"},description:""},setM:{required:!0,tsType:{name:"any"},description:""}}};const EditMatrix_Droppable=Droppable;Droppable.__docgenInfo={description:"",methods:[],displayName:"Droppable",props:{id:{required:!0,tsType:{name:"string"},description:""},children:{required:!0,tsType:{name:"ReactReactNode",raw:"React.ReactNode"},description:""},cell:{required:!1,tsType:{name:"signature",type:"object",raw:"{\n  deviceId: string\n  pixel: number\n  group?: string\n}",signature:{properties:[{key:"deviceId",value:{name:"string",required:!0}},{key:"pixel",value:{name:"number",required:!0}},{key:"group",value:{name:"string",required:!1}}]}},description:""},bg:{required:!1,tsType:{name:"string"},description:"",defaultValue:{value:"'transparent'",computed:!1}},opacity:{required:!1,tsType:{name:"number"},description:"",defaultValue:{value:"1",computed:!1}},onContextMenu:{required:!1,tsType:{name:"union",raw:"React.MouseEventHandler<HTMLDivElement> | undefined",elements:[{name:"ReactMouseEventHandler",raw:"React.MouseEventHandler<HTMLDivElement>",elements:[{name:"HTMLDivElement"}]},{name:"undefined"}]},description:""},onClick:{required:!1,tsType:{name:"union",raw:"React.MouseEventHandler<HTMLDivElement> | undefined",elements:[{name:"ReactMouseEventHandler",raw:"React.MouseEventHandler<HTMLDivElement>",elements:[{name:"HTMLDivElement"}]},{name:"undefined"}]},description:""}}};const Draggable_excluded=["children","id"];function Draggable(_ref){let{children,id}=_ref,props=(0,objectWithoutProperties.A)(_ref,Draggable_excluded);const{attributes,listeners,setNodeRef,transform}=(0,core_esm.PM)({id}),style=transform?{width:"100px",transform:"translate3d(".concat(transform.x,"px, ").concat(transform.y,"px, 0)")}:void 0;return(0,jsx_runtime.jsx)("div",(0,objectSpread2.A)((0,objectSpread2.A)((0,objectSpread2.A)((0,objectSpread2.A)({type:"button",ref:setNodeRef,style},props),listeners),attributes),{},{children}))}const EditMatrix_Draggable=Draggable;Draggable.__docgenInfo={description:"",methods:[],displayName:"Draggable"};const Pixel=_ref=>{var _devices$yzcolumn$dev,_devices$yzcolumn$dev2;let{classes,yzcolumn}=_ref;const theme=(0,useTheme.A)(),devices=(0,useStore.A)(state=>state.devices),{selectedGroup,isDragging,dndMode}=useMatrixEditorContext(),isSelected=yzcolumn.group&&yzcolumn.group===selectedGroup,isGroupActive="group"===dndMode&&isSelected,deviceName=null!==(_devices$yzcolumn$dev=null===(_devices$yzcolumn$dev2=devices[yzcolumn.deviceId])||void 0===_devices$yzcolumn$dev2?void 0:_devices$yzcolumn$dev2.config.name)&&void 0!==_devices$yzcolumn$dev?_devices$yzcolumn$dev:"Unknown Device";return(0,jsx_runtime.jsx)(Box.A,{children:""!==yzcolumn.deviceId?(0,jsx_runtime.jsxs)(Box.A,{className:classes.pixel,sx:(()=>{const styles=(0,objectSpread2.A)((0,objectSpread2.A)({},classes.pixel),{},{transition:"all 0.2s ease-in-out"});return isGroupActive?(styles.borderColor=theme.palette.primary.light,styles.boxShadow="inset 0 0 8px 2px ".concat(theme.palette.primary.main)):isSelected&&(styles.borderColor=theme.palette.primary.main),isDragging?styles.opacity="group"===dndMode?isSelected?1:.2:.6:"group"===dndMode&&selectedGroup&&(styles.opacity=isSelected?1:.4),styles})(),children:[(0,jsx_runtime.jsx)(Typography.A,{variant:"caption",noWrap:!0,title:deviceName,children:deviceName}),(0,jsx_runtime.jsx)(Typography.A,{variant:"caption",children:yzcolumn.pixel})]}):(0,jsx_runtime.jsx)(Box.A,{className:classes.pixel,sx:{borderColor:"transparent",background:"transparent"}})})},EditMatrix_Pixel=Pixel;Pixel.__docgenInfo={description:"",methods:[],displayName:"Pixel",props:{classes:{required:!0,tsType:{name:"any"},description:""},yzcolumn:{required:!0,tsType:{name:"signature",type:"object",raw:"{\n  deviceId: string\n  pixel: number\n  group?: string\n}",signature:{properties:[{key:"deviceId",value:{name:"string",required:!0}},{key:"pixel",value:{name:"number",required:!0}},{key:"group",value:{name:"string",required:!1}}]}},description:""}}};var Menu=__webpack_require__("./node_modules/@mui/material/esm/Menu/Menu.js");const MContextMenu=_ref=>{var _m$row;let{anchorEl,closeContextMenu,currentCell,onEdit}=_ref;const{m,setDnd,setDndMode,clearPixel,clearPixelGroup,setSelectedGroup}=useMatrixEditorContext(),contextMenuOpen=Boolean(anchorEl),[col,row]=currentCell,cellData=null===(_m$row=m[row])||void 0===_m$row?void 0:_m$row[col];return(0,jsx_runtime.jsxs)(Menu.A,{id:"basic-menu",anchorEl,open:contextMenuOpen,onClose:closeContextMenu,onContextMenu:e=>{e.preventDefault(),closeContextMenu()},children:[(0,jsx_runtime.jsx)(MenuItem.A,{onClick:onEdit,children:"Edit"}),(0,jsx_runtime.jsx)(MenuItem.A,{onClick:()=>{null!=cellData&&cellData.group&&(setSelectedGroup(cellData.group),setDnd(!0)),closeContextMenu()},children:"Move Pixel in DND"}),(0,jsx_runtime.jsx)(MenuItem.A,{onClick:()=>{null!=cellData&&cellData.group&&(setSelectedGroup(cellData.group),setDndMode("group")),closeContextMenu()},children:"Move Group"}),(0,jsx_runtime.jsx)(MenuItem.A,{onClick:()=>{clearPixel(currentCell),closeContextMenu()},children:"Clear Pixel"}),(0,jsx_runtime.jsx)(MenuItem.A,{onClick:()=>{null!=cellData&&cellData.group&&clearPixelGroup(cellData.group),closeContextMenu()},children:"Clear Group"})]})},EditMatrix_MContextMenu=MContextMenu;MContextMenu.__docgenInfo={description:"",methods:[],displayName:"MContextMenu",props:{anchorEl:{required:!0,tsType:{name:"union",raw:"HTMLElement | null",elements:[{name:"HTMLElement"},{name:"null"}]},description:""},closeContextMenu:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},currentCell:{required:!0,tsType:{name:"tuple",raw:"[number, number]",elements:[{name:"number"},{name:"number"}]},description:""},onEdit:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""}}};const MDialogTitle=_ref=>{var _m$currentCell$1$curr;let{currentCell,m}=_ref;const classes=M_styles();return(0,jsx_runtime.jsx)(DialogTitle.A,{children:(0,jsx_runtime.jsxs)("div",{className:classes.centered,children:[currentCell[1]>=0&&currentCell[0]>=0&&""!==(null===(_m$currentCell$1$curr=m[currentCell[1]][currentCell[0]])||void 0===_m$currentCell$1$curr?void 0:_m$currentCell$1$curr.deviceId)?"Edit":"Assign"," ","Pixel",(0,jsx_runtime.jsxs)(Typography.A,{variant:"caption",align:"right",children:["Row: ",currentCell[1]+1,(0,jsx_runtime.jsx)("br",{}),"Column: ",currentCell[0]+1]})]})})},EditMatrix_MDialogTitle=MDialogTitle;MDialogTitle.__docgenInfo={description:"",methods:[],displayName:"MDialogTitle",props:{currentCell:{required:!0,tsType:{name:"Array",elements:[{name:"number"}],raw:"number[]"},description:""},m:{required:!0,tsType:{name:"Array",elements:[{name:"any"}],raw:"any[]"},description:""}}};var Switch=__webpack_require__("./node_modules/@mui/material/esm/Switch/Switch.js");const MSwitch=_ref=>{let{group,setGroup}=_ref;return(0,jsx_runtime.jsxs)(BladeFrame.A,{title:"Group",style:{justifyContent:"space-between",paddingRight:2,marginBottom:"1rem"},children:[(0,jsx_runtime.jsx)(Typography.A,{children:"Assign multiple"}),(0,jsx_runtime.jsx)(Switch.A,{checked:group,onClick:()=>setGroup(!group)})]})},EditMatrix_MSwitch=MSwitch;MSwitch.__docgenInfo={description:"",methods:[],displayName:"MSwitch"};var Chip=__webpack_require__("./node_modules/@mui/material/esm/Chip/Chip.js");const right=__webpack_require__.p+"static/media/right.4437fb1e43fe564bd36af3f80b309a8c.svg";const right_snake=__webpack_require__.p+"static/media/right-snake.48646339a693661b2cbfb01036d4347d.svg";const right_flip=__webpack_require__.p+"static/media/right-flip.333ebf75f0fd0acb954b88d922e3ac19.svg";const right_snake_flip=__webpack_require__.p+"static/media/right-snake-flip.b3333c6771d73adb6415dfe752af3c80.svg";const bottom=__webpack_require__.p+"static/media/bottom.79f0473144db3f40a3b90b0889337363.svg";const bottom_flip=__webpack_require__.p+"static/media/bottom-flip.ca351932435166e77b4f79d8f60bc19e.svg";const bottom_snake=__webpack_require__.p+"static/media/bottom-snake.9b9a83d44ad5de6f52df46864a7815b8.svg";const bottom_snake_flip=__webpack_require__.p+"static/media/bottom-snake-flip.31c9ebc7594a96a686cf410bc65371dd.svg";const left=__webpack_require__.p+"static/media/left.6fc7083f4cd641bf654b08a26f944457.svg";const left_snake=__webpack_require__.p+"static/media/left-snake.77e313afd0b58fc57bc1b98df60eacfd.svg";const left_flip=__webpack_require__.p+"static/media/left-flip.e480ec339cb34df32d7412153a07216e.svg";const left_snake_flip=__webpack_require__.p+"static/media/left-snake-flip.866a1a9f220801e888735cdfa6f22698.svg";const assets_top=__webpack_require__.p+"static/media/top.6afc5413907a8835fb28c65c2927530e.svg";const top_right=__webpack_require__.p+"static/media/top-right.743c4f79f4eccef25cf772c7665c2cf7.svg";const bottom_right=__webpack_require__.p+"static/media/bottom-right.4dce284267cee3a5fd26be79e2f0150f.svg";const bottom_left=__webpack_require__.p+"static/media/bottom-left.c848fedc2cf975a03639f873c701251d.svg";const top_left=__webpack_require__.p+"static/media/top-left.aa14327ce1c00dde7d5e0e2556542ebf.svg";const top_snake=__webpack_require__.p+"static/media/top-snake.855c837598a62a68d139910f0e0b9ba4.svg";const top_flip=__webpack_require__.p+"static/media/top-flip.16c423f83594173bc5d78a0345983929.svg";const top_snake_flip=__webpack_require__.p+"static/media/top-snake-flip.4ac4f4730616467aeaf4461771bfa2cc.svg",MFillSelector=_ref=>{let{direction,onChange}=_ref;return(0,jsx_runtime.jsx)(BladeFrame.A,{title:"Fill Direction",full:!1,style:{marginBottom:"1rem"},children:(0,jsx_runtime.jsxs)(Select.A,{value:direction,variant:"standard",fullWidth:!0,MenuProps:{PaperProps:{style:{maxHeight:300}}},onChange:e=>onChange(e.target.value),children:[(0,jsx_runtime.jsx)(MenuItem.A,{sx:{justifyContent:"space-between"},value:"right",children:(0,jsx_runtime.jsxs)("div",{style:{width:"100%",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,jsx_runtime.jsxs)("div",{children:["Linear",(0,jsx_runtime.jsx)(Chip.A,{size:"small",label:"Right",variant:"outlined"}),(0,jsx_runtime.jsx)(Chip.A,{size:"small",label:"Down",variant:"outlined"})]}),(0,jsx_runtime.jsx)("img",{width:"30px",src:right,alt:"rightSnake"})]})}),(0,jsx_runtime.jsx)(MenuItem.A,{sx:{justifyContent:"space-between"},value:"right-flip",children:(0,jsx_runtime.jsxs)("div",{style:{width:"100%",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,jsx_runtime.jsxs)("div",{children:["Linear",(0,jsx_runtime.jsx)(Chip.A,{size:"small",label:"Right",variant:"outlined"}),(0,jsx_runtime.jsx)(Chip.A,{size:"small",label:"Up",variant:"outlined"})]}),(0,jsx_runtime.jsx)("img",{width:"30px",src:right_flip,alt:"rightFlip"})]})}),(0,jsx_runtime.jsx)(MenuItem.A,{sx:{justifyContent:"space-between"},value:"right-snake",children:(0,jsx_runtime.jsxs)("div",{style:{width:"100%",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,jsx_runtime.jsxs)("div",{children:["Snake",(0,jsx_runtime.jsx)(Chip.A,{size:"small",label:"Right",variant:"outlined"}),(0,jsx_runtime.jsx)(Chip.A,{size:"small",label:"Down",variant:"outlined"})]}),(0,jsx_runtime.jsx)("img",{width:"30px",src:right_snake,alt:"rightSnake"})]})}),(0,jsx_runtime.jsx)(MenuItem.A,{sx:{justifyContent:"space-between"},value:"right-snake-flip",children:(0,jsx_runtime.jsxs)("div",{style:{width:"100%",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,jsx_runtime.jsxs)("div",{children:["Snake",(0,jsx_runtime.jsx)(Chip.A,{size:"small",label:"Right",variant:"outlined"}),(0,jsx_runtime.jsx)(Chip.A,{size:"small",label:"Up",variant:"outlined"})]}),(0,jsx_runtime.jsx)("img",{width:"30px",src:right_snake_flip,alt:"rightSnakeFlip"})]})}),(0,jsx_runtime.jsx)(Divider.A,{}),(0,jsx_runtime.jsx)(MenuItem.A,{sx:{justifyContent:"space-between"},value:"bottom",children:(0,jsx_runtime.jsxs)("div",{style:{width:"100%",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,jsx_runtime.jsxs)("div",{children:["Linear",(0,jsx_runtime.jsx)(Chip.A,{size:"small",label:"Down",variant:"outlined"}),(0,jsx_runtime.jsx)(Chip.A,{size:"small",label:"Right",variant:"outlined"})]}),(0,jsx_runtime.jsx)("img",{width:"30px",src:bottom,alt:"bottomSnake"})]})}),(0,jsx_runtime.jsx)(MenuItem.A,{sx:{justifyContent:"space-between"},value:"bottom-flip",children:(0,jsx_runtime.jsxs)("div",{style:{width:"100%",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,jsx_runtime.jsxs)("div",{children:["Linear",(0,jsx_runtime.jsx)(Chip.A,{size:"small",label:"Down",variant:"outlined"}),(0,jsx_runtime.jsx)(Chip.A,{size:"small",label:"Left",variant:"outlined"})]}),(0,jsx_runtime.jsx)("img",{width:"30px",src:bottom_flip,alt:"bottomSnakeFlip"})]})}),(0,jsx_runtime.jsx)(MenuItem.A,{sx:{justifyContent:"space-between"},value:"bottom-snake",children:(0,jsx_runtime.jsxs)("div",{style:{width:"100%",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,jsx_runtime.jsxs)("div",{children:["Snake",(0,jsx_runtime.jsx)(Chip.A,{size:"small",label:"Down",variant:"outlined"}),(0,jsx_runtime.jsx)(Chip.A,{size:"small",label:"Right",variant:"outlined"})]}),(0,jsx_runtime.jsx)("img",{width:"30px",src:bottom_snake,alt:"bottomSnake"})]})}),(0,jsx_runtime.jsx)(MenuItem.A,{sx:{justifyContent:"space-between"},value:"bottom-snake-flip",children:(0,jsx_runtime.jsxs)("div",{style:{width:"100%",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,jsx_runtime.jsxs)("div",{children:["Snake",(0,jsx_runtime.jsx)(Chip.A,{size:"small",label:"Down",variant:"outlined"}),(0,jsx_runtime.jsx)(Chip.A,{size:"small",label:"Left",variant:"outlined"})]}),(0,jsx_runtime.jsx)("img",{width:"30px",src:bottom_snake_flip,alt:"bottomSnakeFlip"})]})}),(0,jsx_runtime.jsx)(Divider.A,{}),(0,jsx_runtime.jsx)(MenuItem.A,{sx:{justifyContent:"space-between"},value:"left-flip",children:(0,jsx_runtime.jsxs)("div",{style:{width:"100%",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,jsx_runtime.jsxs)("div",{children:["Linear",(0,jsx_runtime.jsx)(Chip.A,{size:"small",label:"Left",variant:"outlined"}),(0,jsx_runtime.jsx)(Chip.A,{size:"small",label:"Down",variant:"outlined"})]}),(0,jsx_runtime.jsx)("img",{width:"30px",src:left_flip,alt:"leftFlip"})]})}),(0,jsx_runtime.jsx)(MenuItem.A,{sx:{justifyContent:"space-between"},value:"left",children:(0,jsx_runtime.jsxs)("div",{style:{width:"100%",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,jsx_runtime.jsxs)("div",{children:["Linear",(0,jsx_runtime.jsx)(Chip.A,{size:"small",label:"Left",variant:"outlined"}),(0,jsx_runtime.jsx)(Chip.A,{size:"small",label:"Up",variant:"outlined"})]}),(0,jsx_runtime.jsx)("img",{width:"30px",src:left,alt:"left"})]})}),(0,jsx_runtime.jsx)(MenuItem.A,{sx:{justifyContent:"space-between"},value:"left-snake",children:(0,jsx_runtime.jsxs)("div",{style:{width:"100%",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,jsx_runtime.jsxs)("div",{children:["Snake",(0,jsx_runtime.jsx)(Chip.A,{size:"small",label:"Left",variant:"outlined"}),(0,jsx_runtime.jsx)(Chip.A,{size:"small",label:"Up",variant:"outlined"})]}),(0,jsx_runtime.jsx)("img",{width:"30px",src:left_snake,alt:"leftSnake"})]})}),(0,jsx_runtime.jsx)(MenuItem.A,{sx:{justifyContent:"space-between"},value:"left-snake-flip",children:(0,jsx_runtime.jsxs)("div",{style:{width:"100%",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,jsx_runtime.jsxs)("div",{children:["Snake",(0,jsx_runtime.jsx)(Chip.A,{size:"small",label:"Left",variant:"outlined"}),(0,jsx_runtime.jsx)(Chip.A,{size:"small",label:"Down",variant:"outlined"})]}),(0,jsx_runtime.jsx)("img",{width:"30px",src:left_snake_flip,alt:"leftSnakeFlip"})]})}),(0,jsx_runtime.jsx)(Divider.A,{}),(0,jsx_runtime.jsx)(MenuItem.A,{sx:{justifyContent:"space-between"},value:"top",children:(0,jsx_runtime.jsxs)("div",{style:{width:"100%",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,jsx_runtime.jsxs)("div",{children:["Linear",(0,jsx_runtime.jsx)(Chip.A,{size:"small",label:"Up",variant:"outlined"}),(0,jsx_runtime.jsx)(Chip.A,{size:"small",label:"Left",variant:"outlined"})]}),(0,jsx_runtime.jsx)("img",{width:"30px",src:assets_top,alt:"top"})]})}),(0,jsx_runtime.jsx)(MenuItem.A,{sx:{justifyContent:"space-between"},value:"top-flip",children:(0,jsx_runtime.jsxs)("div",{style:{width:"100%",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,jsx_runtime.jsxs)("div",{children:["Linear",(0,jsx_runtime.jsx)(Chip.A,{size:"small",label:"Up",variant:"outlined"}),(0,jsx_runtime.jsx)(Chip.A,{size:"small",label:"Right",variant:"outlined"})]}),(0,jsx_runtime.jsx)("img",{width:"30px",src:top_flip,alt:"topFlip"})]})}),(0,jsx_runtime.jsx)(MenuItem.A,{sx:{justifyContent:"space-between"},value:"top-snake",children:(0,jsx_runtime.jsxs)("div",{style:{width:"100%",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,jsx_runtime.jsxs)("div",{children:["Snake",(0,jsx_runtime.jsx)(Chip.A,{size:"small",label:"Up",variant:"outlined"}),(0,jsx_runtime.jsx)(Chip.A,{size:"small",label:"Left",variant:"outlined"})]}),(0,jsx_runtime.jsx)("img",{width:"30px",src:top_snake,alt:"topSnake"})]})}),(0,jsx_runtime.jsx)(MenuItem.A,{sx:{justifyContent:"space-between"},value:"top-snake-flip",children:(0,jsx_runtime.jsxs)("div",{style:{width:"100%",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,jsx_runtime.jsxs)("div",{children:["Snake",(0,jsx_runtime.jsx)(Chip.A,{size:"small",label:"Up",variant:"outlined"}),(0,jsx_runtime.jsx)(Chip.A,{size:"small",label:"Right",variant:"outlined"})]}),(0,jsx_runtime.jsx)("img",{width:"30px",src:top_snake_flip,alt:"topSnakeFlip"})]})}),(0,jsx_runtime.jsx)(Divider.A,{}),(0,jsx_runtime.jsx)(MenuItem.A,{sx:{justifyContent:"space-between"},value:"diagonal-top-right",children:(0,jsx_runtime.jsxs)("div",{style:{width:"100%",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,jsx_runtime.jsxs)("div",{children:["Diagonal",(0,jsx_runtime.jsx)(Chip.A,{size:"small",label:"Up",variant:"outlined"}),(0,jsx_runtime.jsx)(Chip.A,{size:"small",label:"Right",variant:"outlined"})]}),(0,jsx_runtime.jsx)("img",{width:"30px",src:top_right,alt:"topRight"})]})}),(0,jsx_runtime.jsx)(MenuItem.A,{sx:{justifyContent:"space-between"},value:"diagonal-bottom-right",children:(0,jsx_runtime.jsxs)("div",{style:{width:"100%",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,jsx_runtime.jsxs)("div",{children:["Diagonal",(0,jsx_runtime.jsx)(Chip.A,{size:"small",label:"Down",variant:"outlined"}),(0,jsx_runtime.jsx)(Chip.A,{size:"small",label:"Right",variant:"outlined"})]}),(0,jsx_runtime.jsx)("img",{width:"30px",src:bottom_right,alt:"bottomRight"})]})}),(0,jsx_runtime.jsx)(MenuItem.A,{sx:{justifyContent:"space-between"},value:"diagonal-bottom-left",children:(0,jsx_runtime.jsxs)("div",{style:{width:"100%",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,jsx_runtime.jsxs)("div",{children:["Diagonal",(0,jsx_runtime.jsx)(Chip.A,{size:"small",label:"Down",variant:"outlined"}),(0,jsx_runtime.jsx)(Chip.A,{size:"small",label:"Left",variant:"outlined"})]}),(0,jsx_runtime.jsx)("img",{width:"30px",src:bottom_left,alt:"bottomLeft"})]})}),(0,jsx_runtime.jsx)(MenuItem.A,{sx:{justifyContent:"space-between"},value:"diagonal-top-left",children:(0,jsx_runtime.jsxs)("div",{style:{width:"100%",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,jsx_runtime.jsxs)("div",{children:["Diagonal",(0,jsx_runtime.jsx)(Chip.A,{size:"small",label:"Up",variant:"outlined"}),(0,jsx_runtime.jsx)(Chip.A,{size:"small",label:"Left",variant:"outlined"})]}),(0,jsx_runtime.jsx)("img",{width:"30px",src:top_left,alt:"topLeft"})]})})]})})},EditMatrix_MFillSelector=MFillSelector;MFillSelector.__docgenInfo={description:"",methods:[],displayName:"MFillSelector",props:{direction:{required:!0,tsType:{name:"union",raw:"| 'right'\n| 'right-snake'\n| 'right-flip'\n| 'right-snake-flip'\n| 'left'\n| 'left-snake'\n| 'left-flip'\n| 'left-snake-flip'\n| 'top'\n| 'top-snake'\n| 'top-flip'\n| 'top-snake-flip'\n| 'bottom'\n| 'bottom-snake'\n| 'bottom-flip'\n| 'bottom-snake-flip'",elements:[{name:"literal",value:"'right'"},{name:"literal",value:"'right-snake'"},{name:"literal",value:"'right-flip'"},{name:"literal",value:"'right-snake-flip'"},{name:"literal",value:"'left'"},{name:"literal",value:"'left-snake'"},{name:"literal",value:"'left-flip'"},{name:"literal",value:"'left-snake-flip'"},{name:"literal",value:"'top'"},{name:"literal",value:"'top-snake'"},{name:"literal",value:"'top-flip'"},{name:"literal",value:"'top-snake-flip'"},{name:"literal",value:"'bottom'"},{name:"literal",value:"'bottom-snake'"},{name:"literal",value:"'bottom-flip'"},{name:"literal",value:"'bottom-snake-flip'"}]},description:""},onChange:{required:!0,tsType:{name:"any"},description:""}}};const Number_Number=_ref=>{let{min,max,value,onChange,onBlur}=_ref;const[inputValue,setInputValue]=(0,react.useState)(""),[isEditing,setIsEditing]=(0,react.useState)(!1),handleFocus=(0,react.useCallback)(()=>{setIsEditing(!0),setInputValue(String(value))},[value]),handleChange=(0,react.useCallback)(e=>{const rawValue=e.target.value;if(setInputValue(rawValue),""!==rawValue){const numericValue=parseFloat(rawValue);isNaN(numericValue)||onChange(e)}},[onChange]),handleBlur=(0,react.useCallback)(e=>{setIsEditing(!1),setInputValue("");const numericValue=parseFloat(e.target.value);isNaN(numericValue)||""===e.target.value?(e.target.value=min.toString(),onChange(e)):numericValue>max?(e.target.value=max.toString(),onChange(e)):numericValue<min&&(e.target.value=min.toString(),onChange(e)),onBlur&&onBlur(e)},[min,max,onChange,onBlur]);return(0,jsx_runtime.jsx)(TextField.A,{value:isEditing?inputValue:value,name:"quantity",type:"number",onChange:handleChange,onFocus:handleFocus,onBlur:handleBlur,slotProps:{htmlInput:{min,max}}})},components_Number=Number_Number;Number_Number.__docgenInfo={description:"",methods:[],displayName:"Number",props:{min:{required:!0,tsType:{name:"number"},description:""},max:{required:!0,tsType:{name:"number"},description:""},value:{required:!0,tsType:{name:"number"},description:""},onChange:{required:!0,tsType:{name:"signature",type:"function",raw:"(_event: React.ChangeEvent<HTMLInputElement>) => void",signature:{arguments:[{type:{name:"ReactChangeEvent",raw:"React.ChangeEvent<HTMLInputElement>",elements:[{name:"HTMLInputElement"}]},name:"_event"}],return:{name:"void"}}},description:""},onBlur:{required:!1,tsType:{name:"signature",type:"function",raw:"(_event: React.FocusEvent<HTMLInputElement>) => void",signature:{arguments:[{type:{name:"ReactFocusEvent",raw:"React.FocusEvent<HTMLInputElement>",elements:[{name:"HTMLInputElement"}]},name:"_event"}],return:{name:"void"}}},description:""}}};const MSlider=_ref=>{let{group,devices,currentDevice,selectedPixel,handleSliderChange}=_ref;const pixelCount=devices[currentDevice].config.pixel_count,marks=(0,react.useMemo)(()=>[{value:0,label:"0"},{value:pixelCount-1,label:pixelCount-1}],[pixelCount]),handleSingleChange=(0,react.useCallback)(e=>handleSliderChange(e,parseInt(e.target.value)),[handleSliderChange]),handleStartChange=(0,react.useCallback)(e=>{Array.isArray(selectedPixel)&&handleSliderChange(e,[parseInt(e.target.value),selectedPixel[1]],0)},[handleSliderChange,selectedPixel]),handleEndChange=(0,react.useCallback)(e=>{Array.isArray(selectedPixel)&&handleSliderChange(e,[selectedPixel[0],parseInt(e.target.value)],1)},[handleSliderChange,selectedPixel]);return(0,jsx_runtime.jsx)(BladeFrame.A,{title:"Pixel".concat(group?"s":""),full:!1,style:{marginBottom:"1rem"},children:(0,jsx_runtime.jsxs)(Stack.A,{direction:"column",spacing:2,flex:1,minHeight:120,justifyContent:"space-between",children:[(0,jsx_runtime.jsx)(Slider.Ay,{marks,valueLabelDisplay:"auto",min:0,max:pixelCount-1,value:selectedPixel,onChange:handleSliderChange}),"number"==typeof selectedPixel?(0,jsx_runtime.jsx)(components_Number,{min:0,max:pixelCount-1,value:selectedPixel,onChange:handleSingleChange}):(0,jsx_runtime.jsxs)(Stack.A,{direction:"row",spacing:2,children:[(0,jsx_runtime.jsx)(components_Number,{min:0,max:pixelCount-1,value:selectedPixel[0],onChange:handleStartChange}),(0,jsx_runtime.jsx)(components_Number,{min:0,max:pixelCount-1,value:selectedPixel[1],onChange:handleEndChange})]})]})})},EditMatrix_MSlider=MSlider;MSlider.__docgenInfo={description:"",methods:[],displayName:"MSlider",props:{group:{required:!0,tsType:{name:"boolean"},description:""},devices:{required:!0,tsType:{name:"any"},description:""},selectedPixel:{required:!0,tsType:{name:"union",raw:"number | number[]",elements:[{name:"number"},{name:"Array",elements:[{name:"number"}],raw:"number[]"}]},description:""},currentDevice:{required:!0,tsType:{name:"any"},description:""},handleSliderChange:{required:!0,tsType:{name:"any"},description:""}}};const AssignPixelDialog=_ref=>{let{dialogApi}=_ref;const{isOpen,closeDialog,currentCell,currentDevice,setCurrentDevice,deviceRef,isGroupMode,setIsGroupMode,direction,handleDirectionChange,selectedPixel,handleSliderChange,save,handleClear}=dialogApi,devices=(0,useStore.A)(state=>state.devices),showComplex=(0,useStore.A)(state=>state.showComplex),showGaps=(0,useStore.A)(state=>state.showGaps),{m}=useMatrixEditorContext();return isOpen?(0,jsx_runtime.jsxs)(Dialog.A,{onClose:closeDialog,open:isOpen,PaperProps:{sx:{width:"100%",maxWidth:320}},children:[(0,jsx_runtime.jsx)(EditMatrix_MDialogTitle,{currentCell,m}),(0,jsx_runtime.jsxs)(DialogContent.A,{children:[(0,jsx_runtime.jsx)(BladeFrame.A,{title:"Device",style:{marginBottom:"1rem"},children:(0,jsx_runtime.jsx)(Select.A,{value:currentDevice,onChange:e=>setCurrentDevice(e.target.value||""),inputRef:deviceRef,variant:"standard",fullWidth:!0,children:devices&&Object.keys(devices).filter(v=>showComplex?v:!(v.endsWith("-mask")||v.endsWith("-foreground")||v.endsWith("-background"))).filter(v=>showGaps?v:!v.startsWith("gap-")).map(d=>(0,jsx_runtime.jsx)(MenuItem.A,{value:devices[d].id,children:devices[d].config.name},devices[d].id))})}),currentDevice&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(EditMatrix_MSwitch,{group:isGroupMode,setGroup:setIsGroupMode}),isGroupMode&&(0,jsx_runtime.jsx)(EditMatrix_MFillSelector,{direction,onChange:handleDirectionChange}),(0,jsx_runtime.jsx)(EditMatrix_MSlider,{group:isGroupMode,devices,currentDevice,selectedPixel,handleSliderChange})]})]}),(0,jsx_runtime.jsxs)(DialogActions.A,{children:[(0,jsx_runtime.jsx)(Button.A,{onClick:handleClear,children:"Clear"}),(0,jsx_runtime.jsx)(Button.A,{onClick:save,children:"Save"})]})]}):null},EditMatrix_AssignPixelDialog=AssignPixelDialog;AssignPixelDialog.__docgenInfo={description:"",methods:[],displayName:"AssignPixelDialog",props:{dialogApi:{required:!0,tsType:{name:"ReturnType",elements:[{name:"useAssignPixelDialog"}],raw:"ReturnType<typeof useAssignPixelDialog>"},description:""}}};var shallow=__webpack_require__("./node_modules/zustand/esm/react/shallow.mjs");const Actions_hexColor=function hexColor(encodedString,mode){if("uncompressed"===mode||!encodedString)return[];const decodedString=atob(encodedString),charCodes=Array.from(decodedString).map(char=>char.charCodeAt(0));return Array.from({length:charCodes.length/3},(_,i)=>({r:charCodes[3*i],g:charCodes[3*i+1],b:charCodes[3*i+2]}))},PixelGraphBase=_ref=>{var _virtuals$virtId,_virtuals$virtId2,_devices$virtuals$vir,_devices$virtuals$vir2,_virtuals$virtId3,_virtuals$virtId4,_virtuals$virtId4$con,_virtuals$virtId5,_virtuals$virtId5$con,_pixels$,_virtuals$virtId6;let{virtId,dummy=!1,className="",active=!1,intGraphs=!1,showMatrix=!1,fullScreen=!1,db=!1,onDoubleClick}=_ref;const[pixels,setPixels]=(0,react.useState)([]),[shape,setShape]=(0,react.useState)([null,null]),showWarning=(0,useStore.A)(state=>state.uiPersist.warnings.lessPixels),round=(0,useStore.A)(state=>{var _state$uiPersist$pixe;return null===(_state$uiPersist$pixe=state.uiPersist.pixelGraphSettings)||void 0===_state$uiPersist$pixe?void 0:_state$uiPersist$pixe.round}),space=(0,useStore.A)(state=>{var _state$uiPersist$pixe2;return null===(_state$uiPersist$pixe2=state.uiPersist.pixelGraphSettings)||void 0===_state$uiPersist$pixe2?void 0:_state$uiPersist$pixe2.space}),stretch=(0,useStore.A)(state=>{var _state$uiPersist$pixe3;return null===(_state$uiPersist$pixe3=state.uiPersist.pixelGraphSettings)||void 0===_state$uiPersist$pixe3?void 0:_state$uiPersist$pixe3.stretch}),{pixelGraphs,virtuals,devices,graphs,config}=(0,useStore.A)((0,shallow.k)(state=>({pixelGraphs:state.pixelGraphs,virtuals:state.virtuals,devices:state.devices,graphs:state.graphs,config:state.config}))),rows=null!==(_virtuals$virtId=virtuals[virtId])&&void 0!==_virtuals$virtId&&_virtuals$virtId.is_device?"string"==typeof(null===(_virtuals$virtId2=virtuals[virtId])||void 0===_virtuals$virtId2?void 0:_virtuals$virtId2.is_device)&&(null===(_devices$virtuals$vir=devices[null===(_virtuals$virtId3=virtuals[virtId])||void 0===_virtuals$virtId3?void 0:_virtuals$virtId3.is_device])||void 0===_devices$virtuals$vir||null===(_devices$virtuals$vir2=_devices$virtuals$vir.config)||void 0===_devices$virtuals$vir2?void 0:_devices$virtuals$vir2.rows)||(null===(_virtuals$virtId4=virtuals[virtId])||void 0===_virtuals$virtId4||null===(_virtuals$virtId4$con=_virtuals$virtId4.config)||void 0===_virtuals$virtId4$con?void 0:_virtuals$virtId4$con.rows)||1:(null===(_virtuals$virtId5=virtuals[virtId])||void 0===_virtuals$virtId5||null===(_virtuals$virtId5$con=_virtuals$virtId5.config)||void 0===_virtuals$virtId5$con?void 0:_virtuals$virtId5$con.rows)||1,decodedPixels="compressed"===config.transmission_mode?pixels&&pixels.length&&Actions_hexColor(pixels,config.transmission_mode):pixels;(0,react.useEffect)(()=>{const handleWebsockets=e=>{e.detail.id===virtId&&(setPixels(e.detail.pixels),e.detail.shape[0]!==shape[0]&&e.detail.shape[1]!==shape[1]&&setShape(e.detail.shape))};return document.addEventListener("visualisation_update",handleWebsockets),()=>{document.removeEventListener("visualisation_update",handleWebsockets)}},[virtuals,pixelGraphs,virtId]);const tooLessPixels=(0,useStore.A)(state=>{var _state$dialogs$lessPi;return(null===(_state$dialogs$lessPi=state.dialogs.lessPixels)||void 0===_state$dialogs$lessPi?void 0:_state$dialogs$lessPi.open)||!1});if(!graphs&&!intGraphs)return null;const totalPixels=decodedPixels.length>0?decodedPixels.length:null===(_pixels$=pixels[0])||void 0===_pixels$?void 0:_pixels$.length,realPixelCount=(null===(_virtuals$virtId6=virtuals[virtId])||void 0===_virtuals$virtId6?void 0:_virtuals$virtId6.pixel_count)||totalPixels,realCols=Math.ceil(realPixelCount/rows),aspectRatio=realCols/rows,displayRows=shape&&shape[0]||(realPixelCount>4096?Math.sqrt(4096/aspectRatio):rows),displayCols=shape&&shape[1]||(realPixelCount>4096?4096/displayRows:realCols);return dummy||tooLessPixels&&showWarning?(0,jsx_runtime.jsx)("div",{style:{maxWidth:fullScreen?"100vw":"520px",maxHeight:fullScreen?"calc(100vh - 200px)":"unset",display:"flex",width:"100%",borderRadius:round?"10px":0,overflow:"hidden",margin:"0.5rem 0 0 0"},className:"".concat(className," ").concat(active?"active":""),onDoubleClick,children:(0,jsx_runtime.jsx)("div",{style:{backgroundColor:"#0002",height:"20px",flex:1,borderRadius:"0"}},1)}):(pixels.length||decodedPixels.length)&&rows>1&&showMatrix?(0,jsx_runtime.jsx)("div",{onDoubleClick:()=>{onDoubleClick()},style:{maxWidth:fullScreen?"100vw":"520px",maxHeight:fullScreen?"100vh":"unset",display:"flex",flexDirection:"launchpad-x"===virtuals[virtId].id||"launchpad-x-matrix"===virtuals[virtId].id?"column-reverse":"column",width:"100%",borderRadius:round?"10px":0,overflow:"hidden",margin:db?0:"0.5rem 0 0 0",objectFit:stretch?"fill":"contain"},className:"".concat(className," ").concat(active?"active":""),children:Array.from(Array(displayRows).keys()).map(row=>{var _pixels$2;return(0,jsx_runtime.jsx)("div",{style:{maxWidth:fullScreen?"100vw":"520px",maxHeight:fullScreen?"calc(100vh - 200px)":"unset",display:"flex",width:"100%",borderRadius:"0",overflow:"hidden",margin:"0"},className:"".concat(className," ").concat(active?"active":""),children:("compressed"===config.transmission_mode&&decodedPixels.length>0?decodedPixels.slice(row*displayCols,(row+1)*displayCols):null===(_pixels$2=pixels[0])||void 0===_pixels$2?void 0:_pixels$2.slice(row*displayCols,(row+1)*displayCols)).map((_p,i)=>(0,jsx_runtime.jsx)("div",{style:{flex:1,margin:space?"".concat(db||totalPixels>100&&displayRows>7?1:2,"px"):0,borderRadius:round?db||totalPixels>100&&displayRows>7?"50%":"5px":0,position:"relative",overflow:"hidden",maxWidth:db?3.6:"".concat(100/displayCols,"%"),maxHeight:db?3.6:"".concat(100/displayCols,"%")},children:(0,jsx_runtime.jsx)("div",{style:{width:"100%",paddingBottom:"100%",backgroundColor:active?"compressed"===config.transmission_mode&&decodedPixels.length>0&&decodedPixels[row*displayCols+i]?"rgb(".concat(Object.values(decodedPixels[row*displayCols+i]),")"):"rgb(".concat(pixels[0][row*displayCols+i],",").concat(pixels[1][row*displayCols+i],",").concat(pixels[2][row*displayCols+i],")"):"#0002"}})},i))},"row-".concat(row))})}):(pixels[0]||decodedPixels).length?(0,jsx_runtime.jsx)("div",{style:{maxWidth:fullScreen?"100vw":"520px",maxHeight:fullScreen?"calc(100vh - 200px)":"unset",display:"flex",width:"100%",borderRadius:round?"10px":0,overflow:"hidden",margin:"0.5rem 0 0 0"},className:"".concat(className," ").concat(active?"active":""),children:("compressed"===config.transmission_mode?decodedPixels:pixels[0]).map((p,i)=>(0,jsx_runtime.jsx)("div",{style:{height:"20px",flex:1,borderRadius:"0",backgroundColor:active?"compressed"===config.transmission_mode?"rgb(".concat(Object.values(p),")"):"rgb(".concat(pixels[0][i],",").concat(pixels[1][i],",").concat(pixels[2][i],")"):"#0002"}},i))}):(0,jsx_runtime.jsx)("div",{style:{maxWidth:fullScreen?"100vw":"520px",maxHeight:fullScreen?"calc(100vh - 200px)":"unset",display:"flex",width:"100%",borderRadius:round?"10px":0,overflow:"hidden",margin:"0.5rem 0 0 0"},className:"".concat(className," ").concat(active?"active":""),children:(0,jsx_runtime.jsx)("div",{style:{height:"20px",borderRadius:"0",flex:1,backgroundColor:"#0002"}},1)})},PixelGraph_PixelGraphBase=PixelGraphBase;PixelGraphBase.__docgenInfo={description:"",methods:[],displayName:"PixelGraphBase",props:{virtId:{required:!0,tsType:{name:"string"},description:""},dummy:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},className:{required:!1,tsType:{name:"string"},description:"",defaultValue:{value:"''",computed:!1}},active:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},intGraphs:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},showMatrix:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},fullScreen:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},db:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},onDoubleClick:{required:!1,tsType:{name:"any"},description:""}}};var sockette=__webpack_require__("./node_modules/sockette/dist/sockette.mjs"),is_electron=__webpack_require__("./node_modules/is-electron/index.js"),is_electron_default=__webpack_require__.n(is_electron);const initialSubscriptions=[{event_type:"devices_updated",id:9002},{event_type:"device_created",id:9001},{event_type:"scene_activated",id:9003},{event_type:"effect_set",id:9004},{event_type:"client_connected",id:9005},{event_type:"client_disconnected",id:9006},{event_type:"client_sync",id:9007},{event_type:"playlist_started",id:9008},{event_type:"playlist_advanced",id:9009},{event_type:"playlist_stopped",id:9010},{event_type:"playlist_paused",id:9011},{event_type:"playlist_resumed",id:9012},{event_type:"colors_updated",id:9013}],handlerConfig={visualisation_update:data=>(0,objectSpread2.A)((0,objectSpread2.A)({id:data.vis_id,pixels:data.pixels,shape:data.shape},data.rid&&{rid:data.id}),data.timestamp&&{timestamp:data.timestamp}),devices_updated:"devices_updated",device_created:data=>({id:"device_created",device_name:data.device_name}),scene_activated:data=>({id:"scene_activated",scene_id:data.scene_id}),virtual_diag:data=>({data}),playlist_started:data=>({playlist_id:data.playlist_id,index:data.index,scene_id:data.scene_id,effective_duration_ms:data.effective_duration_ms}),playlist_advanced:data=>({playlist_id:data.playlist_id,index:data.index,scene_id:data.scene_id,effective_duration_ms:data.effective_duration_ms}),playlist_stopped:data=>({playlist_id:data.playlist_id,effective_duration_ms:data.effective_duration_ms,remaining_ms:data.remaining_ms}),playlist_paused:data=>({playlist_id:data.playlist_id,index:data.index,scene_id:data.scene_id,effective_duration_ms:data.effective_duration_ms,remaining_ms:data.remaining_ms}),playlist_resumed:data=>({playlist_id:data.playlist_id,index:data.index,scene_id:data.scene_id,effective_duration_ms:data.effective_duration_ms,remaining_ms:data.remaining_ms}),graph_update:!0,effect_set:!0,colors_updated:"colors_updated"},WebSocketContext=(0,react.createContext)({send:()=>console.error("WebSocketProvider not mounted"),subscribe:()=>()=>console.error("WebSocketProvider not mounted"),isConnected:!1,getSocket:()=>null,errorState:null}),useSubscription=(eventName,callback)=>{const{subscribe}=(0,react.useContext)(WebSocketContext),callbackRef=(0,react.useRef)(callback);(0,react.useEffect)(()=>{callbackRef.current=callback}),(0,react.useEffect)(()=>subscribe(eventName,data=>callbackRef.current(data)),[eventName,subscribe])};(_ref=>{let{children}=_ref;const ws=(0,react.useRef)(null),[isConnected,setIsConnected]=(0,react.useState)(!1),[errorState,setErrorState]=(0,react.useState)(null),subscribers=(0,react.useRef)(new Map),send=(0,react.useCallback)(data=>{var _ws$current;null===(_ws$current=ws.current)||void 0===_ws$current||_ws$current.send(JSON.stringify(data))},[]),getSocket=(0,react.useCallback)(()=>ws.current,[]),subscribe=(0,react.useCallback)((eventName,callback)=>{subscribers.current.has(eventName)||subscribers.current.set(eventName,new Set);const eventSubscribers=subscribers.current.get(eventName);return eventSubscribers.add(callback),()=>{eventSubscribers.delete(callback)}},[]);(0,react.useEffect)(()=>{const wsUrl=(window.localStorage.getItem("ledfx-host")||(()=>{if(is_electron_default()()){return"true"===window.localStorage.getItem("ledfx-ssl-enabled")?"https://ledfx.local:8889":"http://localhost:8888"}return window.location.href.split("/#")[0].replace(/\/+$/,"")})()).replace("https://","wss://").replace("http://","ws://")+"/api/websocket";"https:"===window.location.protocol&&wsUrl.startsWith("ws://")&&(console.error("Mixed Content Error Detected: Attempting to connect to ws:// from https://."),setErrorState("mixedContent"));return ws.current=new sockette.A(wsUrl,{timeout:5e3,maxAttempts:10,onopen:()=>{setIsConnected(!0),setErrorState(null),useStore.A.getState().setDisconnected(!1),useStore.A.getState().getSchemas(!0),useStore.A.getState().getColors(),initialSubscriptions.forEach(sub=>{send((0,objectSpread2.A)((0,objectSpread2.A)({},sub),{},{type:"subscribe_event"}))})},onmessage:event=>{const data=JSON.parse(event.data),eventType=null==data?void 0:data.event_type;if(!eventType)return;if("colors_updated"===eventType)return void useStore.A.getState().getColors();const rule=handlerConfig[eventType];let payload=data;!0===rule?payload=data:"function"==typeof rule?payload=rule(data):void 0!==rule&&(payload=rule),((eventName,data)=>{var _subscribers$current$;subscribers.current.has(eventName)&&(null===(_subscribers$current$=subscribers.current.get(eventName))||void 0===_subscribers$current$||_subscribers$current$.forEach(cb=>cb(data)))})(eventType,payload)},onclose:()=>{setIsConnected(!1),useStore.A.getState().setDisconnected(!0),window.localStorage.removeItem("core-init")},onerror:e=>{console.error("WebSocket Error:",e),setErrorState("connectionError")}}),()=>{var _ws$current2;null===(_ws$current2=ws.current)||void 0===_ws$current2||_ws$current2.close()}},[send]);const value={send,subscribe,isConnected,getSocket,errorState};return(0,jsx_runtime.jsx)(WebSocketContext.Provider,{value,children})}).__docgenInfo={description:"",methods:[],displayName:"WebSocketProvider",props:{children:{required:!0,tsType:{name:"ReactReactNode",raw:"React.ReactNode"},description:""}}};const PixelGraphCanvas=_ref=>{var _virtuals$virtId3,_virtuals$virtId4,_virtuals$virtId4$eff,_virtuals$virtId5,_virtuals$virtId6,_virtuals$virtId6$con;let{virtId,className="",active=!1,intGraphs=!1,showMatrix=!1,fullScreen=!1,db=!1,fill=!1,onDoubleClick}=_ref;const canvasRef=(0,react.useRef)(null),{virtuals,graphs}=(0,useStore.A)((0,shallow.k)(state=>({virtuals:state.virtuals,graphs:state.graphs}))),smoothing=(0,useStore.A)(state=>{var _state$uiPersist$pixe;return null===(_state$uiPersist$pixe=state.uiPersist.pixelGraphSettings)||void 0===_state$uiPersist$pixe?void 0:_state$uiPersist$pixe.smoothing}),stretch=(0,useStore.A)(state=>{var _state$uiPersist$pixe2;return null===(_state$uiPersist$pixe2=state.uiPersist.pixelGraphSettings)||void 0===_state$uiPersist$pixe2?void 0:_state$uiPersist$pixe2.stretch}),handleVisualisationUpdate=(0,react.useCallback)(eventData=>{var _virtuals$virtId,_virtuals$virtId$conf,_virtuals$virtId2;if(eventData.id!==virtId)return;const canvas=canvasRef.current,ctx=null==canvas?void 0:canvas.getContext("2d");if(!canvas||!ctx)return;const{virtuals,config}=useStore.A.getState();ctx.imageSmoothingEnabled=!1;const pixels="compressed"===config.transmission_mode?Actions_hexColor(eventData.pixels,config.transmission_mode):eventData.pixels,rows=showMatrix&&(null===(_virtuals$virtId=virtuals[virtId])||void 0===_virtuals$virtId||null===(_virtuals$virtId$conf=_virtuals$virtId.config)||void 0===_virtuals$virtId$conf?void 0:_virtuals$virtId$conf.rows)||1,shape=eventData.shape,totalPixels=pixels.length,realPixelCount=(null===(_virtuals$virtId2=virtuals[virtId])||void 0===_virtuals$virtId2?void 0:_virtuals$virtId2.pixel_count)||totalPixels,realCols=Math.ceil(realPixelCount/rows),aspectRatio=realCols/rows;let displayRows,displayCols;showMatrix?(displayRows=shape&&shape[0]||(realPixelCount>4096?Math.sqrt(4096/aspectRatio):rows),displayCols=shape&&shape[1]||(realPixelCount>4096?4096/displayRows:realCols)):(displayRows=1,displayCols=totalPixels),canvas.width=displayCols,canvas.height=displayRows;const imageData=ctx.createImageData(displayCols,displayRows);for(let i=0;i<pixels.length;i++){const x=i%displayCols,index=4*(Math.floor(i/displayCols)*displayCols+x),color=pixels[i];imageData.data[index]=color.r,imageData.data[index+1]=color.g,imageData.data[index+2]=color.b,imageData.data[index+3]=255}ctx.putImageData(imageData,0,0)},[virtId,showMatrix]);useSubscription("visualisation_update",handleVisualisationUpdate);const render=(null===(_virtuals$virtId3=virtuals[virtId])||void 0===_virtuals$virtId3?void 0:_virtuals$virtId3.active)&&(null===(_virtuals$virtId4=virtuals[virtId])||void 0===_virtuals$virtId4||null===(_virtuals$virtId4$eff=_virtuals$virtId4.effect)||void 0===_virtuals$virtId4$eff?void 0:_virtuals$virtId4$eff.name)||(null===(_virtuals$virtId5=virtuals[virtId])||void 0===_virtuals$virtId5?void 0:_virtuals$virtId5.streaming);return graphs||intGraphs?(0,jsx_runtime.jsx)("canvas",{ref:canvasRef,className:"".concat(className," ").concat(active?"active":""),style:{maxWidth:fill?"unset":fullScreen?"100vw":"520px",maxHeight:fill?"unset":fullScreen?"100vh":"520px",height:!render||((null===(_virtuals$virtId6=virtuals[virtId])||void 0===_virtuals$virtId6||null===(_virtuals$virtId6$con=_virtuals$virtId6.config)||void 0===_virtuals$virtId6$con?void 0:_virtuals$virtId6$con.rows)||1)<2||!showMatrix?"20px":"auto",width:"100%",borderRadius:"10px",overflow:"hidden",margin:db||fill?0:"0.5rem 0 0 0",imageRendering:smoothing?"unset":"pixelated",objectFit:stretch&&fullScreen?"contain":"fill",position:fill?"absolute":"unset"},onDoubleClick}):null},PixelGraph_PixelGraphCanvas=PixelGraphCanvas;PixelGraphCanvas.__docgenInfo={description:"",methods:[],displayName:"PixelGraphCanvas",props:{virtId:{required:!0,tsType:{name:"string"},description:""},dummy:{required:!1,tsType:{name:"boolean"},description:""},className:{required:!1,tsType:{name:"string"},description:"",defaultValue:{value:"''",computed:!1}},active:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},intGraphs:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},showMatrix:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},fullScreen:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},db:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},onDoubleClick:{required:!1,tsType:{name:"any"},description:""},fill:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}}}};const PixelGraphCanvasOffscreen=_ref=>{var _virtuals$virtId2,_virtuals$virtId3,_virtuals$virtId3$eff,_virtuals$virtId4,_virtuals$virtId5,_virtuals$virtId5$con;let{virtId,className="",active=!1,intGraphs=!1,showMatrix=!1,fullScreen=!1,db=!1,onDoubleClick}=_ref;const canvasRef=(0,react.useRef)(null),workerRef=(0,react.useRef)(null),transferredRef=(0,react.useRef)(!1),{pixelGraphs,virtuals,devices,graphs,config}=(0,useStore.A)((0,shallow.k)(state=>({pixelGraphs:state.pixelGraphs,virtuals:state.virtuals,devices:state.devices,graphs:state.graphs,config:state.config}))),smoothing=(0,useStore.A)(state=>{var _state$uiPersist$pixe;return null===(_state$uiPersist$pixe=state.uiPersist.pixelGraphSettings)||void 0===_state$uiPersist$pixe?void 0:_state$uiPersist$pixe.smoothing}),stretch=(0,useStore.A)(state=>{var _state$uiPersist$pixe2;return null===(_state$uiPersist$pixe2=state.uiPersist.pixelGraphSettings)||void 0===_state$uiPersist$pixe2?void 0:_state$uiPersist$pixe2.stretch});(0,react.useEffect)(()=>{setTimeout(()=>{const canvas=canvasRef.current;if(!canvas||transferredRef.current)return;const offscreen=canvas.transferControlToOffscreen(),worker=new Worker(new URL(__webpack_require__.p+__webpack_require__.u(1258),__webpack_require__.b));workerRef.current=worker,transferredRef.current=!0,worker.postMessage({canvas:offscreen},[offscreen]);const handleWebsockets=e=>{if(e.detail.id===virtId){var _virtuals$virtId,_virtuals$virtId$conf;const pixels="compressed"===config.transmission_mode?Actions_hexColor(e.detail.pixels,config.transmission_mode):e.detail.pixels,rows=showMatrix&&(null===(_virtuals$virtId=virtuals[virtId])||void 0===_virtuals$virtId||null===(_virtuals$virtId$conf=_virtuals$virtId.config)||void 0===_virtuals$virtId$conf?void 0:_virtuals$virtId$conf.rows)||1,cols=Math.ceil(pixels.length/rows);worker.postMessage({pixels,rows,cols})}};return document.addEventListener("visualisation_update",handleWebsockets),()=>{document.removeEventListener("visualisation_update",handleWebsockets),worker.terminate()}},200)},[virtId,virtuals,pixelGraphs,devices,graphs,config,showMatrix]);const render=(null===(_virtuals$virtId2=virtuals[virtId])||void 0===_virtuals$virtId2?void 0:_virtuals$virtId2.active)&&(null===(_virtuals$virtId3=virtuals[virtId])||void 0===_virtuals$virtId3||null===(_virtuals$virtId3$eff=_virtuals$virtId3.effect)||void 0===_virtuals$virtId3$eff?void 0:_virtuals$virtId3$eff.name)||(null===(_virtuals$virtId4=virtuals[virtId])||void 0===_virtuals$virtId4?void 0:_virtuals$virtId4.streaming);return graphs||intGraphs?(0,jsx_runtime.jsx)("canvas",{ref:canvasRef,className:"".concat(className," ").concat(active?"active":""),style:{maxWidth:fullScreen?"100vw":"520px",maxHeight:fullScreen?"100vh":"unset",height:!render||((null===(_virtuals$virtId5=virtuals[virtId])||void 0===_virtuals$virtId5||null===(_virtuals$virtId5$con=_virtuals$virtId5.config)||void 0===_virtuals$virtId5$con?void 0:_virtuals$virtId5$con.rows)||1)<2||!showMatrix?"20px":"auto",width:"100%",borderRadius:"10px",overflow:"hidden",margin:db?0:"0.5rem 0 0 0",imageRendering:smoothing?"unset":"pixelated",objectFit:stretch&&fullScreen?"contain":"fill"},onDoubleClick}):null},PixelGraph_PixelGraphCanvasOffscreen=PixelGraphCanvasOffscreen;PixelGraphCanvasOffscreen.__docgenInfo={description:"",methods:[],displayName:"PixelGraphCanvasOffscreen",props:{virtId:{required:!0,tsType:{name:"string"},description:""},dummy:{required:!1,tsType:{name:"boolean"},description:""},className:{required:!1,tsType:{name:"string"},description:"",defaultValue:{value:"''",computed:!1}},active:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},intGraphs:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},showMatrix:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},fullScreen:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},db:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},onDoubleClick:{required:!1,tsType:{name:"any"},description:""}}};const PixelGraphCanvasOffscreenWebGL=_ref=>{var _virtuals$virtId2,_virtuals$virtId3,_virtuals$virtId3$eff,_virtuals$virtId4,_virtuals$virtId5,_virtuals$virtId5$con;let{virtId,className="",active=!1,intGraphs=!1,showMatrix=!1,fullScreen=!1,db=!1,onDoubleClick}=_ref;const canvasRef=(0,react.useRef)(null),workerRef=(0,react.useRef)(null),transferredRef=(0,react.useRef)(!1),{pixelGraphs,virtuals,devices,graphs,config}=(0,useStore.A)((0,shallow.k)(state=>({pixelGraphs:state.pixelGraphs,virtuals:state.virtuals,devices:state.devices,graphs:state.graphs,config:state.config}))),smoothing=(0,useStore.A)(state=>{var _state$uiPersist$pixe;return null===(_state$uiPersist$pixe=state.uiPersist.pixelGraphSettings)||void 0===_state$uiPersist$pixe?void 0:_state$uiPersist$pixe.smoothing}),stretch=(0,useStore.A)(state=>{var _state$uiPersist$pixe2;return null===(_state$uiPersist$pixe2=state.uiPersist.pixelGraphSettings)||void 0===_state$uiPersist$pixe2?void 0:_state$uiPersist$pixe2.stretch});(0,react.useEffect)(()=>{setTimeout(()=>{const canvas=canvasRef.current;if(!canvas||transferredRef.current)return;const offscreen=canvas.transferControlToOffscreen(),worker=new Worker(new URL(__webpack_require__.p+__webpack_require__.u(6393),__webpack_require__.b));workerRef.current=worker,transferredRef.current=!0,worker.postMessage({canvas:offscreen},[offscreen]);const handleWebsockets=e=>{if(e.detail.id===virtId){var _virtuals$virtId,_virtuals$virtId$conf;const pixels="compressed"===config.transmission_mode?Actions_hexColor(e.detail.pixels,config.transmission_mode):e.detail.pixels,rows=showMatrix&&(null===(_virtuals$virtId=virtuals[virtId])||void 0===_virtuals$virtId||null===(_virtuals$virtId$conf=_virtuals$virtId.config)||void 0===_virtuals$virtId$conf?void 0:_virtuals$virtId$conf.rows)||1,cols=Math.ceil(pixels.length/rows);worker.postMessage({pixels,rows,cols})}};return document.addEventListener("visualisation_update",handleWebsockets),()=>{document.removeEventListener("visualisation_update",handleWebsockets),worker.terminate()}},200)},[virtId,virtuals,pixelGraphs,devices,graphs,config,showMatrix]);const render=(null===(_virtuals$virtId2=virtuals[virtId])||void 0===_virtuals$virtId2?void 0:_virtuals$virtId2.active)&&(null===(_virtuals$virtId3=virtuals[virtId])||void 0===_virtuals$virtId3||null===(_virtuals$virtId3$eff=_virtuals$virtId3.effect)||void 0===_virtuals$virtId3$eff?void 0:_virtuals$virtId3$eff.name)||(null===(_virtuals$virtId4=virtuals[virtId])||void 0===_virtuals$virtId4?void 0:_virtuals$virtId4.streaming);return graphs||intGraphs?(0,jsx_runtime.jsx)("canvas",{ref:canvasRef,className:"".concat(className," ").concat(active?"active":""),style:{maxWidth:fullScreen?"100vw":"520px",maxHeight:fullScreen?"100vh":"unset",height:!render||((null===(_virtuals$virtId5=virtuals[virtId])||void 0===_virtuals$virtId5||null===(_virtuals$virtId5$con=_virtuals$virtId5.config)||void 0===_virtuals$virtId5$con?void 0:_virtuals$virtId5$con.rows)||1)<2||!showMatrix?"20px":"auto",width:"100%",borderRadius:"10px",overflow:"hidden",margin:db?0:"0.5rem 0 0 0",imageRendering:smoothing?"unset":"pixelated",objectFit:stretch&&fullScreen?"contain":"fill"},onDoubleClick}):null},PixelGraph_PixelGraphCanvasOffscreenWebGL=PixelGraphCanvasOffscreenWebGL;PixelGraphCanvasOffscreenWebGL.__docgenInfo={description:"",methods:[],displayName:"PixelGraphCanvasOffscreenWebGL",props:{virtId:{required:!0,tsType:{name:"string"},description:""},dummy:{required:!1,tsType:{name:"boolean"},description:""},className:{required:!1,tsType:{name:"string"},description:"",defaultValue:{value:"''",computed:!1}},active:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},intGraphs:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},showMatrix:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},fullScreen:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},db:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},onDoubleClick:{required:!1,tsType:{name:"any"},description:""}}};const PixelGraphCanvasOffscreenWebGLSync=_ref=>{var _virtuals$virtId2,_virtuals$virtId3,_virtuals$virtId3$eff,_virtuals$virtId4,_virtuals$virtId5,_virtuals$virtId5$con;let{virtId,className="",active=!1,intGraphs=!1,showMatrix=!1,fullScreen=!1,db=!1,onDoubleClick}=_ref;const canvasRef=(0,react.useRef)(null),workerRef=(0,react.useRef)(null),transferredRef=(0,react.useRef)(!1),animationFrameRef=(0,react.useRef)(null),{pixelGraphs,virtuals,devices,graphs,config}=(0,useStore.A)((0,shallow.k)(state=>({pixelGraphs:state.pixelGraphs,virtuals:state.virtuals,devices:state.devices,graphs:state.graphs,config:state.config}))),smoothing=(0,useStore.A)(state=>{var _state$uiPersist$pixe;return null===(_state$uiPersist$pixe=state.uiPersist.pixelGraphSettings)||void 0===_state$uiPersist$pixe?void 0:_state$uiPersist$pixe.smoothing}),stretch=(0,useStore.A)(state=>{var _state$uiPersist$pixe2;return null===(_state$uiPersist$pixe2=state.uiPersist.pixelGraphSettings)||void 0===_state$uiPersist$pixe2?void 0:_state$uiPersist$pixe2.stretch});(0,react.useEffect)(()=>{setTimeout(()=>{transferredRef.current||(async()=>{const canvas=canvasRef.current;if(!canvas)return;const offscreen=canvas.transferControlToOffscreen(),worker=new Worker(new URL(__webpack_require__.p+__webpack_require__.u(6393),__webpack_require__.b));workerRef.current=worker,transferredRef.current=!0,worker.postMessage({canvas:offscreen},[offscreen])})();const handleWebsockets=e=>{if(e.detail.id===virtId){var _virtuals$virtId,_virtuals$virtId$conf;const pixels="compressed"===config.transmission_mode?Actions_hexColor(e.detail.pixels,config.transmission_mode):e.detail.pixels,rows=showMatrix&&(null===(_virtuals$virtId=virtuals[virtId])||void 0===_virtuals$virtId||null===(_virtuals$virtId$conf=_virtuals$virtId.config)||void 0===_virtuals$virtId$conf?void 0:_virtuals$virtId$conf.rows)||1,cols=Math.ceil(pixels.length/rows);animationFrameRef.current&&cancelAnimationFrame(animationFrameRef.current),animationFrameRef.current=requestAnimationFrame(()=>{var _workerRef$current;null===(_workerRef$current=workerRef.current)||void 0===_workerRef$current||_workerRef$current.postMessage({pixels,rows,cols})})}};return document.addEventListener("visualisation_update",handleWebsockets),()=>{var _workerRef$current2;document.removeEventListener("visualisation_update",handleWebsockets),null===(_workerRef$current2=workerRef.current)||void 0===_workerRef$current2||_workerRef$current2.terminate(),animationFrameRef.current&&cancelAnimationFrame(animationFrameRef.current)}},200)},[virtId,virtuals,pixelGraphs,devices,graphs,config,showMatrix]);const render=(null===(_virtuals$virtId2=virtuals[virtId])||void 0===_virtuals$virtId2?void 0:_virtuals$virtId2.active)&&(null===(_virtuals$virtId3=virtuals[virtId])||void 0===_virtuals$virtId3||null===(_virtuals$virtId3$eff=_virtuals$virtId3.effect)||void 0===_virtuals$virtId3$eff?void 0:_virtuals$virtId3$eff.name)||(null===(_virtuals$virtId4=virtuals[virtId])||void 0===_virtuals$virtId4?void 0:_virtuals$virtId4.streaming);return graphs||intGraphs?(0,jsx_runtime.jsx)("canvas",{ref:canvasRef,className:"".concat(className," ").concat(active?"active":""),style:{maxWidth:fullScreen?"100vw":"520px",maxHeight:fullScreen?"100vh":"unset",height:!render||((null===(_virtuals$virtId5=virtuals[virtId])||void 0===_virtuals$virtId5||null===(_virtuals$virtId5$con=_virtuals$virtId5.config)||void 0===_virtuals$virtId5$con?void 0:_virtuals$virtId5$con.rows)||1)<2||!showMatrix?"20px":"auto",width:"100%",borderRadius:"10px",overflow:"hidden",margin:db?0:"0.5rem 0 0 0",imageRendering:smoothing?"unset":"pixelated",objectFit:stretch&&fullScreen?"contain":"fill"},onDoubleClick}):null},PixelGraph_PixelGraphCanvasOffscreenWebGLSync=PixelGraphCanvasOffscreenWebGLSync;PixelGraphCanvasOffscreenWebGLSync.__docgenInfo={description:"",methods:[],displayName:"PixelGraphCanvasOffscreenWebGLSync",props:{virtId:{required:!0,tsType:{name:"string"},description:""},dummy:{required:!1,tsType:{name:"boolean"},description:""},className:{required:!1,tsType:{name:"string"},description:"",defaultValue:{value:"''",computed:!1}},active:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},intGraphs:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},showMatrix:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},fullScreen:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},db:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},onDoubleClick:{required:!1,tsType:{name:"any"},description:""}}};const PixelGraph=_ref=>{let{virtId,dummy=!1,className="",active=!1,intGraphs=!1,showMatrix=!1,fullScreen=!1,db=!1,onDoubleClick,fill=!1}=_ref;const variants=(0,useStore.A)(state=>{var _state$uiPersist$pixe;return null===(_state$uiPersist$pixe=state.uiPersist.pixelGraphSettings)||void 0===_state$uiPersist$pixe?void 0:_state$uiPersist$pixe.variants});return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["original"===variants&&(0,jsx_runtime.jsx)(PixelGraph_PixelGraphBase,{virtId,dummy,className,active,intGraphs,showMatrix,fullScreen,db,onDoubleClick}),"canvas"===variants&&(0,jsx_runtime.jsx)(PixelGraph_PixelGraphCanvas,{virtId,dummy,className,active,intGraphs,showMatrix,fullScreen,db,onDoubleClick,fill}),"canvasOffscreen"===variants&&(0,jsx_runtime.jsx)(PixelGraph_PixelGraphCanvasOffscreen,{virtId,dummy,className,active,intGraphs,showMatrix,fullScreen,db,onDoubleClick}),"canvasOffscreenWebGL"===variants&&(0,jsx_runtime.jsx)(PixelGraph_PixelGraphCanvasOffscreenWebGL,{virtId,dummy,className,active,intGraphs,showMatrix,fullScreen,db,onDoubleClick}),"canvasOffscreenWebGLSync"===variants&&(0,jsx_runtime.jsx)(PixelGraph_PixelGraphCanvasOffscreenWebGLSync,{virtId,dummy,className,active,intGraphs,showMatrix,fullScreen,db,onDoubleClick})]})},PixelGraph_PixelGraph=PixelGraph;PixelGraph.__docgenInfo={description:"",methods:[],displayName:"PixelGraph",props:{virtId:{required:!0,tsType:{name:"string"},description:""},dummy:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},className:{required:!1,tsType:{name:"string"},description:"",defaultValue:{value:"''",computed:!1}},active:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},intGraphs:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},showMatrix:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},fullScreen:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},db:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},onDoubleClick:{required:!1,tsType:{name:"any"},description:""},fill:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}}}};var immer=__webpack_require__("./node_modules/immer/dist/immer.mjs");const useMatrixEditor_excluded=["oldRow","oldCol"],Actions_assignPixels=_ref=>{let{m,rowN,colN,currentCell,currentDevice,selectedPixel,direction,setM,closeClear,pixelGroups,setPixelGroups,newGroupId}=_ref,updatedM=clone(m);const[col,row]=currentCell;if("number"==typeof selectedPixel)updatedM[row][col]={deviceId:currentDevice,pixel:selectedPixel,group:newGroupId};else for(let index=0;index<=Math.abs(selectedPixel[1]-selectedPixel[0]);index+=1){const newM={deviceId:currentDevice,pixel:Math.min(selectedPixel[0],selectedPixel[1])+index,group:newGroupId};if(direction.includes("diagonal-top-right"))for(let index=0;index<=Math.abs(selectedPixel[1]-selectedPixel[0])&&row-index>=0&&col+index<colN;index++){const newM={deviceId:currentDevice,pixel:Math.min(selectedPixel[0],selectedPixel[1])+index,group:newGroupId};updatedM[row-index][col+index]=newM}else if(direction.includes("diagonal-bottom-right"))for(let index=0;index<=Math.abs(selectedPixel[1]-selectedPixel[0])&&row+index<rowN&&col+index<colN;index++){const newM={deviceId:currentDevice,pixel:Math.min(selectedPixel[0],selectedPixel[1])+index,group:newGroupId};updatedM[row+index][col+index]=newM}else if(direction.includes("diagonal-bottom-left"))for(let index=0;index<=Math.abs(selectedPixel[1]-selectedPixel[0])&&row+index<rowN&&col-index>=0;index++){const newM={deviceId:currentDevice,pixel:Math.min(selectedPixel[0],selectedPixel[1])+index,group:newGroupId};updatedM[row+index][col-index]=newM}else if(direction.includes("diagonal-top-left"))for(let index=0;index<=Math.abs(selectedPixel[1]-selectedPixel[0])&&row-index>=0&&col-index>=0;index++){const newM={deviceId:currentDevice,pixel:Math.min(selectedPixel[0],selectedPixel[1])+index,group:newGroupId};updatedM[row-index][col-index]=newM}else direction.includes("right")?direction.includes("flip")?updatedM[row-Math.floor((index+col)/colN)][(index+col)%colN]=newM:updatedM[row+Math.floor((index+col)/colN)][(index+col)%colN]=newM:direction.includes("bottom")?direction.includes("flip")?updatedM[(index+row)%rowN][col-Math.floor((index+row)/rowN)]=newM:updatedM[(index+row)%rowN][col+Math.floor((index+row)/rowN)]=newM:direction.includes("left")?direction.includes("flip")?updatedM[row+Math.abs(Math.floor((col-index)/colN))][(colN+(col-index)%colN)%colN]=newM:updatedM[row-Math.abs(Math.floor((col-index)/colN))][(colN+(col-index)%colN)%colN]=newM:direction.includes("top")&&(direction.includes("flip")?updatedM[(rowN+(row-index)%rowN)%rowN][col+Math.abs(Math.floor((row-index)/rowN))]=newM:updatedM[(rowN+(row-index)%rowN)%rowN][col-Math.abs(Math.floor((row-index)/rowN))]=newM)}if(direction.includes("right-snake"))if(direction.includes("flip"))for(let i=row;i>=0;i-=1){const currentRow=[...updatedM[i]];(i+row)%2==1&&(updatedM[i]=currentRow.reverse())}else for(let i=row;i<rowN;i+=1){const currentRow=[...updatedM[i]];(i+row)%2==1&&(updatedM[i]=currentRow.reverse())}if(direction.includes("bottom-snake"))if(direction.includes("flip")){const mat=clone(updatedM),temp=(0,helpers.mg)(mat);for(let i=col;i>=0;i-=1){const currentCol=[...temp[i]];(i+col)%2==1&&(temp[i]=currentCol.reverse())}updatedM=(0,helpers.mg)(temp)}else{const mat=clone(updatedM),temp=(0,helpers.mg)(mat);for(let i=col;i<colN;i+=1){const currentCol=[...temp[i]];(i+col)%2==1&&(temp[i]=currentCol.reverse())}updatedM=(0,helpers.mg)(temp)}if(direction.includes("left-snake"))if(direction.includes("flip"))for(let i=row;i<rowN;i+=1){const currentRow=[...updatedM[i]];(i+row)%2==1&&(updatedM[i]=currentRow.reverse())}else for(let i=row;i>=0;i-=1){const currentRow=[...updatedM[i]];(i+row)%2==1&&(updatedM[i]=currentRow.reverse())}if(direction.includes("top-snake"))if(direction.includes("flip")){const mat=clone(updatedM),temp=(0,helpers.mg)(mat);for(let i=col;i<colN;i+=1){const currentCol=[...temp[i]];(i+col)%2==1&&(temp[i]=currentCol.reverse())}updatedM=(0,helpers.mg)(temp)}else{const mat=clone(updatedM),temp=(0,helpers.mg)(mat);for(let i=col;i>=0;i-=1){const currentCol=[...temp[i]];(i+col)%2==1&&(temp[i]=currentCol.reverse())}updatedM=(0,helpers.mg)(temp)}setPixelGroups(pixelGroups+1),setM(updatedM),closeClear()};var OpenInNew=__webpack_require__("./node_modules/@mui/icons-material/esm/OpenInNew.js");const ExternalEditorPlaceholder=()=>{const setExternalEditorOpen=(0,useStore.A)(state=>state.setExternalEditorOpen),externalStudioRef=(0,useStore.A)(state=>state.externalStudioRef),setExternalStudioRef=(0,useStore.A)(state=>state.setExternalStudioRef);return(0,jsx_runtime.jsxs)(Box.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",p:3,textAlign:"center",position:"absolute",top:0,left:0,right:0,bottom:0,zIndex:1e3,backgroundColor:"rgba(0, 0, 0, 0.9)"},children:[(0,jsx_runtime.jsx)(OpenInNew.A,{sx:{fontSize:60,color:"primary.main",mb:2}}),(0,jsx_runtime.jsx)(Typography.A,{variant:"h5",gutterBottom:!0,children:"Matrix is being edited in an external window."}),(0,jsx_runtime.jsx)(Typography.A,{color:"text.secondary",sx:{mb:3},children:"Please save your changes in the MatrixStudio tab to unlock this editor."}),(0,jsx_runtime.jsx)(Button.A,{variant:"outlined",color:"warning",onClick:()=>{const windowToClose=externalStudioRef;setExternalStudioRef(null),setExternalEditorOpen(!1),windowToClose&&!windowToClose.closed&&windowToClose.postMessage({source:"LedFx",action:"close"},"https://studio.ledfx.stream"),setExternalEditorOpen(!1)},children:"Force Close & Discard External Changes"})]})},EditMatrix=(0,react.forwardRef)((_ref,ref)=>{let{virtual}=_ref;const classes=M_styles(),points=(0,useStore.A)(state=>state.points),setVirtualEditorIsDirty=(0,useStore.A)(state=>state.setVirtualEditorIsDirty),isExternalEditorOpen=(0,useStore.A)(state=>state.isExternalEditorOpen),matrixEditorApi=(virtual=>{const[rowN,setRowNumber]=(0,react.useState)(virtual.config.rows||8),[colN,setColNumber]=(0,react.useState)(Math.ceil(virtual.pixel_count/(virtual.config.rows||1))||8),[m,setM]=(0,react.useState)(()=>virtual.segments.length>0?reverseProcessArray(virtual.segments,colN):Array(rowN).fill(Array(colN).fill(MCell))),[selectedGroup,setSelectedGroup]=(0,react.useState)(""),[dndMode,setDndMode]=(0,react.useState)("pixel"),[dnd,setDnd]=(0,react.useState)(!1),[isDragging,setIsDragging]=(0,react.useState)(!1),[hoveringCell,setHoveringCell]=(0,react.useState)([-1,-1]),[showPixelGraph,setShowPixelGraph]=(0,react.useState)(!1),[pixelGroups,setPixelGroups]=(0,react.useState)(0),[error,setError]=(0,react.useState)([]),devices=(0,useStore.A)(state=>state.devices),initialMatrixSnapshot=(0,useStore.A)(state=>state.virtualEditorSnapshot),getVirtuals=(0,useStore.A)(state=>state.getVirtuals),getDevices=(0,useStore.A)(state=>state.getDevices),addVirtual=(0,useStore.A)(state=>state.addVirtual),addDevice=(0,useStore.A)(state=>state.addDevice),setEffect=(0,useStore.A)(state=>state.setEffect),updateVirtual=(0,useStore.A)(state=>state.updateVirtual),uniqueGroups=(0,react.useMemo)(()=>{const groups=new Set;return m.flat().forEach(cell=>{cell.group&&"string"==typeof cell.group&&"0-0"!==cell.group&&groups.add(cell.group)}),0===pixelGroups&&groups.size>0&&setPixelGroups(groups.size),Array.from(groups)},[m,pixelGroups]),executeGroupMove=(0,react.useCallback)((groupId,rowOffset,colOffset)=>{const groupPixels=[];for(let i=0;i<rowN;i++)for(let j=0;j<colN;j++)m[i][j].group===groupId&&groupPixels.push((0,objectSpread2.A)((0,objectSpread2.A)({},m[i][j]),{},{oldRow:i,oldCol:j}));if(0!==groupPixels.length){for(const pixel of groupPixels){const targetRow=pixel.oldRow+rowOffset,targetCol=pixel.oldCol+colOffset;if(targetRow<0||targetRow>=rowN||targetCol<0||targetCol>=colN)return;const targetCell=m[targetRow][targetCol];if(""!==targetCell.deviceId&&targetCell.group!==groupId)return}setM((0,immer.jM)(draft=>{for(const pixel of groupPixels)draft[pixel.oldRow][pixel.oldCol]={deviceId:"",pixel:0,group:""};for(const pixel of groupPixels){const targetRow=pixel.oldRow+rowOffset,targetCol=pixel.oldCol+colOffset,{oldRow,oldCol}=pixel,pixelData=(0,objectWithoutProperties.A)(pixel,useMatrixEditor_excluded);draft[targetRow][targetCol]=pixelData}}))}},[m,rowN,colN]),handleDragStart=(0,react.useCallback)(event=>{if(setIsDragging(!0),"group"===dndMode){const[col,row]=event.active.id.split("-").map(Number);if(!isNaN(row)&&!isNaN(col)){var _m$row$col;const groupId=null===(_m$row$col=m[row][col])||void 0===_m$row$col?void 0:_m$row$col.group;groupId&&setSelectedGroup(groupId)}}},[dndMode,m]),handleDragEnd=(0,react.useCallback)(event=>{setIsDragging(!1);const{active,over}=event;if(!over||!over.id)return;const[startCol,startRow]=active.id.split("-").map(Number),[endCol,endRow]=over.id.split("-").map(Number);if(!(isNaN(startCol)||isNaN(startRow)||isNaN(endCol)||isNaN(endRow)))if("group"===dndMode){var _m$startRow$startCol;const groupId=null===(_m$startRow$startCol=m[startRow][startCol])||void 0===_m$startRow$startCol?void 0:_m$startRow$startCol.group;groupId&&executeGroupMove(groupId,endRow-startRow,endCol-startCol)}else setM((0,immer.jM)(draft=>{""===draft[endRow][endCol].deviceId&&(draft[endRow][endCol]=draft[startRow][startCol],draft[startRow][startCol]={deviceId:"",pixel:0,group:""})}))},[dndMode,m,executeGroupMove]),handleDragOver=(0,react.useCallback)(event=>{const{over}=event;if(over){const[col,row]=over.id.split("-").map(Number);isNaN(row)||isNaN(col)||setHoveringCell([col,row])}else setHoveringCell([-1,-1])},[]),saveMatrix=(0,react.useCallback)(()=>{var _m$,_initialMatrixSnapsho;const currentRows=m.length,currentCols=(null===(_m$=m[0])||void 0===_m$?void 0:_m$.length)||0,initialRows=(null==initialMatrixSnapshot?void 0:initialMatrixSnapshot.length)||0,initialCols=(null==initialMatrixSnapshot||null===(_initialMatrixSnapsho=initialMatrixSnapshot[0])||void 0===_initialMatrixSnapsho?void 0:_initialMatrixSnapsho.length)||0;currentRows!==initialRows||currentCols!==initialCols?(console.log("Dimensions changed. Performing two-step save..."),addVirtual({id:virtual.id,config:(0,objectSpread2.A)((0,objectSpread2.A)({},virtual.config),{},{rows:currentRows})}).then(()=>(0,ledfx.U)("/api/virtuals/".concat(virtual.id),"POST",{segments:processArray(m.flat(),virtual.id)})).then(()=>{getVirtuals(),getDevices()})):(console.log("Dimensions unchanged. Performing standard save..."),(0,ledfx.U)("/api/virtuals/".concat(virtual.id),"POST",{segments:processArray(m.flat(),virtual.id)}).then(()=>{getVirtuals(),getDevices()}))},[m,virtual,initialMatrixSnapshot,addVirtual,getVirtuals,getDevices]),handleSetRowNumber=(0,react.useCallback)(n=>{addVirtual({id:virtual.id,config:{rows:n}}).then(()=>{getVirtuals(),getDevices()}).then(()=>saveMatrix()),setRowNumber(n)},[addVirtual,getDevices,getVirtuals,saveMatrix,virtual.id]),handleSetColNumber=(0,react.useCallback)(n=>{saveMatrix(),setColNumber(n)},[saveMatrix]),transposeMatrix=(0,react.useCallback)(()=>setM((0,helpers.mg)(m)),[m]),swapVertical=(0,react.useCallback)(()=>setM((0,immer.jM)(draft=>draft.reverse())),[]),swapHorizontal=(0,react.useCallback)(()=>setM((0,immer.jM)(draft=>{draft.forEach(row=>row.reverse())})),[]),resetMatrix=(0,react.useCallback)(()=>setM(reverseProcessArray(virtual.segments,colN)),[virtual.segments,colN]),clearMatrix=(0,react.useCallback)(()=>{setM(Array(rowN).fill(Array(colN).fill(MCell))),setPixelGroups(0)},[rowN,colN]),clearPixel=(0,react.useCallback)(cell=>{const[col,row]=cell;setM((0,immer.jM)(draft=>{draft[row][col]={deviceId:"",pixel:0,group:""}}))},[]),clearPixelGroup=(0,react.useCallback)(groupId=>{selectedGroup===groupId&&setSelectedGroup(""),setM((0,immer.jM)(draft=>{for(let i=0;i<rowN;i++)for(let j=0;j<colN;j++)draft[i][j].group===groupId&&(draft[i][j]={deviceId:"",pixel:0,group:""})})),setPixelGroups(pg=>pg-1)},[rowN,colN,selectedGroup]);return(0,react.useEffect)(()=>{0===virtual.segments.length?Object.values(devices).some(d=>d.id==="gap-".concat(virtual.id))||addDevice({type:"dummy",config:{center_offset:0,icon_name:"mdi:eye-off",name:"gap-".concat(virtual.id),pixel_count:4096,refresh_rate:64}}).then(()=>{(0,ledfx.U)("/api/virtuals/".concat(virtual.id),"POST",{segments:[["gap-".concat(virtual.id),0,virtual.config.rows*virtual.config.rows-1,!1]]}).then(()=>{getDevices(),getVirtuals().then(()=>{setEffect(virtual.id,"equalizer2d",{bands:virtual.config.rows},!0).then(()=>{updateVirtual(virtual.id,!0)})})})}):setM(reverseProcessArray(virtual.segments,colN))},[]),{m,rowN,colN,selectedGroup,dnd,isDragging,hoveringCell,uniqueGroups,showPixelGraph,pixelGroups,error,dndMode,setDndMode,clearPixel,clearPixelGroup,handleDragStart,handleDragEnd,handleDragOver,setRowNumber:handleSetRowNumber,setColNumber:handleSetColNumber,setSelectedGroup,setDnd,setShowPixelGraph,transposeMatrix,swapVertical,swapHorizontal,resetMatrix,clearMatrix,saveMatrix,setM,setPixelGroups,setError}})(virtual);(0,react.useImperativeHandle)(ref,()=>({saveMatrix:matrixEditorApi.saveMatrix}));const assignPixelDialogApi=(dependencies=>{const{m,setM,rowN,colN,pixelGroups,setPixelGroups,clearPixel}=dependencies,[isOpen,setIsOpen]=(0,react.useState)(!1),[currentCell,setCurrentCell]=(0,react.useState)([-1,-1]),[currentDevice,setCurrentDevice]=(0,react.useState)(""),[isGroupMode,setIsGroupMode]=(0,react.useState)(!1),[selectedPixel,setSelectedPixel]=(0,react.useState)(0),[direction,setDirection]=(0,react.useState)("right"),deviceRef=(0,react.useRef)(null),openDialog=(0,react.useCallback)((cell,initialData)=>{setCurrentCell(cell),setCurrentDevice(initialData.deviceId||""),setSelectedPixel(initialData.pixel||0),setIsGroupMode(!1),setDirection("right"),setIsOpen(!0)},[]),closeDialog=(0,react.useCallback)(()=>{setIsOpen(!1)},[]),handleDirectionChange=(0,react.useCallback)(d=>{if(setDirection(d),"number"!=typeof selectedPixel){const[col,row]=currentCell,maxRange=getMaxRange(d,row,col,rowN,colN);selectedPixel[1]-selectedPixel[0]>maxRange&&setSelectedPixel([selectedPixel[0],selectedPixel[0]+maxRange])}},[currentCell,rowN,colN,selectedPixel]),handleSliderChange=(0,react.useCallback)((_e,newPixelRange,activeThumb)=>{if("number"!=typeof newPixelRange){const[col,row]=currentCell,maxRange=getMaxRange(direction,row,col,rowN,colN),distance=Math.abs(newPixelRange[1]-newPixelRange[0]);let adjustedLeftThumb=newPixelRange[0],adjustedRightThumb=newPixelRange[1];distance>maxRange&&(0===activeThumb?adjustedRightThumb=adjustedLeftThumb+maxRange:adjustedLeftThumb=adjustedRightThumb-maxRange);const updatedSelectedPixel=direction.includes("top")?[adjustedRightThumb,adjustedLeftThumb]:[adjustedLeftThumb,adjustedRightThumb];setSelectedPixel(updatedSelectedPixel)}else setSelectedPixel(newPixelRange)},[currentCell,direction,rowN,colN]),save=(0,react.useCallback)(()=>{const newGroupId="group-".concat(pixelGroups);Actions_assignPixels({m,rowN,colN,currentCell,currentDevice,selectedPixel,direction,setM,closeClear:closeDialog,pixelGroups,setPixelGroups,newGroupId})},[m,rowN,colN,currentCell,currentDevice,selectedPixel,direction,setM,closeDialog,pixelGroups,setPixelGroups]);return(0,react.useEffect)(()=>{isGroupMode&&"number"==typeof selectedPixel?setSelectedPixel([selectedPixel,selectedPixel+1]):isGroupMode||"number"==typeof selectedPixel||setSelectedPixel(selectedPixel[0])},[isGroupMode]),{isOpen,currentCell,currentDevice,isGroupMode,direction,selectedPixel,deviceRef,openDialog,closeDialog,setCurrentDevice,setIsGroupMode,handleDirectionChange,handleSliderChange,save,handleClear:()=>{clearPixel(currentCell),closeDialog()}}})({m:matrixEditorApi.m,setM:matrixEditorApi.setM,rowN:matrixEditorApi.rowN,colN:matrixEditorApi.colN,pixelGroups:matrixEditorApi.pixelGroups,setPixelGroups:matrixEditorApi.setPixelGroups,clearPixel:matrixEditorApi.clearPixel}),[anchorEl,setAnchorEl]=(0,react.useState)(null),[contextMenuCell,setContextMenuCell]=(0,react.useState)([-1,-1]),[initialSnapshot,setInitialSnapshot]=(0,react.useState)(null),closeMenu=()=>setAnchorEl(null);return(0,react.useEffect)(()=>{matrixEditorApi.m&&setInitialSnapshot(JSON.parse(JSON.stringify(matrixEditorApi.m))),setVirtualEditorIsDirty(!1)},[virtual.id,setVirtualEditorIsDirty]),(0,react.useEffect)(()=>{initialSnapshot&&matrixEditorApi.m&&((0,helpers.bD)(initialSnapshot,matrixEditorApi.m)?setVirtualEditorIsDirty(!1):setVirtualEditorIsDirty(!0))},[matrixEditorApi.m,initialSnapshot,setVirtualEditorIsDirty]),(0,react.useEffect)(()=>{matrixEditorApi.setM(Array(matrixEditorApi.rowN).fill(Array(matrixEditorApi.colN).fill(MCell)))},[matrixEditorApi.rowN,matrixEditorApi.colN,matrixEditorApi.setM]),(0,react.useEffect)(()=>{if(points.length>0){const updatedM=clone(matrixEditorApi.m),p=points[points.length-1];!isNaN(p.x)&&!isNaN(p.y)&&p.x>0&&p.y>0&&p.x<=matrixEditorApi.colN&&p.y<=matrixEditorApi.rowN&&(updatedM[p.y-1][p.x-1]={deviceId:p.device,pixel:p.led,group:"group-".concat(p.segment+1)},matrixEditorApi.setM(updatedM))}},[points,matrixEditorApi.colN,matrixEditorApi.rowN,matrixEditorApi.m,matrixEditorApi.setM]),(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[isExternalEditorOpen&&(0,jsx_runtime.jsx)(ExternalEditorPlaceholder,{}),(0,jsx_runtime.jsx)(MatrixEditorContext.Provider,{value:matrixEditorApi,children:(0,jsx_runtime.jsxs)(EditMatrix_MWrapper,{move:matrixEditorApi.dnd,children:[(0,jsx_runtime.jsx)(Stack.A,{direction:"column",spacing:2,sx:{height:"100%",overflowX:"hidden",flex:"0 0 480px",paddingTop:"1rem",bgcolor:"action.disabledBackground",p:0},children:(0,jsx_runtime.jsx)(MControls_MControls,{virtual,m:matrixEditorApi.m,setM:matrixEditorApi.setM})}),(0,jsx_runtime.jsx)(Box.A,{sx:{flexGrow:1,overflow:"hidden",height:"100%"},children:(0,jsx_runtime.jsx)(index_esm.GT,{disabled:matrixEditorApi.dnd||"group"===matrixEditorApi.dndMode,centerZoomedOut:!0,minScale:.1,children:(0,jsx_runtime.jsx)(index_esm.WZ,{children:(0,jsx_runtime.jsxs)("div",{className:classes.gridCellContainer,style:{width:100*matrixEditorApi.colN,height:100*matrixEditorApi.rowN},children:[(0,jsx_runtime.jsx)("div",{style:{display:"flex",flexDirection:"column",zIndex:1},children:(0,jsx_runtime.jsx)(core_esm.Mp,{modifiers:[modifiers_esm.Mk],onDragStart:matrixEditorApi.handleDragStart,onDragEnd:matrixEditorApi.handleDragEnd,onDragOver:matrixEditorApi.handleDragOver,children:matrixEditorApi.m.map((yzrow,currentRowIndex)=>(0,jsx_runtime.jsx)("div",{style:{display:"flex"},children:yzrow.map((yzcolumn,currentColIndex)=>(0,jsx_runtime.jsx)(EditMatrix_Droppable,{id:"".concat(currentColIndex,"-").concat(currentRowIndex),bg:""!==yzcolumn.deviceId?"transparent":"#00000090",onContextMenu:e=>((e,col,row)=>{var _matrixEditorApi$m$ro;e.preventDefault(),e.stopPropagation();const cellData=null===(_matrixEditorApi$m$ro=matrixEditorApi.m[row])||void 0===_matrixEditorApi$m$ro?void 0:_matrixEditorApi$m$ro[col];null!=cellData&&cellData.deviceId?(setContextMenuCell([col,row]),setAnchorEl(e.currentTarget)):cellData&&assignPixelDialogApi.openDialog([col,row],cellData)})(e,currentColIndex,currentRowIndex),onClick:()=>{"group"===matrixEditorApi.dndMode&&""===yzcolumn.deviceId&&matrixEditorApi.setSelectedGroup("")},children:(0,jsx_runtime.jsx)(Box.A,{sx:{opacity:1},children:matrixEditorApi.dnd?""!==yzcolumn.deviceId?(0,jsx_runtime.jsx)(EditMatrix_Draggable,{id:"".concat(currentColIndex,"-").concat(currentRowIndex),children:(0,jsx_runtime.jsx)(EditMatrix_Pixel,{classes,yzcolumn})}):null:(0,jsx_runtime.jsx)(EditMatrix_Pixel,{classes,yzcolumn})})},"col-".concat(currentColIndex)))},"row-".concat(currentRowIndex)))})}),virtual.id&&matrixEditorApi.showPixelGraph&&(0,jsx_runtime.jsx)(PixelGraph_PixelGraph,{showMatrix:!0,virtId:virtual.id,active:!0,dummy:!1,fullScreen:!0,fill:!0}),(0,jsx_runtime.jsx)(EditMatrix_MContextMenu,{anchorEl,closeContextMenu:closeMenu,currentCell:contextMenuCell,onEdit:()=>{var _matrixEditorApi$m$ro2;const[col,row]=contextMenuCell,cellData=null===(_matrixEditorApi$m$ro2=matrixEditorApi.m[row])||void 0===_matrixEditorApi$m$ro2?void 0:_matrixEditorApi$m$ro2[col];cellData&&assignPixelDialogApi.openDialog(contextMenuCell,cellData),closeMenu()}}),(0,jsx_runtime.jsx)(EditMatrix_AssignPixelDialog,{dialogApi:assignPixelDialogApi})]})})})})]})})]})}),M=EditMatrix;EditMatrix.__docgenInfo={description:"",methods:[],displayName:"EditMatrix",props:{virtual:{required:!0,tsType:{name:"any"},description:""}}};const UnsavedChangesDialog=_ref=>{let{open,onSave,onDiscard,onCancel}=_ref;return(0,jsx_runtime.jsxs)(Dialog.A,{open,onClose:onCancel,children:[(0,jsx_runtime.jsx)(DialogTitle.A,{children:"Unsaved Changes"}),(0,jsx_runtime.jsx)(DialogContent.A,{children:(0,jsx_runtime.jsx)(DialogContentText.A,{children:"You have unsaved changes. Are you sure you want to leave?"})}),(0,jsx_runtime.jsxs)(DialogActions.A,{children:[(0,jsx_runtime.jsx)(Button.A,{onClick:onCancel,children:"Stay"}),(0,jsx_runtime.jsx)(Button.A,{onClick:onDiscard,children:"Discard Changes"}),(0,jsx_runtime.jsx)(Button.A,{onClick:onSave,variant:"contained",autoFocus:!0,children:"Save Changes"})]})]})},EditVirtuals_Transition=react.forwardRef(function Transition(props,ref){return(0,jsx_runtime.jsx)(Slide.A,(0,objectSpread2.A)({direction:"up",ref},props))}),MuiMenuItem=react.forwardRef((props,ref)=>{const{children}=props;return(0,jsx_runtime.jsx)(MenuItem.A,(0,objectSpread2.A)((0,objectSpread2.A)({ref},props),{},{children}))});function EditVirtuals(_ref2){var _virtual$segments;let{virtId,icon=(0,jsx_runtime.jsx)(Settings.A,{}),startIcon,label="",type,className,color="inherit",variant="contained",onClick=()=>{},innerKey,sx}=_ref2;const[matrix,setMatrix]=(0,react.useState)(!1),currentVirtual=(0,useStore.A)(state=>state.currentVirtual),setCurrentVirtual=(0,useStore.A)(state=>state.setCurrentVirtual),calibrationMode=(0,useStore.A)(state=>state.calibrationMode),classes=EditVirtuals_styles(),showSnackbar=(0,useStore.A)(state=>state.ui.showSnackbar),getDevices=(0,useStore.A)(state=>state.getDevices),virtuals=(0,useStore.A)(state=>state.virtuals),setDialogOpenEditVirtual=(0,useStore.A)(state=>state.setDialogOpenEditVirtual),activeSegment=(0,useStore.A)(state=>state.activeSegment),highlightSegment=(0,useStore.A)(state=>state.highlightSegment),isExternalEditorOpen=(0,useStore.A)(state=>state.isExternalEditorOpen),platform=(0,useStore.A)(state=>state.platform),isDirty=(0,useStore.A)(state=>state.virtualEditorIsDirty),setVirtualEditorIsDirty=(0,useStore.A)(state=>state.setVirtualEditorIsDirty),[showUnsavedDialog,setShowUnsavedDialog]=(0,react.useState)(!1),[nextAction,setNextAction]=(0,react.useState)(null),virtual=(0,react.useMemo)(()=>virtuals[currentVirtual||virtId],[virtuals,currentVirtual,virtId]),[open,setOpen]=react.useState(!!currentVirtual||!1),[calib,setCalib]=react.useState(!0),matrixEditorRef=(0,react.useRef)(null),closeAndReset=(0,react.useCallback)(()=>{setOpen(!1),setDialogOpenEditVirtual(!1),setCurrentVirtual(null),onClick()},[setDialogOpenEditVirtual,setCurrentVirtual,onClick]),handleSaveAndExit=(0,react.useCallback)(()=>{console.log("saveVirtual",virtual.id),matrixEditorRef.current&&matrixEditorRef.current.saveMatrix(),setVirtualEditorIsDirty(!1),setShowUnsavedDialog(!1),nextAction?nextAction():closeAndReset()},[null==virtual?void 0:virtual.id,nextAction,closeAndReset,setVirtualEditorIsDirty]),handleDiscardAndExit=(0,react.useCallback)(()=>{setVirtualEditorIsDirty(!1),setShowUnsavedDialog(!1),nextAction?nextAction():closeAndReset()},[nextAction,closeAndReset,setVirtualEditorIsDirty]),handleCancelExit=(0,react.useCallback)(()=>{setShowUnsavedDialog(!1),setNextAction(null)},[]),handleClickOpen=(0,react.useCallback)(()=>{setOpen(!0)},[]),handleClose=(0,react.useCallback)(()=>{if(isDirty)return setNextAction(()=>closeAndReset),void setShowUnsavedDialog(!0);const output=(0,helpers.i5)(null==virtual?void 0:virtual.segments),overlap=Object.keys(output).find(k=>output[k].overlap);overlap?showSnackbar("warning","Overlapping in ".concat(overlap," detected! Please Check your config")):closeAndReset()},[isDirty,null==virtual?void 0:virtual.segments,showSnackbar,closeAndReset]);(0,react.useEffect)(()=>{getDevices()},[getDevices]),(0,react.useEffect)(()=>{currentVirtual&&"hidden"===type&&setOpen(!0)},[currentVirtual,type]),(0,react.useEffect)(()=>(null!=virtual&&virtual.id&&open&&calibrationMode(null==virtual?void 0:virtual.id,"on"),()=>{null!=virtual&&virtual.id&&open&&calibrationMode(null==virtual?void 0:virtual.id,"off")}),[null==virtual?void 0:virtual.id,open,calibrationMode]),(0,react.useEffect)(()=>{matrix&&setCalib(!1)},[matrix]),(0,react.useEffect)(()=>{isExternalEditorOpen&&!matrix&&setMatrix(!0)},[isExternalEditorOpen,matrix]);const handleMenuItemClick=(0,react.useCallback)(e=>{e.preventDefault(),handleClickOpen()},[handleClickOpen]),handleToggleMatrix=(0,react.useCallback)(()=>{isDirty?(setNextAction(()=>()=>setMatrix(!matrix)),setShowUnsavedDialog(!0)):setMatrix(!matrix)},[isDirty,matrix]),handleToggleCalibration=(0,react.useCallback)(()=>{calibrationMode(virtual.id,calib?"off":"on"),!calib&&virtual.segments[activeSegment]&&highlightSegment(virtual.id,virtual.segments[activeSegment][0],virtual.segments[activeSegment][1],virtual.segments[activeSegment][2],virtual.segments[activeSegment][3]),setCalib(!calib)},[calibrationMode,null==virtual?void 0:virtual.id,null==virtual?void 0:virtual.segments,calib,activeSegment,highlightSegment]),backButtonStyle=(0,react.useMemo)(()=>({marginRight:"1rem",paddingRight:"1rem"}),[]),toggleButtonGroupStyle=(0,react.useMemo)(()=>({marginRight:"1rem"}),[]);return virtual&&virtual.config?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["menuItem"===type?(0,jsx_runtime.jsxs)(MuiMenuItem,{className,onClick:handleMenuItemClick,children:[(0,jsx_runtime.jsx)(ListItemIcon.A,{children:icon}),label]},innerKey):"hidden"===type?null:(0,jsx_runtime.jsxs)(Button.A,{variant,startIcon,color,onClick:handleClickOpen,size:"small",className,sx,children:[label,!startIcon&&icon]}),(0,jsx_runtime.jsxs)(Dialog.A,{fullScreen:!0,open,onClose:handleClose,TransitionComponent:EditVirtuals_Transition,PaperProps:{sx:{paddingTop:is_electron_default()()&&"darwin"!==platform?"32px":0}},children:[(0,jsx_runtime.jsx)(AppBar.A,{enableColorOnDark:!0,color:"secondary",className:classes.appBar,children:(0,jsx_runtime.jsxs)(Toolbar.A,{children:[(0,jsx_runtime.jsxs)(Button.A,{autoFocus:!0,color:"primary",variant:"contained",startIcon:(0,jsx_runtime.jsx)(NavigateBefore.A,{}),onClick:handleClose,style:backButtonStyle,disabled:isExternalEditorOpen,children:["Back",isDirty&&(0,jsx_runtime.jsx)(Badge.A,{color:"error",badgeContent:" ",variant:"dot",sx:{marginLeft:1,marginTop:-2},children:" "})]}),(virtual.config.rows||1)>1&&(0,jsx_runtime.jsxs)(ToggleButtonGroup.A,{value:matrix,disabled:isExternalEditorOpen,style:toggleButtonGroupStyle,size:"small",exclusive:!0,onChange:handleToggleMatrix,"aria-label":"mode",children:[(0,jsx_runtime.jsx)(ToggleButton.A,{value:!1,children:(0,jsx_runtime.jsx)(BladeIcon.A,{name:"mdi:led-strip"})}),(0,jsx_runtime.jsx)(ToggleButton.A,{value:!0,children:(0,jsx_runtime.jsx)(GridOn.A,{})})]}),(0,jsx_runtime.jsxs)(Typography.A,{variant:"h6",className:classes.title,children:[virtual.config.name," "]}),(virtual.config.rows||1)>1&&(0,jsx_runtime.jsx)(Tours_Tour2dVirtual,{}),!matrix&&(0,jsx_runtime.jsx)(Tooltip.A,{title:"Preview Effect",children:(0,jsx_runtime.jsx)(IconButton.A,{onClick:handleToggleCalibration,children:calib?(0,jsx_runtime.jsx)(Visibility.A,{}):(0,jsx_runtime.jsx)(VisibilityOff.A,{})})})]})}),matrix?(0,jsx_runtime.jsx)(M,{virtual,ref:matrixEditorRef}):(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("div",{className:classes.segmentTitle,children:(0,jsx_runtime.jsx)(Typography.A,{variant:"caption",children:"Segments-Settings"})}),(null===(_virtual$segments=virtual.segments)||void 0===_virtual$segments?void 0:_virtual$segments.length)>0&&virtual.segments.map((s,i)=>(0,jsx_runtime.jsx)(EditVirtuals_Segment,{s,i,virtual,segments:virtual.segments,calib},"".concat(virtual.id,"-segment-").concat(s[0],"-").concat(i))),(0,jsx_runtime.jsxs)("div",{className:classes.segmentButtonWrapper,children:[(0,jsx_runtime.jsx)(ConfirmationDialog,{virtual}),(0,jsx_runtime.jsx)(Dialogs_AddExistingSegmentDialog,{virtual})]})]})]}),(0,jsx_runtime.jsx)(UnsavedChangesDialog,{open:showUnsavedDialog,onSave:handleSaveAndExit,onDiscard:handleDiscardAndExit,onCancel:handleCancelExit})]}):null}EditVirtuals.__docgenInfo={description:"",methods:[],displayName:"EditVirtuals",props:{icon:{defaultValue:{value:"<Settings />",computed:!1},required:!1},label:{defaultValue:{value:"''",computed:!1},required:!1},color:{defaultValue:{value:"'inherit'",computed:!1},required:!1},variant:{defaultValue:{value:"'contained'",computed:!1},required:!1},onClick:{defaultValue:{value:"() => {}",computed:!1},required:!1}}};const DeviceCard_styles=(0,makeStyles.A)(theme=>({virtualCardPortraitW:{margin:"0.5rem",display:"flex",alignItems:"flex-start",flexDirection:"column",minWidth:"230px",maxWidth:"400px",width:"100%",height:"100%",position:"relative",borderRadius:10,borderColor:"transparent",textDecoration:"none","@media (max-width: 410px)":{margin:"0.25rem 0"}},virtualCardPortrait:{padding:"0rem 0.6rem 0.2rem 0.6rem",display:"flex",alignItems:"flex-start",flexDirection:"column",minWidth:"230px",maxWidth:"400px",width:"100%",height:"100%",position:"relative",borderRadius:10,borderColor:"transparent"},virtualIconWrapper:{width:"50px",height:"55px",marginRight:"0.5rem"},virtualIcon:{marginBottom:"4px",marginRight:"0.5rem",fontSize:"50px",position:"absolute",transformOrigin:"top left","&.graphs":{transformOrigin:"center left"},transition:"transform 0.3s ease-in-out",transitionDelay:"0s","&.extended":{transform:"scale(1.7) translateY(3px);",transformOrigin:"top left",transition:"transform 0.3s ease-in-out",transitionDelay:"0s"},"&.extended.graphs":{transform:"scale(1.25)",transformOrigin:"center left",transition:"transform 0.3s ease-in-out",transitionDelay:"0s"},"& svg":{transform:"unset",width:"100%",marginTop:"3px",height:"100%"}},virtualCardContainer:{display:"flex",alignItems:"center",width:"100%",height:"100%",minHeight:"73px",padding:"0 0.3rem",justifyContent:"space-between",flexDirection:"row","@media (max-width: 470px)":{paddingRight:"0"}},virtualSubline:{padding:"0 0.5rem"},iconMedia:{height:140,display:"flex",alignItems:"center",margin:"0 auto",fontSize:100,"& > span:before":{position:"relative"}},editButton:{minWidth:"unset"},editButtonMobile:{minWidth:"unset",flexGrow:1},buttonBarMobile:{width:"100%",height:"100%",textAlign:"right"},buttonBarMobileWrapper:{height:"100%",display:"flex",margin:0,padding:"0.5rem 80px 0.5rem 0.5rem",background:"dark"===theme.palette.mode?"rgba(0,0,0,0.93)":"rgba(240,240,240,1)",color:"dark"===theme.palette.mode?"#fff":"#000","& > div, & > button":{flexGrow:1,flexBasis:"30%"},"&.extended.graphs":{height:"100%",paddingTop:0,"& button":{fontSize:"smaller"}}},pixelbar:{opacity:1,transitionDuration:"0s",width:"100%"},pixelbarOut:{opacity:.2,transition:"opacity",transitionDuration:"1s"}})),DeviceCard=_ref=>{let{graphsMulti,activateDevice,deviceName="My Wled",online=!0,effectName,virtId="yz-quad",index=1,handleDeleteDevice=()=>console.log("DELETING DEVICE"),handleEditVirtual=()=>console.log("EDITING VIRTUAL"),handleEditDevice=()=>console.log("EDITING DEVICE"),handleClearEffect=()=>console.log("CLEARING EFFECT"),handlePlayPause=()=>console.log("PLAY/PAUSE"),handlePlayLast=()=>console.log("PLAY LAST"),linkTo="/",additionalStyle={},iconName="wled",colorIndicator=!0,isPlaying=!0,isStreaming=!1,previewOnly=!0,dummy=!1,isEffectSet=!0,transitionTime=5,isDevice="yz-quad",graphsActive=!0,showMatrix=!1,onContextMenu,lastEffect}=_ref;const classes=DeviceCard_styles(),theme=(0,useTheme.A)(),[fade,_setFade]=(0,react.useState)(!1),[isActive,setIsActive]=(0,react.useState)(isEffectSet||isStreaming),[loading,setLoading]=(0,react.useState)(!1),[expanded,setExpanded]=(0,react.useState)(!1),[hasExpandedOnce,setHasExpandedOnce]=(0,react.useState)(!1),virtuals=(0,useStore.A)(state=>state.virtuals),handleExpandClick=()=>{setExpanded(prev=>{const next=!prev;return next&&setHasExpandedOnce(!0),next})};return(0,react.useEffect)(()=>{setIsActive(isEffectSet||isStreaming)},[isEffectSet,isStreaming]),(0,jsx_runtime.jsx)(chunk_JZWAC4HX.k2,{onContextMenu,to:linkTo,className:"".concat(classes.virtualCardPortraitW," ").concat(isEffectSet?"active":""," ").concat(online?"online":"offline"),style:(0,objectSpread2.A)((0,objectSpread2.A)({},additionalStyle),{},{width:"100%",background:theme.palette.background.paper}),children:(0,jsx_runtime.jsxs)(Card.A,{className:classes.virtualCardPortrait,sx:{background:theme.palette.background.paper,"&:hover":{borderColor:theme.palette.text.disabled}},children:[(0,jsx_runtime.jsxs)("div",{className:classes.virtualCardContainer,children:[(0,jsx_runtime.jsx)("div",{className:classes.virtualIconWrapper,children:(0,jsx_runtime.jsx)(BladeIcon.A,{colorIndicator:!1,name:iconName,className:"".concat(classes.virtualIcon," ").concat(graphsActive?"":"graphs"," ").concat(expanded?"extended":""),style:{zIndex:3,opacity:online?1:.3,color:expanded?"dark"===theme.palette.mode?"#fff":"#000":""},card:!0})}),(0,jsx_runtime.jsxs)("div",{className:classes.virtualSubline,children:[(0,jsx_runtime.jsx)(Fade.A,{in:!expanded,timeout:400,style:{transitionDelay:expanded?"0ms":"300ms",display:"block"},children:(0,jsx_runtime.jsx)(Typography.A,{variant:"h6",style:{lineHeight:1,color:colorIndicator?theme.palette.primary.light:"inherit",opacity:online?1:.3,visibility:expanded?"hidden":"visible"},children:deviceName})}),online?effectName?(0,jsx_runtime.jsx)(Fade.A,{in:!expanded,timeout:hasExpandedOnce?400:0,style:{transitionDelay:hasExpandedOnce?expanded?"0ms":"300ms":"0ms",display:"block"},children:(0,jsx_runtime.jsxs)(Typography.A,{component:"div",variant:"body1",color:"textSecondary",style:{height:25,display:"flex",alignItems:"center",visibility:expanded?"hidden":"visible"},children:[effectName,(0,jsx_runtime.jsxs)("span",{style:{display:"inline-flex",alignItems:"center"},children:[(0,jsx_runtime.jsx)(Button.A,{variant:"text",size:"small",onClick:e=>{e.preventDefault(),handlePlayPause()},style:{color:"#999",minWidth:"unset",zIndex:expanded?1:3},children:isPlaying?(0,jsx_runtime.jsx)(Pause.A,{}):(0,jsx_runtime.jsx)(PlayArrow.A,{})}),(0,jsx_runtime.jsxs)(Box.A,{sx:{m:1,position:"relative"},children:[(0,jsx_runtime.jsx)(Button.A,{size:"small",variant:"text",disabled:loading,onClick:e=>{e.preventDefault(),handleClearEffect(virtId),setLoading(!0),setTimeout(()=>{setLoading(!1)},1e3*(virtuals[virtId].config.transition_time||0))},style:{color:"#999",minWidth:"unset",zIndex:expanded?1:3},children:(0,jsx_runtime.jsx)(Stop.A,{})}),loading&&(0,jsx_runtime.jsx)(CircularProgress.A,{size:24,sx:{position:"absolute",top:"50%",left:"50%",marginTop:"-12px",marginLeft:"-12px"}})]})]})]})}):isStreaming?(0,jsx_runtime.jsx)(Typography.A,{variant:"body1",color:"textSecondary",style:{height:25},children:"Streaming..."}):(0,jsx_runtime.jsxs)(Stack.A,{direction:"row",spacing:1,alignItems:"center",children:[(0,jsx_runtime.jsx)(Typography.A,{variant:"body1",style:{color:theme.palette.text.disabled,height:25},children:"off"}),lastEffect&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(Typography.A,{variant:"body1",style:{color:theme.palette.text.disabled,height:25},children:"Â |Â "}),(0,jsx_runtime.jsx)(Typography.A,{variant:"body1",style:{color:theme.palette.text.disabled,height:25,paddingTop:1},children:lastEffect}),(0,jsx_runtime.jsx)(Button.A,{variant:"text",style:{color:"#999",minWidth:"unset",zIndex:expanded?1:3,padding:0},size:"small",onClick:e=>{e.preventDefault(),e.stopPropagation(),handlePlayLast()},children:(0,jsx_runtime.jsx)(PlayArrow.A,{})})]})]}):(0,jsx_runtime.jsxs)(Typography.A,{variant:"body1",color:"textSecondary",style:{height:25,display:"flex",alignItems:"center"},children:[(0,jsx_runtime.jsx)(Typography.A,{variant:"body1",component:"span",color:"textSecondary",style:{height:25,opacity:online?1:.3},children:"offline"}),(0,jsx_runtime.jsx)(Button.A,{variant:"text",size:"small",onClick:e=>{e.preventDefault(),isDevice&&activateDevice(isDevice)},style:{color:"inherit",marginLeft:"1rem",marginTop:"0rem",minWidth:"unset",zIndex:expanded?1:3},children:(0,jsx_runtime.jsx)(SyncProblem.A,{})})]})]}),(0,jsx_runtime.jsxs)("div",{children:[previewOnly&&(0,jsx_runtime.jsx)(Button.A,{variant:"text",disabled:!0,size:"small",children:(0,jsx_runtime.jsx)(Visibility.A,{})}),dummy&&(0,jsx_runtime.jsx)(Button.A,{variant:"text",disabled:!0,size:"small",children:(0,jsx_runtime.jsx)(PestControl.A,{})})]}),"activated"!==window.localStorage.getItem("guestmode")?(0,jsx_runtime.jsx)(IconButton.A,{sx:[{alignSelf:"flex-start",marginLeft:"auto",transition:theme.transitions.create("transform",{duration:theme.transitions.duration.shortest}),display:"flex"},expanded?{transform:"rotate(180deg)"}:{transform:"rotate(0deg)"}],onClick:e=>{e.preventDefault(),handleExpandClick()},"aria-expanded":expanded,"aria-label":"show more",style:{zIndex:3,color:"#999"},children:(0,jsx_runtime.jsx)(ExpandMore.A,{className:"step-devices-two-".concat(index)})}):(0,jsx_runtime.jsx)(Box.A,{sx:{alignSelf:"flex-start",marginLeft:"auto",display:"block"}})]}),graphsMulti&&(0,jsx_runtime.jsx)("div",{style:{opacity:fade?.2:1,transitionDuration:"".concat(fade?transitionTime||1:transitionTime||0,"s"),width:"100%",transition:"opacity"},children:(0,jsx_runtime.jsx)(PixelGraph_PixelGraph,{showMatrix,intGraphs:graphsActive,active:isActive,virtId:virtId||"",className:"step-devices-seven"})}),(0,jsx_runtime.jsx)("div",{style:{position:"absolute",left:0,top:0,bottom:0,right:0,zIndex:2},children:(0,jsx_runtime.jsx)(Collapse.A,{in:expanded,timeout:"auto",unmountOnExit:!0,className:classes.buttonBarMobile,sx:{height:"100% !important","& .MuiCollapse-wrapper":{height:"100%"}},children:(0,jsx_runtime.jsxs)("div",{className:"".concat(classes.buttonBarMobileWrapper," ").concat(graphsActive?"":"graphs"," ").concat(expanded?"extended":""),onClick:e=>e.preventDefault(),children:[(0,jsx_runtime.jsx)("div",{}),(0,jsx_runtime.jsx)(Fade.A,{in:expanded,timeout:500,children:(0,jsx_runtime.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end",justifyContent:"center"},children:[(0,jsx_runtime.jsx)(Popover.A,{variant:"text",startIcon:(0,jsx_runtime.jsx)(Delete.A,{}),label:"delete",color:"inherit",onConfirm:()=>{handleDeleteDevice(virtId),handleExpandClick()},className:"step-devices-three-".concat(index),style:{width:"100%"}}),isDevice?(0,jsx_runtime.jsx)(Button.A,{variant:"text",color:"inherit",size:"small",startIcon:(0,jsx_runtime.jsx)(Build.A,{}),className:"step-devices-four-".concat(index),onClick:e=>{e.preventDefault(),handleEditDevice(isDevice),handleExpandClick()},sx:theme=>(0,objectSpread2.A)({color:"#fff",bgcolor:"transparent","&:hover":(0,objectSpread2.A)({color:"#000",bgcolor:theme.palette.primary.main},theme.applyStyles("light",{color:"#fff"}))},theme.applyStyles("light",{color:"#000"})),children:"Edit Device"}):(0,jsx_runtime.jsx)(EditVirtuals,{label:"Edit Virtual",variant:"text",color:"inherit",virtId,icon:void 0,className:"step-devices-six",startIcon:(0,jsx_runtime.jsx)(Tune.A,{}),type:void 0,innerKey:void 0,onClick:()=>handleExpandClick(),sx:theme=>(0,objectSpread2.A)({color:"#fff",bgcolor:"transparent","&:hover":(0,objectSpread2.A)({color:"#000",bgcolor:theme.palette.primary.main},theme.applyStyles("light",{color:"#fff"}))},theme.applyStyles("light",{color:"#000"}))}),(0,jsx_runtime.jsx)(Button.A,{variant:"text",size:"small",startIcon:(0,jsx_runtime.jsx)(Settings.A,{}),color:"inherit",className:"step-devices-five-".concat(index),onClick:e=>{e.preventDefault(),handleEditVirtual(virtId),handleExpandClick()},sx:theme=>(0,objectSpread2.A)({color:"#fff",bgcolor:"transparent","&:hover":(0,objectSpread2.A)({color:"#000",bgcolor:theme.palette.primary.main},theme.applyStyles("light",{color:"#fff"}))},theme.applyStyles("light",{color:"#000"})),children:"Settings"})]})})]})})})]})})},DeviceCard_DeviceCard=DeviceCard;DeviceCard.__docgenInfo={description:"Pixelgraphs will not connect via Websocket in Storybook",methods:[],displayName:"DeviceCard",props:{deviceName:{required:!1,tsType:{name:"string"},description:"The Name of the device",defaultValue:{value:"'My Wled'",computed:!1}},iconName:{required:!1,tsType:{name:"string"},description:"IconName. Refer to `Icon`",defaultValue:{value:"'wled'",computed:!1}},effectName:{required:!1,tsType:{name:"union",raw:"string | undefined",elements:[{name:"string"},{name:"undefined"}]},description:"Name of the current Effect",defaultValue:{value:"undefined",computed:!0}},isEffectSet:{required:!1,tsType:{name:"boolean"},description:"Flag if Effect is set",defaultValue:{value:"true",computed:!1}},online:{required:!1,tsType:{name:"boolean"},description:"Is device online",defaultValue:{value:"true",computed:!1}},isPlaying:{required:!1,tsType:{name:"boolean"},description:"Play/Pause",defaultValue:{value:"true",computed:!1}},isStreaming:{required:!1,tsType:{name:"boolean"},description:"Is streaming from other sources",defaultValue:{value:"false",computed:!1}},previewOnly:{required:!1,tsType:{name:"boolean"},description:"Do not send to leds",defaultValue:{value:"true",computed:!1}},dummy:{required:!1,tsType:{name:"boolean"},description:"Dummy Device",defaultValue:{value:"false",computed:!1}},transitionTime:{required:!1,tsType:{name:"number"},description:"TransitionTime of the Device",defaultValue:{value:"5",computed:!1}},isDevice:{required:!1,tsType:{name:"union",raw:"string | boolean | undefined",elements:[{name:"string"},{name:"boolean"},{name:"undefined"}]},description:"DeviceId if its a device, else undefined if its a virtual",defaultValue:{value:"'yz-quad'",computed:!1}},graphsActive:{required:!1,tsType:{name:"boolean"},description:"Graphs active?",defaultValue:{value:"true",computed:!1}},graphsMulti:{required:!1,tsType:{name:"boolean"},description:"Do not send to leds"},showMatrix:{required:!1,tsType:{name:"boolean"},description:"Show Matrix",defaultValue:{value:"false",computed:!1}},colorIndicator:{required:!1,tsType:{name:"boolean"},description:"Colorize?",defaultValue:{value:"true",computed:!1}},virtId:{required:!1,tsType:{name:"string"},description:"VirtualId",defaultValue:{value:"'yz-quad'",computed:!1}},index:{required:!1,tsType:{name:"number"},description:"Index",defaultValue:{value:"1",computed:!1}},handleDeleteDevice:{required:!1,tsType:{name:"any"},description:"Handle Function",defaultValue:{value:"() => console.log('DELETING DEVICE')",computed:!1}},handleEditVirtual:{required:!1,tsType:{name:"any"},description:"Handle Function",defaultValue:{value:"() => console.log('EDITING VIRTUAL')",computed:!1}},handleEditDevice:{required:!1,tsType:{name:"any"},description:"Handle Function",defaultValue:{value:"() => console.log('EDITING DEVICE')",computed:!1}},handleClearEffect:{required:!1,tsType:{name:"any"},description:"Handle Function",defaultValue:{value:"() => console.log('CLEARING EFFECT')",computed:!1}},handlePlayPause:{required:!1,tsType:{name:"any"},description:"Handle Function",defaultValue:{value:"() => console.log('PLAY/PAUSE')",computed:!1}},handlePlayLast:{required:!1,tsType:{name:"any"},description:"Handle Function",defaultValue:{value:"() => console.log('PLAY LAST')",computed:!1}},activateDevice:{required:!1,tsType:{name:"any"},description:"Handle Function"},linkTo:{required:!1,tsType:{name:"any"},description:"Handle Function",defaultValue:{value:"'/'",computed:!1}},additionalStyle:{required:!1,tsType:{name:"any"},description:"JSX styles",defaultValue:{value:"{}",computed:!1}},onContextMenu:{required:!1,tsType:{name:"any"},description:"On Context Menu"},lastEffect:{required:!1,tsType:{name:"union",raw:"null | string",elements:[{name:"null"},{name:"string"}]},description:"last effect"}}};const DeviceCard_stories={title:"UI Components/DeviceCard",component:DeviceCard_DeviceCard,decorators:[Story=>(0,jsx_runtime.jsx)(chunk_JZWAC4HX.fS,{children:Story()})],parameters:{options:{showPanel:!0}}},Default=(args=>(0,jsx_runtime.jsx)(DeviceCard_DeviceCard,(0,objectSpread2.A)({},args))).bind({});Default.args={deviceName:"My Wled",iconName:"wled",effectName:"Cool",isEffectSet:!0,isPlaying:!0,previewOnly:!0,colorIndicator:!0,isStreaming:!1,graphsActive:!0,handleDeleteDevice:void 0,handleEditVirtual:void 0,handleEditDevice:void 0,handleClearEffect:void 0,handlePlayPause:void 0,additionalStyle:{},transitionTime:5,virtId:"yz-quad",isDevice:"yz-quad",linkTo:"/",index:1};const __namedExportsOrder=["Default"];Default.parameters={...Default.parameters,docs:{...Default.parameters?.docs,source:{originalSource:"args => <DeviceCard {...args} />",...Default.parameters?.docs?.source}}}},"./src/components/SchemaForm/components/BladeFrame.tsx"(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{A:()=>components_BladeFrame});var objectSpread2=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/objectSpread2.js"),InfoRounded=__webpack_require__("./node_modules/@mui/icons-material/esm/InfoRounded.js"),styled=__webpack_require__("./node_modules/@mui/material/esm/styles/styled.js"),ClickAwayListener=__webpack_require__("./node_modules/@mui/material/esm/ClickAwayListener/ClickAwayListener.js"),Box=__webpack_require__("./node_modules/@mui/material/esm/Box/Box.js"),Tooltip=__webpack_require__("./node_modules/@mui/material/esm/Tooltip/Tooltip.js"),react=__webpack_require__("./node_modules/react/index.js"),jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js");const Tooltip_Tooltip=props=>{const[open,setOpen]=(0,react.useState)(!1),handleTooltipClose=()=>{setOpen(!1)};return(0,jsx_runtime.jsx)(ClickAwayListener.x,{onClickAway:handleTooltipClose,children:(0,jsx_runtime.jsx)(Box.A,{sx:{pr:.5,pl:1,display:"flex"},children:(0,jsx_runtime.jsx)(Tooltip.A,(0,objectSpread2.A)((0,objectSpread2.A)({onClose:handleTooltipClose,open,disableFocusListener:!0,disableHoverListener:!0,disableTouchListener:!0},props),{},{children:(0,jsx_runtime.jsx)(InfoRounded.A,{sx:{cursor:"pointer"},onClick:()=>{setOpen(!0)},fontSize:"small"})}))})})},components_Tooltip=Tooltip_Tooltip;Tooltip_Tooltip.__docgenInfo={description:"",methods:[],displayName:"Tooltip"};const Root=(0,styled.Ay)("div")(_ref=>{let{theme}=_ref;return{minWidth:"23.5%",padding:"16px 1.2rem 6px 1.2rem",border:"1px solid",borderColor:theme.palette.divider,borderRadius:"10px",position:"relative",display:"flex",alignItems:"center",height:"auto",margin:"0.5rem 0","@media (max-width: 580px)":{width:"100% !important",margin:"0.5rem 0"},"& > label":{top:"-0.75rem",display:"flex",alignItems:"center",left:"1rem",padding:"0 0.3rem",position:"absolute",fontVariant:"all-small-caps",fontSize:"0.9rem",letterSpacing:"0.1rem",color:theme.palette.text.secondary,backgroundColor:theme.palette.background.paper,boxSizing:"border-box"}}}),BladeFrame=_ref2=>{let{index,title,children,full=!1,style={width:"unset",order:0},required=!1,variant="outlined",className,disabled,labelStyle,onClick,tooltip}=_ref2;return"outlined"===variant?(0,jsx_runtime.jsxs)(Root,{className:className||"",style:(0,objectSpread2.A)((0,objectSpread2.A)({},style),{},{width:full?"100%":style.width}),onClick,children:[(0,jsx_runtime.jsxs)("label",{style:(0,objectSpread2.A)({},labelStyle),className:"MuiFormLabel-root".concat(disabled?" Mui-disabled":"","  step-effect-").concat(index),children:[title,required?"*":"",tooltip?(0,jsx_runtime.jsx)(components_Tooltip,{sx:{ml:1,mr:.5},title:tooltip,arrow:!0,placement:"top",children:(0,jsx_runtime.jsx)(InfoRounded.A,{fontSize:"small"})}):null]}),children]}):children},components_BladeFrame=BladeFrame;BladeFrame.__docgenInfo={description:"",methods:[],displayName:"BladeFrame",props:{title:{required:!1,tsType:{name:"string"},description:"",defaultValue:{value:"undefined",computed:!0}},index:{required:!1,tsType:{name:"number"},description:"",defaultValue:{value:"undefined",computed:!0}},children:{required:!1,tsType:{name:"any"},description:"",defaultValue:{value:"undefined",computed:!0}},full:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},style:{required:!1,tsType:{name:"any"},description:"",defaultValue:{value:"{\n  width: 'unset',\n  order: 0\n}",computed:!1}},required:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},variant:{required:!1,tsType:{name:"union",raw:"'outlined' | 'contained' | 'inherit'",elements:[{name:"literal",value:"'outlined'"},{name:"literal",value:"'contained'"},{name:"literal",value:"'inherit'"}]},description:"",defaultValue:{value:"'outlined'",computed:!1}},className:{required:!1,tsType:{name:"union",raw:"string | undefined",elements:[{name:"string"},{name:"undefined"}]},description:"",defaultValue:{value:"undefined",computed:!0}},disabled:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"undefined",computed:!0}},labelStyle:{required:!1,tsType:{name:"any"},description:"",defaultValue:{value:"undefined",computed:!0}},onClick:{required:!1,tsType:{name:"union",raw:"any | undefined",elements:[{name:"any"},{name:"undefined"}]},description:"",defaultValue:{value:"undefined",computed:!0}},tooltip:{required:!1,tsType:{name:"ReactNode"},description:"",defaultValue:{value:"undefined",computed:!0}}}}}}]);